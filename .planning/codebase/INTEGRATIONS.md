# External Integrations Documentation

## Data Sources and APIs

### Primary Data Sources

#### Philadelphia Police Department (PPD) Crime Data
- **Source**: Philadelphia Police Department incident reports
- **Format**: Parquet files (processed and cached)
- **Access**: Local data files in `data/` directory
- **Usage**: Core crime incident data for all analyses
- **Processing**: Loaded via `analysis.data.loading.load_crime_data()`

#### Census Bureau Data
- **API**: U.S. Census Bureau API
- **Endpoints**:
  - Population data: `https://api.census.gov/data/2020/acs/acs5`
  - Geographic boundaries: `https://www2.census.gov/geo/tiger/TIGER2020/TRACT/`
- **Data**: Census tracts with population statistics (B01003_001E)
- **Geographic Filter**: Philadelphia County (FIPS: 42101)
- **Usage**: Demographic data for spatial analysis and census-based crime rates

#### OpenDataPhilly
- **Source**: City of Philadelphia open data portal
- **Data**: Police district boundaries
- **Primary URL**: `https://opendata.arcgis.com/datasets/62ec63afb8824a15953399b1fa819df2_0.geojson`
- **Fallback URL**: `https://phl.carto.com/api/v2/sql?q=SELECT+*+FROM+police_districts&format=geojson`
- **Usage**: Geographic boundaries for district-level analysis

### Geographic Data Services

#### Census Reporter API
- **Service**: Census Reporter (censusreporter.org)
- **Purpose**: Pre-joined census data with geographic boundaries
- **Usage**: Alternative source for census tract data with population

## Third-Party Services

### Mapping and Visualization

#### Mapbox
- **Service**: Mapbox GL JS
- **Version**: 3.14.0
- **Usage**: Interactive maps in web frontend
- **Integration**: `react-map-gl` wrapper (v8.0.4)
- **Features**: Crime hotspot visualization, district boundaries
- **API Access**: Client-side JavaScript library (no API key required for basic usage)

### Cloud Services

#### Google Cloud Platform (GCP)
- **Project**: Configured via `GOOGLE_CLOUD_PROJECT` environment variable
- **Services**:
  - **Cloud Run**: Serverless API deployment
  - **Cloud Build**: CI/CD pipeline for deployments
  - **Secret Manager**: Secure storage for `ADMIN_PASSWORD` and `ADMIN_TOKEN_SECRET`
- **Authentication**: Application Default Credentials (ADC)
- **Deployment**: Automated via `cloudbuild.yaml`

#### Firebase
- **Hosting**: Static web application hosting
- **Domains**: `philly-crime-explorer.web.app`, `philly-crime-explorer.firebaseapp.com`
- **Deployment**: `firebase deploy --only hosting`
- **Integration**: Web frontend hosting and CDN

#### Firestore
- **Service**: Firebase Firestore (NoSQL database)
- **Purpose**: Community Q&A feature storage
- **Collection**: `questions` (configurable via `FIRESTORE_COLLECTION_QUESTIONS`)
- **Authentication**: Firebase Admin SDK
- **Integration**: `firebase-admin` Python library (v6.9.0)
- **Fallback**: In-memory storage if Firestore unavailable

## Database Connections

### No Traditional Databases
- **Architecture**: File-based data storage
- **Format**: JSON, GeoJSON, Parquet
- **Location**: `api/data/` directory (Docker volume shared with pipeline)
- **Caching**: Joblib memory caching in `~/.cache/crime_analysis/`
- **Persistence**: Local filesystem with Docker volumes

### Data Pipeline Storage
- **Input**: Raw data in `data/raw/` (gitignored)
- **Processed**: Cleaned data in `data/processed/`
- **External Cache**: `data/external/.cache/` (gitignored)
- **API Data**: `api/data/` (generated by pipeline, served by API)

## External Dependencies

### Machine Learning Libraries

#### Facebook Prophet
- **Library**: `prophet` (via conda)
- **Purpose**: Time series forecasting
- **Usage**: Crime trend predictions
- **Integration**: Optional import with fallback if unavailable

#### Scikit-learn
- **Library**: `scikit-learn` 1.3+
- **Purpose**: Classification and machine learning
- **Usage**: Crime category classification
- **Integration**: Random Forest classifier for incident categorization

### Geographic Libraries

#### GeoPandas
- **Library**: `geopandas` 0.14+
- **Dependencies**: GEOS, GDAL, PROJ (via conda)
- **Purpose**: Spatial data processing
- **Usage**: Geographic operations on crime data
- **Integration**: Optional import with graceful degradation

### Web Libraries

#### Recharts
- **Library**: `recharts` 3.1.2
- **Purpose**: Data visualization in React
- **Usage**: Charts and graphs in web interface
- **Integration**: Declarative chart components

#### SWR
- **Library**: `swr` 2.3.6
- **Purpose**: Data fetching and caching in React
- **Usage**: API data fetching with caching
- **Integration**: React hooks for server state management

### Development Tools

#### GitHub Copilot
- **Service**: AI-powered code assistance
- **Integration**: VS Code extension for code suggestions
- **Usage**: Development workflow enhancement

#### Pre-commit Hooks
- **Tool**: `pre-commit` 4.0+
- **Purpose**: Automated code quality checks
- **Hooks**: Black, Ruff, MyPy, ESLint
- **Integration**: Git pre-commit hooks

## API Integrations

### Internal API Endpoints
- **Base URL**: `http://localhost:8080` (local), Cloud Run URL (production)
- **Endpoints**:
  - `/api/health` - Service health check
  - `/api/trends/*` - Crime trend data
  - `/api/spatial/*` - Geographic analysis
  - `/api/policy/*` - Policy evaluation data
  - `/api/forecasting/*` - Prediction data
  - `/api/metadata` - Data metadata
  - `/api/questions/*` - Community Q&A (Firestore)

### CORS Configuration
- **Allowed Origins**:
  - `http://localhost:3000` (local development)
  - `https://philly-crime-explorer.web.app` (production)
  - `https://philly-crime-explorer.firebaseapp.com` (production)
- **Configuration**: Environment variable `CORS_ORIGINS`

## Security and Authentication

### API Security
- **Admin Authentication**: Password-based (`ADMIN_PASSWORD`)
- **Token Authentication**: JWT with secret (`ADMIN_TOKEN_SECRET`)
- **Secrets Management**: Google Cloud Secret Manager

### Data Privacy
- **PII Handling**: Raw data with PII in `data/raw/` (gitignored)
- **Cleaned Data**: PII removed in `data/processed/`
- **External Cache**: Sensitive data in `data/external/.cache/` (gitignored)

## Monitoring and Logging

### Application Monitoring
- **Health Checks**: Docker health checks for all services
- **API Health**: `/api/health` endpoint
- **Pipeline Health**: File-based health indicators (`/tmp/pipeline-refresh.ok`)

### Logging
- **Python**: Standard logging with Rich console output
- **Docker**: Container logs via `docker compose logs`
- **Cloud**: Google Cloud Logging (implicit via Cloud Run)

## Environment-Specific Configurations

### Local Development
- **Firestore**: Falls back to in-memory storage
- **CORS**: Allows localhost origins
- **Secrets**: Environment variables (not secrets manager)

### Production
- **Firestore**: Full Firestore integration
- **CORS**: Production domain restrictions
- **Secrets**: Google Cloud Secret Manager
- **Authentication**: Required for admin endpoints