---
wave: 2
depends_on: ["01-01"]
files_modified:
  - notebooks/summer_crime_spike_analysis.ipynb
autonomous: true
---

# Plan 01-03: Seasonality Notebook (CHIEF-02)

<objective>
Refactor the Summer Crime Spike / Seasonality notebook (CHIEF-02) to use external configuration, produce monthly decomposition with quantified differences, and generate academic-style reports.

This notebook answers: "Is the summer crime spike a real phenomenon or just perception?" by analyzing monthly seasonality patterns with statistical validation.

Requirement Coverage: CHIEF-02 - Monthly seasonality decomposition and month-level boxplots; quantify month-to-month percentage differences (e.g., July vs January)
</objective>

<tasks>

<task id="1" type="code">
<name>Refactor Data Loading and Configuration</name>
<what>Integrate external configuration for seasonality parameters and standardize data loading.</what>
<how>
1. Add config loading cell at notebook top:
   ```python
   from analysis.config_loader import Phase1Config
   from analysis.utils import load_data, classify_crime_category, extract_temporal_features
   
   config = Phase1Config()
   params = config.get_notebook_params('seasonality')
   SUMMER_MONTHS = params['summer_months']      # [6, 7, 8]
   WINTER_MONTHS = params['winter_months']      # [1, 2, 3]
   SIGNIFICANCE_LEVEL = params['significance_level']  # 0.05
   VERSION = config.version
   ```
2. Add papermill parameter cell with tag "parameters":
   ```python
   # Parameters (injected by papermill)
   VERSION = "v1.0"
   SUMMER_MONTHS = [6, 7, 8]
   WINTER_MONTHS = [1, 2, 3]
   SIGNIFICANCE_LEVEL = 0.05
   FAST_MODE = False
   ```
3. Replace hardcoded data loading with `load_data()` and `extract_temporal_features()`
4. Filter to exclude 2026 data: `df = df[df['year'] <= 2025]`
5. Add reproducibility cell with environment details
6. If FAST_MODE, sample to 10%
</how>
<files>
- notebooks/summer_crime_spike_analysis.ipynb
</files>
<verify>
```bash
cd notebooks && python -c "
import nbformat
nb = nbformat.read('summer_crime_spike_analysis.ipynb', as_version=4)
code = ' '.join([c.source for c in nb.cells if c.cell_type == 'code'])
assert 'SUMMER_MONTHS' in code, 'Missing SUMMER_MONTHS parameter'
assert 'Phase1Config' in code or 'config_loader' in code, 'Missing config import'
print('Config integration verified')
"
```
</verify>
</task>

<task id="2" type="code">
<name>Restructure to Academic Report Format</name>
<what>Reorganize sections to match academic style with explicit methods, assumptions, and limitations.</what>
<how>
1. Add "Summary" section with clear answer:
   - "Yes, summer months show X% increase in crime compared to winter"
   - Key finding: July vs January difference
   - Statistical significance statement
2. Create "Methods" section documenting:
   - Seasonality decomposition approach
   - Month grouping: Summer = June/July/August, Winter = January/February/March
   - Statistical test: Independent samples t-test
   - Why these groups: meteorological seasons, common convention
3. Add "Assumptions" subsection:
   - Assumed summer = June/July/August (meteorological definition)
   - Assumed reporting rates consistent across seasons
   - Assumed data completeness across all months
4. Organize existing analysis under "Findings" section
5. Add "Limitations" section:
   - Reporting delays may differ by season (holidays)
   - Weather correlation not tested (temperature, precipitation)
   - Definition of "summer" is somewhat arbitrary
   - Does not control for confounding factors (events, policy changes)
6. Add "Data Quality Summary" section with quality table
7. Include timestamp in title
</how>
<files>
- notebooks/summer_crime_spike_analysis.ipynb
</files>
<verify>
```bash
cd notebooks && python -c "
import nbformat
nb = nbformat.read('summer_crime_spike_analysis.ipynb', as_version=4)
md = ' '.join([c.source for c in nb.cells if c.cell_type == 'markdown'])
assert 'Methods' in md, 'Missing Methods section'
assert 'Assumptions' in md or 'assumptions' in md, 'Missing Assumptions'
print('Academic format verified')
"
```
</verify>
</task>

<task id="3" type="code">
<name>Enhance Month-Level Visualizations</name>
<what>Create publication-quality boxplots and seasonal charts with heavy annotations.</what>
<how>
1. Import colors: `from analysis.config import COLORS`
2. Update monthly boxplot:
   - Use colorblind-safe palette
   - Highlight summer months (6,7,8) with distinct background shading
   - Highlight winter months (1,2,3) with different shading
   - Label median values on each boxplot
   - Add title with sample size: "Monthly Crime Distribution (N=3.2M incidents)"
3. Add annotations:
   - Peak month labeled: "August: Highest (median=X)"
   - Lowest month labeled: "February: Lowest (median=Y)"
   - Difference annotation: "Summer +18.3% vs Winter"
4. Create supplemental line chart:
   - Monthly average crime counts with error bars (95% CI)
   - Clear month labels on x-axis
   - Trend line overlay (optional)
5. All figures: `dpi=300`, timestamp in subtitle
</how>
<files>
- notebooks/summer_crime_spike_analysis.ipynb
</files>
<verify>
```bash
cd notebooks && python -c "
import nbformat
nb = nbformat.read('summer_crime_spike_analysis.ipynb', as_version=4)
code = ' '.join([c.source for c in nb.cells if c.cell_type == 'code'])
assert 'dpi=300' in code or 'dpi = 300' in code, 'Missing 300 DPI'
print('Visualization settings verified')
"
```
</verify>
</task>

<task id="4" type="code">
<name>Quantify Seasonal Differences</name>
<what>Produce clear numeric summary of month-to-month percentage differences as required by CHIEF-02.</what>
<how>
1. Calculate key statistics:
   ```python
   # Monthly aggregates
   monthly_stats = df.groupby('month').agg({
       'objectid': ['count', 'mean', 'std']
   }).reset_index()
   
   # Summer vs Winter comparison
   summer_avg = df[df['month'].isin(SUMMER_MONTHS)]['monthly_count'].mean()
   winter_avg = df[df['month'].isin(WINTER_MONTHS)]['monthly_count'].mean()
   pct_diff = (summer_avg - winter_avg) / winter_avg * 100
   ```
2. Create summary table with all 12 months:
   - Month name, mean crimes, median crimes, std, rank
   - Highlight summer/winter months
3. Compute pairwise comparisons:
   - July vs January: X% difference
   - August vs February: X% difference
   - Summer avg vs Winter avg: X% difference
4. Run t-test:
   ```python
   from scipy import stats
   summer_data = monthly_totals[monthly_totals['month'].isin(SUMMER_MONTHS)]['count']
   winter_data = monthly_totals[monthly_totals['month'].isin(WINTER_MONTHS)]['count']
   t_stat, p_value = stats.ttest_ind(summer_data, winter_data)
   ```
5. Display clear summary statement:
   "Summer months (Jun-Aug) show 18.3% more crimes than winter months (Jan-Mar), p < 0.001"
</how>
<files>
- notebooks/summer_crime_spike_analysis.ipynb
</files>
<verify>
```bash
cd notebooks && python -c "
import nbformat
nb = nbformat.read('summer_crime_spike_analysis.ipynb', as_version=4)
code = ' '.join([c.source for c in nb.cells if c.cell_type == 'code'])
assert 'ttest' in code or 't_test' in code or 'stats.ttest' in code, 'Missing t-test'
print('Statistical test verified')
"
```
</verify>
</task>

<task id="5" type="code">
<name>Implement Versioned Artifact Generation</name>
<what>Save all outputs with versioned filenames and generate manifest.</what>
<how>
1. Import artifact functions:
   ```python
   from analysis.artifact_manager import get_versioned_path, create_version_manifest, save_manifest
   from analysis.config import REPORTS_DIR
   ```
2. Update figure saves:
   ```python
   boxplot_path = REPORTS_DIR / f'seasonality_boxplot_{VERSION}.png'
   fig.savefig(boxplot_path, dpi=300, bbox_inches='tight')
   artifacts.append(boxplot_path)
   
   lineplot_path = REPORTS_DIR / f'monthly_trend_{VERSION}.png'
   ...
   ```
3. Generate markdown report with:
   - Summary: "Summer spike confirmed: +X% vs winter"
   - Month-by-month table
   - Statistical test results
   - Visualization references
4. Create and save manifest:
   ```python
   manifest = create_version_manifest(VERSION, artifacts, params, runtime)
   save_manifest(manifest, REPORTS_DIR / f'seasonality_manifest_{VERSION}.json')
   ```
</how>
<files>
- notebooks/summer_crime_spike_analysis.ipynb
</files>
<verify>
```bash
ls reports/seasonality_*.png 2>/dev/null && echo "PNG artifacts exist"
ls reports/seasonality_*.md 2>/dev/null && echo "Report exists"
```
</verify>
</task>

<task id="6" type="code">
<name>Test Headless Execution</name>
<what>Verify notebook runs successfully via papermill with parameter injection.</what>
<how>
1. Add error handling for edge cases:
   - Empty month groups
   - Invalid month values
   - Division by zero in percentage calculation
2. Test papermill execution:
   ```bash
   cd notebooks
   papermill summer_crime_spike_analysis.ipynb /tmp/output.ipynb \
     -p VERSION "v1.0" \
     -p SUMMER_MONTHS "[6, 7, 8]" \
     -p WINTER_MONTHS "[1, 2, 3]" \
     --timeout 600
   ```
3. Verify month list parameters are correctly injected and parsed
4. Check all artifacts generated
5. Test fast mode completes in < 30 seconds
</how>
<files>
- notebooks/summer_crime_spike_analysis.ipynb
</files>
<verify>
```bash
cd notebooks && papermill summer_crime_spike_analysis.ipynb /tmp/test_seasonality.ipynb -p FAST_MODE true --timeout 120 && echo "Headless execution successful"
```
</verify>
</task>

</tasks>

<must_haves>
- [ ] No hardcoded month lists (SUMMER_MONTHS, WINTER_MONTHS from config/parameters)
- [ ] Parameter cell has `parameters` tag for papermill
- [ ] Notebook has Summary, Methods, Assumptions, Findings, Limitations sections
- [ ] Monthly boxplot with summer/winter highlighting and median labels
- [ ] Quantified percentage difference: "Summer shows X% increase vs winter"
- [ ] T-test result displayed with p-value
- [ ] All figures saved at 300 DPI with versioned filenames
- [ ] Markdown report generated with month-by-month table
- [ ] Manifest JSON created with artifact hashes
- [ ] Papermill headless execution completes without errors
</must_haves>

<deliverables>
- Refactored notebooks/summer_crime_spike_analysis.ipynb
- reports/seasonality_boxplot_v1.0.png
- reports/monthly_trend_v1.0.png
- reports/seasonality_report_v1.0.md
- reports/seasonality_manifest_v1.0.json
</deliverables>
