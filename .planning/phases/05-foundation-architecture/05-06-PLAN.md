---
phase: 05-foundation-architecture
plan: 06
type: execute
wave: 3
depends_on: ["05-05"]
files_modified:
  - tests/test_classification.py
  - tests/test_temporal.py
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Developer can run 'pytest tests/test_classification.py' and all tests pass"
    - "Developer can run 'pytest tests/test_temporal.py' and all tests pass"
    - "Developer can run 'pytest --cov analysis/utils.classification' and see 90%+ coverage"
    - "Developer can run 'pytest --cov analysis.utils.temporal' and see 90%+ coverage"
  artifacts:
    - path: "tests/test_classification.py"
      provides: "Tests for classify_crime_category function"
      min_lines: 50
      test_functions: "test_classify_crime_category, test_crime_category_map"
    - path: "tests/test_temporal.py"
      provides: "Tests for extract_temporal_features function"
      min_lines: 50
      test_functions: "test_extract_temporal_features"
  key_links:
    - from: "tests/test_classification.py"
      to: "analysis/utils/classification.py"
      via: "pytest imports and tests classify_crime_category"
      pattern: "from analysis.utils.classification import"
    - from: "tests/test_temporal.py"
      to: "analysis/utils/temporal.py"
      via: "pytest imports and tests extract_temporal_features"
      pattern: "from analysis.utils.temporal import"
---

<objective>
Create tests for utils modules (classification, temporal) to achieve 90%+ test coverage.

Purpose: The verification report identified that no tests exist for new modules (classification, temporal, loading, validation, preprocessing). This plan creates tests for classification and temporal utilities, covering the CRIME_CATEGORY_MAP, classify_crime_category, and extract_temporal_features functions.

Output: tests/test_classification.py and tests/test_temporal.py with comprehensive test coverage (>90%) for classification and temporal utilities.
</objective>

<execution_context>
@/Users/dustinober/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dustinober/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-foundation-architecture/05-VERIFICATION.md
@.planning/phases/05-foundation-architecture/05-01-SUMMARY.md

@analysis/utils/classification.py
@analysis/utils/temporal.py
@tests/test_phase2_spatial.py
@pyproject.toml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create tests/test_classification.py with comprehensive coverage</name>
  <files>tests/test_classification.py</files>
  <action>
    Create tests/test_classification.py with comprehensive tests for classify_crime_category and CRIME_CATEGORY_MAP:

    1. Import required modules:
       ```python
       import pytest
       from analysis.utils.classification import classify_crime_category, CRIME_CATEGORY_MAP
       ```

    2. Test CRIME_CATEGORY_MAP structure:
       - Verify CRIME_CATEGORY_MAP is a dict
       - Verify keys are "Violent", "Property", "Other"
       - Verify values are sets of integers
       - Verify no overlap between categories (mutually exclusive)

    3. Test classify_crime_category with valid UCR codes:
       - Test violent crimes (UCR codes 1-4): 100, 200, 300, 400
       - Test property crimes (UCR codes 5-7): 500, 600, 700
       - Test other crimes (UCR codes outside ranges): 800, 900
       - Test edge cases: 1, 4, 5, 7

    4. Test classify_crime_category with expanded UCR codes:
       - Test expanded format (100-9999): 600, 2600, 3000
       - Verify hundred-band extraction works (first digit)

    5. Test classify_crime_category with invalid inputs:
       - Test None returns None
       - Test string returns None
       - Test negative returns None
       - Test zero returns None

    6. Test return types:
       - Verify function returns str for valid inputs
       - Verify function returns None for invalid inputs

    Reference from 05-01-SUMMARY: CRIME_CATEGORY_MAP classifies crimes into Violent (UCR 1-4), Property (UCR 5-7), Other (all others). Classification uses hundred-band (first digit of UCR code).

    Use pytest fixtures and parametrize for edge cases. Add docstrings to test functions.
  </action>
  <verify>
    Run: `pytest tests/test_classification.py -v --cov analysis/utils/classification --cov-report=term-missing`. Expected: All tests pass, coverage >=90%.
  </verify>
  <done>
    - tests/test_classification.py created with >=50 lines
    - All tests pass
    - Coverage for classification.py >=90%
    - CRIME_CATEGORY_MAP and classify_crime_category tested
  </done>
</task>

<task type="auto">
  <name>Task 2: Create tests/test_temporal.py with comprehensive coverage</name>
  <files>tests/test_temporal.py</files>
  <action>
    Create tests/test_temporal.py with comprehensive tests for extract_temporal_features:

    1. Import required modules:
       ```python
       import pytest
       import pandas as pd
       from analysis.utils.temporal import extract_temporal_features
       ```

    2. Test extract_temporal_features with valid datetime:
       - Test with pd.Timestamp
       - Test with datetime.datetime
       - Test with string that parses to datetime

    3. Test extracted features:
       - Verify 'year' column is integer
       - Verify 'month' column is integer (1-12)
       - Verify 'day' column is integer (1-31)
       - Verify 'day_of_week' column is integer (0=Monday, 6=Sunday)
       - Verify 'hour' column is integer (0-23)
       - Verify 'is_weekend' column is boolean

    4. Test weekend detection:
       - Test Saturday (day_of_week=5) returns is_weekend=True
       - Test Sunday (day_of_week=6) returns is_weekend=True
       - Test Monday (day_of_week=0) returns is_weekend=False
       - Test Friday (day_of_week=4) returns is_weekend=False

    5. Test edge cases:
       - Test leap year date (2024-02-29)
       - Test year boundary (2023-12-31, 2024-01-01)
       - Test midnight (00:00:00)
       - Test end of day (23:59:59)

    6. Test invalid inputs:
       - Test None returns empty dict
       - Test invalid string returns empty dict
       - Test non-datetime returns empty dict

    Reference from 05-01-SUMMARY: extract_temporal_features creates year, month, day, day_of_week, hour, is_weekend features from a datetime column.

    Use pytest fixtures and parametrize for edge cases. Add docstrings to test functions.
  </action>
  <verify>
    Run: `pytest tests/test_temporal.py -v --cov analysis/utils/temporal --cov-report=term-missing`. Expected: All tests pass, coverage >=90%.
  </verify>
  <done>
    - tests/test_temporal.py created with >=50 lines
    - All tests pass
    - Coverage for temporal.py >=90%
    - extract_temporal_features comprehensively tested
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Verify tests pass:
   ```bash
   pytest tests/test_classification.py tests/test_temporal.py -v
   ```
   Expected: All tests pass (100% pass rate)

2. Verify coverage meets 90% target:
   ```bash
   pytest tests/test_classification.py tests/test_temporal.py --cov analysis/utils/classification analysis/utils/temporal --cov-report=term-missing
   ```
   Expected: Coverage >=90% for both modules

3. Verify tests discoverable by pytest:
   ```bash
   pytest --collect-only tests/
   ```
   Expected: test_classification.py and test_temporal.py listed with test functions

4. Run all tests to ensure no regressions:
   ```bash
   pytest tests/ -v
   ```
   Expected: All tests pass (including existing test_phase2_spatial.py)
</verification>

<success_criteria>
1. tests/test_classification.py created with >=50 lines
2. tests/test_temporal.py created with >=50 lines
3. All tests pass (100% pass rate)
4. Coverage >=90% for classification.py and temporal.py
5. No regressions in existing tests
</success_criteria>

<output>
After completion, create `.planning/phases/05-foundation-architecture/05-06-SUMMARY.md`
</output>
