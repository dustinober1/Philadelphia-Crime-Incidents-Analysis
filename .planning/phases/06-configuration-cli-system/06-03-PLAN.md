---
phase: 06-configuration-cli-system
plan: 03
type: execute
wave: 2
depends_on: ["06-02"]
files_modified:
  - analysis/cli/__init__.py
  - analysis/cli/__main__.py
  - analysis/cli/main.py
  - analysis/cli/chief.py
  - analysis/cli/patrol.py
  - analysis/cli/policy.py
  - analysis/cli/forecasting.py
autonomous: true

must_haves:
  truths:
    - "User can run `python -m analysis.cli --help` and see help text"
    - "User can run `python -m analysis.cli chief --help` and see Chief commands"
    - "User can run `python -m analysis.cli chief trends --help` and see trends options"
    - "CLI has 4 command groups (chief, patrol, policy, forecasting)"
  artifacts:
    - path: "analysis/cli/__main__.py"
      provides: "Module entry point for python -m analysis.cli"
      exports: ["app"]
    - path: "analysis/cli/main.py"
      provides: "Main typer app with command groups"
      exports: ["app"]
    - path: "analysis/cli/chief.py"
      provides: "Chief command group (trends, seasonality, covid)"
      exports: ["app", "trends", "seasonality", "covid"]
  key_links:
    - from: "analysis/cli/__main__.py"
      to: "analysis/cli/main.py"
      via: "app import"
      pattern: "from.*main.*import.*app"
    - from: "analysis/cli/main.py"
      to: "analysis/cli/chief.py"
      via: "app.add_typer()"
      pattern: "add_typer.*chief"
---

<objective>
Build CLI entry point structure using typer with 4 command groups (chief, patrol, policy, forecasting) and 13 commands total.

Purpose: Create the modular CLI architecture that provides clean entry points for all 13 analyses. This establishes the command structure before implementing individual command logic in later plans.

Output: Working `python -m analysis.cli` entry point with 4 command groups and help text for all commands.
</objective>

<execution_context>
@/Users/dustinober/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dustinober/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/06-configuration-cli-system/06-RESEARCH.md
@.planning/phases/06-configuration-cli-system/06-02-SUMMARY.md

# Existing CLI patterns (for reference)
@analysis/orchestrate_phase1.py
@analysis/orchestrate_phase2.py

# Config schemas created in 06-02
@analysis/config/schemas/chief.py
@analysis/config/schemas/patrol.py
@analysis/config/schemas/policy.py
@analysis/config/schemas/forecasting.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CLI package structure and main app</name>
  <files>
    - analysis/cli/__init__.py
    - analysis/cli/__main__.py
    - analysis/cli/main.py
  </files>
  <action>
    Create the CLI package structure:

    1. Create `analysis/cli/__init__.py`:
       ```python
       """CLI entry points for crime analysis scripts.

       Usage:
           python -m analysis.cli --help
           python -m analysis.cli chief trends --help
           python -m analysis.cli chief trends --start-year 2020 --fast
       """

       from analysis.cli.main import app

       __all__ = ["app"]
       ```

    2. Create `analysis/cli/__main__.py`:
       ```python
       """Module entry point for: python -m analysis.cli"""

       from analysis.cli.main import app

       if __name__ == "__main__":
           app()
       ```

    3. Create `analysis/cli/main.py`:
       ```python
       """Main CLI application for crime analysis.

       Provides command groups for each analysis area:
       - chief: High-level trend analyses (trends, seasonality, covid)
       - patrol: Patrol operations analyses (hotspots, robbery, district, census)
       - policy: Policy evaluation analyses (retail theft, vehicle, composition, events)
       - forecasting: Forecasting analyses (time series, classification)
       """

       import typer
       from rich.console import Console

       # Import command groups
       from analysis.cli import chief, patrol, policy, forecasting

       # Create main app
       app = typer.Typer(
           name="crime-analysis",
           help="Philadelphia Crime Incidents Analysis CLI",
           no_args_is_help=True,
           add_completion=False,
       )

       # Rich console for output
       console = Console()


       # Register command groups
       app.add_typer(
           chief.app,
           name="chief",
           help="Chief-level trend analyses (trends, seasonality, COVID impact)",
       )
       app.add_typer(
           patrol.app,
           name="patrol",
           help="Patrol operations analyses (hotspots, robbery, district severity, census rates)",
       )
       app.add_typer(
           policy.app,
           name="policy",
           help="Policy evaluation analyses (retail theft, vehicle crimes, composition, events)",
       )
       app.add_typer(
           forecasting.app,
           name="forecasting",
           help="Forecasting and prediction analyses (time series, violence classification)",
       )


       @app.command()
       def version() -> None:
           """Show version information."""
           console.print("[bold blue]Crime Analysis CLI[/bold blue]")
           console.print("  Version: [cyan]v1.1[/cyan]")
           console.print(f"  typer: [cyan]{typer.__version__}[/cyan]")


       @app.command()
       def info() -> None:
           """Show project information."""
           from pathlib import Path

           console.print("[bold blue]Philadelphia Crime Incidents Analysis[/bold blue]")
           console.print()
           console.print("Data sources:")
           console.print("  - Philadelphia Police Department crime incidents")
           console.print("  - U.S. Census Bureau demographic data")
           console.print("  - City event schedules")
           console.print()
           console.print("Reports directory: [cyan]reports/[/cyan]")
           console.print(f"  (resolved to: [cyan]{Path('reports').resolve()}[/cyan])")


       if __name__ == "__main__":
           app()
       ```

    Do NOT implement individual command logic yet - just create the structure with placeholder command groups.
  </action>
  <verify>
    - `python -m analysis.cli --help` shows help text with 4 command groups listed
    - `python -m analysis.cli version` executes without error
    - `python -m analysis.cli info` executes without error
  </verify>
  <done>
    Main CLI app exists with 4 command groups registered. Help text shows all groups. version and info commands work.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Chief command group (3 commands)</name>
  <files>analysis/cli/chief.py</files>
  <action>
    Create `analysis/cli/chief.py` with 3 placeholder commands (trends, seasonality, covid):

    ```python
    """Chief-level trend analysis commands."""

    import typer
    from rich.console import Console

    from analysis.config.schemas.chief import TrendsConfig, SeasonalityConfig, COVIDConfig

    # Create typer app for this command group
    app = typer.Typer(
        help="Chief-level trend analyses (annual trends, seasonality, COVID impact)"
    )
    console = Console()


    @app.command()
    def trends(
        start_year: int = typer.Option(2015, help="Start year for analysis", min=2006, max=2026),
        end_year: int = typer.Option(2024, help="End year for analysis", min=2006, max=2026),
        version: str = typer.Option("v1.0", help="Output version tag"),
        fast: bool = typer.Option(False, "--fast", help="Fast mode with 10%% sample"),
    ) -> None:
        """Generate annual crime trends analysis."""
        # Load config
        config = TrendsConfig(start_year=start_year, end_year=end_year, version=version, fast_mode=fast)

        console.print(f"[bold blue]Annual Trends Analysis[/bold blue]")
        console.print(f"  Period: {config.start_year}-{config.end_year}")
        console.print(f"  Version: {config.version}")
        console.print(f"  Fast mode: {config.fast_mode}")
        console.print()
        console.print("[yellow]Command logic will be implemented in plan 06-04[/yellow]")

        # TODO: Implement analysis logic in 06-04
        # - Load data using analysis.data.load_crime_data()
        # - Run trends analysis
        # - Generate plots and reports


    @app.command()
    def seasonality(
        summer_months: list[int] = typer.Option([6, 7, 8], help="Summer months"),
        winter_months: list[int] = typer.Option([12, 1, 2], help="Winter months"),
        version: str = typer.Option("v1.0", help="Output version tag"),
        fast: bool = typer.Option(False, "--fast", help="Fast mode with 10%% sample"),
    ) -> None:
        """Analyze seasonal crime patterns."""
        config = SeasonalityConfig(
            summer_months=summer_months,
            winter_months=winter_months,
            version=version,
            fast_mode=fast,
        )

        console.print(f"[bold blue]Seasonality Analysis[/bold blue]")
        console.print(f"  Summer months: {config.summer_months}")
        console.print(f"  Winter months: {config.winter_months}")
        console.print()
        console.print("[yellow]Command logic will be implemented in plan 06-04[/yellow]")

        # TODO: Implement analysis logic in 06-04


    @app.command()
    def covid(
        lockdown_date: str = typer.Option("2020-03-01", help="COVID lockdown date"),
        before_years: list[int] = typer.Option([2018, 2019], help="Pre-COVID years for comparison"),
        version: str = typer.Option("v1.0", help="Output version tag"),
        fast: bool = typer.Option(False, "--fast", help="Fast mode with 10%% sample"),
    ) -> None:
        """Analyze COVID impact on crime patterns."""
        config = COVIDConfig(
            lockdown_date=lockdown_date,
            before_years=before_years,
            version=version,
            fast_mode=fast,
        )

        console.print(f"[bold blue]COVID Impact Analysis[/bold blue]")
        console.print(f"  Lockdown date: {config.lockdown_date}")
        console.print(f"  Before years: {config.before_years}")
        console.print()
        console.print("[yellow]Command logic will be implemented in plan 06-04[/yellow]")

        # TODO: Implement analysis logic in 06-04
    ```

    Note: This creates placeholder commands that validate config loading and CLI argument parsing. Analysis logic will be added in plan 06-04.
  </action>
  <verify>
    - `python -m analysis.cli chief --help` shows 3 commands (trends, seasonality, covid)
    - `python -m analysis.cli chief trends --help` shows options
    - `python -m analysis.cli chief trends --start-year 2020 --fast` executes without error and prints config values
  </verify>
  <done>
    Chief command group exists with 3 commands. All commands parse CLI arguments and load config correctly.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Patrol command group (4 commands)</name>
  <files>analysis/cli/patrol.py</files>
  <action>
    Create `analysis/cli/patrol.py` with 4 placeholder commands (hotspots, robbery-heatmap, district-severity, census-rates):

    ```python
    """Patrol operations analysis commands."""

    import typer
    from rich.console import Console

    from analysis.config.schemas.patrol import (
        HotspotsConfig,
        RobberyConfig,
        DistrictConfig,
        CensusConfig,
    )

    app = typer.Typer(help="Patrol operations analyses")
    console = Console()


    @app.command()
    def hotspots(
        eps: float = typer.Option(0.002, help="DBSCAN epsilon parameter (degrees)"),
        min_samples: int = typer.Option(50, help="DBSCAN min_samples parameter"),
        version: str = typer.Option("v1.0", help="Output version tag"),
        fast: bool = typer.Option(False, "--fast", help="Fast mode with 10%% sample"),
    ) -> None:
        """Identify crime hotspots using spatial clustering."""
        config = HotspotsConfig(
            eps_degrees=eps,
            min_samples=min_samples,
            version=version,
            fast_mode=fast,
        )
        console.print(f"[bold blue]Hotspots Analysis[/bold blue]")
        console.print(f"  Epsilon: {config.eps_degrees} degrees")
        console.print(f"  Min samples: {config.min_samples}")
        console.print()
        console.print("[yellow]Command logic will be implemented in plan 06-05[/yellow]")


    @app.command(name="robbery-heatmap")
    def robbery_heatmap(
        time_bin: int = typer.Option(60, help="Time bin size in minutes"),
        grid_size: int = typer.Option(20, help="Grid size for heatmap"),
        version: str = typer.Option("v1.0", help="Output version tag"),
        fast: bool = typer.Option(False, "--fast", help="Fast mode with 10%% sample"),
    ) -> None:
        """Generate temporal heatmap for robbery incidents."""
        config = RobberyConfig(
            time_bin_size=time_bin,
            grid_size=grid_size,
            version=version,
            fast_mode=fast,
        )
        console.print(f"[bold blue]Robbery Heatmap Analysis[/bold blue]")
        console.print(f"  Time bin: {config.time_bin_size} minutes")
        console.print(f"  Grid size: {config.grid_size}")
        console.print()
        console.print("[yellow]Command logic will be implemented in plan 06-05[/yellow]")


    @app.command(name="district-severity")
    def district_severity(
        districts: list[int] | None = typer.Option(None, help="Districts to analyze (default: all)"),
        version: str = typer.Option("v1.0", help="Output version tag"),
        fast: bool = typer.Option(False, "--fast", help="Fast mode with 10%% sample"),
    ) -> None:
        """Calculate severity scores by police district."""
        config = DistrictConfig(
            districts=districts,
            version=version,
            fast_mode=fast,
        )
        console.print(f"[bold blue]District Severity Analysis[/bold blue]")
        console.print(f"  Districts: {config.districts or 'All'}")
        console.print()
        console.print("[yellow]Command logic will be implemented in plan 06-05[/yellow]")


    @app.command(name="census-rates")
    def census_rates(
        population_threshold: int = typer.Option(100, help="Minimum population for census tract"),
        version: str = typer.Option("v1.0", help="Output version tag"),
        fast: bool = typer.Option(False, "--fast", help="Fast mode with 10%% sample"),
    ) -> None:
        """Calculate crime rates per census tract."""
        config = CensusConfig(
            population_threshold=population_threshold,
            version=version,
            fast_mode=fast,
        )
        console.print(f"[bold blue]Census Rates Analysis[/bold blue]")
        console.print(f"  Population threshold: {config.population_threshold}")
        console.print()
        console.print("[yellow]Command logic will be implemented in plan 06-05[/yellow]")
    ```

    Note: Use kebab-case for command names with hyphens (robbery-heatmap, district-severity, census-rates) for better CLI UX.
  </action>
  <verify>
    - `python -m analysis.cli patrol --help` shows 4 commands
    - `python -m analysis.cli patrol hotspots --eps 0.003 --min-samples 100` executes and prints config values
    - `python -m analysis.cli patrol robbery-heatmap --help` shows options with proper kebab-case naming
  </verify>
  <done>
    Patrol command group exists with 4 commands. Kebab-case command names work correctly.
  </done>
</task>

<task type="auto">
  <name>Task 4: Create Policy and Forecasting command groups</name>
  <files>
    - analysis/cli/policy.py
    - analysis/cli/forecasting.py
  </files>
  <action>
    Create two command group files:

    1. `analysis/cli/policy.py` with 4 commands:
       ```python
       """Policy evaluation analysis commands."""

       import typer
       from rich.console import Console

       from analysis.config.schemas.policy import (
           RetailTheftConfig,
           VehicleCrimesConfig,
           CompositionConfig,
           EventsConfig,
       )

       app = typer.Typer(help="Policy evaluation analyses")
       console = Console()


       @app.command(name="retail-theft")
       def retail_theft(
           baseline_start: str = typer.Option("2019-01-01", help="Baseline period start"),
           baseline_end: str = typer.Option("2020-02-01", help="Baseline period end"),
           version: str = typer.Option("v1.0", help="Output version tag"),
           fast: bool = typer.Option(False, "--fast", help="Fast mode with 10%% sample"),
       ) -> None:
           """Analyze retail theft trends."""
           config = RetailTheftConfig(baseline_start=baseline_start, baseline_end=baseline_end, version=version, fast_mode=fast)
           console.print(f"[bold blue]Retail Theft Analysis[/bold blue]")
           console.print(f"  Baseline: {config.baseline_start} to {config.baseline_end}")
           console.print()
           console.print("[yellow]Command logic will be implemented in plan 06-06[/yellow]")


       @app.command(name="vehicle-crimes")
       def vehicle_crimes(
           ucr_codes: list[int] = typer.Option([700], help="UCR codes for vehicle crimes"),
           start_date: str = typer.Option("2019-01-01", help="Analysis start date"),
           end_date: str = typer.Option("2023-12-31", help="Analysis end date"),
           version: str = typer.Option("v1.0", help="Output version tag"),
           fast: bool = typer.Option(False, "--fast", help="Fast mode with 10%% sample"),
       ) -> None:
           """Analyze vehicle crime trends."""
           config = VehicleCrimesConfig(ucr_codes=ucr_codes, start_date=start_date, end_date=end_date, version=version, fast_mode=fast)
           console.print(f"[bold blue]Vehicle Crimes Analysis[/bold blue]")
           console.print(f"  UCR codes: {config.ucr_codes}")
           console.print(f"  Period: {config.start_date} to {config.end_date}")
           console.print()
           console.print("[yellow]Command logic will be implemented in plan 06-06[/yellow]")


       @app.command(name="composition")
       def composition(
           top_n: int = typer.Option(10, help="Number of top categories to show"),
           version: str = typer.Option("v1.0", help="Output version tag"),
           fast: bool = typer.Option(False, "--fast", help="Fast mode with 10%% sample"),
       ) -> None:
           """Analyze crime composition over time."""
           config = CompositionConfig(top_n=top_n, version=version, fast_mode=fast)
           console.print(f"[bold blue]Crime Composition Analysis[/bold blue]")
           console.print(f"  Top N: {config.top_n}")
           console.print()
           console.print("[yellow]Command logic will be implemented in plan 06-06[/yellow]")


       @app.command(name="events")
       def events(
           days_before: int = typer.Option(7, help="Days before event to include"),
           days_after: int = typer.Option(7, help="Days after event to include"),
           version: str = typer.Option("v1.0", help="Output version tag"),
           fast: bool = typer.Option(False, "--fast", help="Fast mode with 10%% sample"),
       ) -> None:
           """Analyze impact of events on crime."""
           config = EventsConfig(days_before=days_before, days_after=days_after, version=version, fast_mode=fast)
           console.print(f"[bold blue]Event Impact Analysis[/bold blue]")
           console.print(f"  Window: {config.days_before} days before, {config.days_after} days after")
           console.print()
           console.print("[yellow]Command logic will be implemented in plan 06-06[/yellow]")
       ```

    2. `analysis/cli/forecasting.py` with 2 commands:
       ```python
       """Forecasting and prediction analysis commands."""

       import typer
       from rich.console import Console

       from analysis.config.schemas.forecasting import TimeSeriesConfig, ClassificationConfig

       app = typer.Typer(help="Forecasting and prediction analyses")
       console = Console()


       @app.command(name="time-series")
       def time_series(
           horizon: int = typer.Option(12, help="Forecast horizon (periods)"),
           model_type: str = typer.Option("prophet", help="Model type (prophet, arima, ets)"),
           version: str = typer.Option("v1.0", help="Output version tag"),
           fast: bool = typer.Option(False, "--fast", help="Fast mode with 10%% sample"),
       ) -> None:
           """Generate crime rate forecasts."""
           config = TimeSeriesConfig(forecast_horizon=horizon, model_type=model_type, version=version, fast_mode=fast)
           console.print(f"[bold blue]Time Series Forecasting[/bold blue]")
           console.print(f"  Horizon: {config.forecast_horizon} periods")
           console.print(f"  Model: {config.model_type}")
           console.print()
           console.print("[yellow]Command logic will be implemented in plan 06-06[/yellow]")


       @app.command(name="classification")
       def classification(
           test_size: float = typer.Option(0.25, help="Test set proportion"),
           random_state: int = typer.Option(42, help="Random state for reproducibility"),
           version: str = typer.Option("v1.0", help="Output version tag"),
           fast: bool = typer.Option(False, "--fast", help="Fast mode with 10%% sample"),
       ) -> None:
           """Train violence classification model."""
           config = ClassificationConfig(test_size=test_size, random_state=random_state, version=version, fast_mode=fast)
           console.print(f"[bold blue]Violence Classification[/bold blue]")
           console.print(f"  Test size: {config.test_size}")
           console.print(f"  Random state: {config.random_state}")
           console.print()
           console.print("[yellow]Command logic will be implemented in plan 06-06[/yellow]")
       ```
  </action>
  <verify>
    - `python -m analysis.cli policy --help` shows 4 commands
    - `python -m analysis.cli forecasting --help` shows 2 commands
    - `python -m analysis.cli policy retail-theft --baseline-start 2018-01-01` executes and prints config
    - `python -m analysis.cli forecasting time-series --horizon 24 --model-type arima` executes and prints config
  </verify>
  <done>
    Policy command group exists with 4 commands. Forecasting command group exists with 2 commands. Total 13 commands across all groups.
  </done>
</task>

</tasks>

<verification>
After completing this plan:

1. Verify main CLI entry point:
   - `python -m analysis.cli --help` shows 4 command groups
   - `python -m analysis.cli version` and `python -m analysis.cli info` work

2. Verify all command groups:
   - `python -m analysis.cli chief --help` shows 3 commands
   - `python -m analysis.cli patrol --help` shows 4 commands
   - `python -m analysis.cli policy --help` shows 4 commands
   - `python -m analysis.cli forecasting --help` shows 2 commands

3. Verify command help:
   - `python -m analysis.cli chief trends --help` shows options
   - `python -m analysis.cli patrol hotspots --help` shows options
   - `python -m analysis.cli forecasting time-series --help` shows options

4. Verify argument parsing:
   - `python -m analysis.cli chief trends --start-year 2020 --fast` prints correct values

Expected outcome: Complete CLI structure with 13 commands across 4 groups, all help text working, argument parsing functional.
</verification>

<success_criteria>
1. analysis/cli package exists with __init__.py, __main__.py, main.py, and 4 command group files
2. `python -m analysis.cli --help` shows all 4 command groups and top-level commands
3. All 13 commands have help text accessible via --help
4. CLI arguments are parsed and passed to config objects correctly
5. Kebab-case command names work (e.g., robbery-heatmap, district-severity)
</success_criteria>

<output>
After completion, create `.planning/phases/06-configuration-cli-system/06-03-SUMMARY.md` with:
- CLI structure created (4 command groups, 13 commands)
- Command list with typer signatures
- Verification test results
- Any naming decisions (kebab-case usage)
</output>
