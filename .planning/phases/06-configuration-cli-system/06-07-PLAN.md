---
phase: 06-configuration-cli-system
plan: 07
type: execute
wave: 4
depends_on: ["06-04", "06-05", "06-06"]
files_modified:
  - analysis/cli/main.py
  - analysis/cli/chief.py
  - analysis/cli/patrol.py
  - analysis/cli/policy.py
  - analysis/cli/forecasting.py
autonomous: true

must_haves:
  truths:
    - "All 13 CLI commands show Rich progress bars with multiple stages"
    - "Progress bars have consistent styling (spinner, description, bar, percent, time remaining)"
    - "Commands show status messages with Rich console formatting"
    - "Error messages use Rich formatting for better readability"
  artifacts:
    - path: "analysis/cli/chief.py"
      provides: "Chief commands with Rich progress bars"
      contains: "Progress("
    - path: "analysis/cli/patrol.py"
      provides: "Patrol commands with Rich progress bars"
      contains: "Progress("
  key_links:
    - from: "analysis/cli/*.py"
      to: "rich.progress"
      via: "Progress import"
      pattern: "from.*rich.*import.*Progress"
    - from: "analysis/cli/*.py"
      to: "rich.console"
      via: "Console import"
      pattern: "from.*rich.*import.*Console"
---

<objective>
Integrate Rich progress bars across all 13 CLI commands with consistent styling and multi-stage feedback.

Purpose: Enhance user experience with beautiful, informative progress feedback for all long-running operations. This completes ARCH-05 (Rich/typer progress bars) requirement.

Output: All CLI commands showing Rich progress bars with consistent styling, color-coded status messages, and time estimates.
</objective>

<execution_context>
@/Users/dustinober/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dustinober/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/06-configuration-cli-system/06-RESEARCH.md
@.planning/phases/06-configuration-cli-system/06-04-SUMMARY.md
@.planning/phases/06-configuration-cli-system/06-05-SUMMARY.md
@.planning/phases/06-configuration-cli-system/06-06-SUMMARY.md

# Rich integration patterns from research
# https://textualize.io-rich-documentation
</context>

<tasks>

<task type="auto">
  <name>Task 1: Standardize Rich progress bar imports and setup</name>
  <files>
    - analysis/cli/chief.py
    - analysis/cli/patrol.py
    - analysis/cli/policy.py
    - analysis/cli/forecasting.py
  </files>
  <action>
    Ensure all CLI command files have consistent Rich imports and progress bar setup. Add/update imports at the top of each file:

    ```python
    # Rich imports (should be at top of each file)
    from rich.console import Console
    from rich.progress import Progress, SpinnerColumn, TextColumn, BarColumn, TaskProgressColumn, TimeRemainingColumn

    # Create console instance (one per file)
    console = Console()
    ```

    Verify that all command files (chief.py, patrol.py, policy.py, forecasting.py) have these imports. The main.py file should also have these imports.

    For any command that doesn't yet use Rich progress bars, add the progress context manager:

    ```python
    with Progress(
        SpinnerColumn(),
        TextColumn("[progress.description]{task.description}"),
        BarColumn(),
        TaskProgressColumn(),
        TimeRemainingColumn(),
        console=console,  # Use shared console instance
    ) as progress:
        # Progress stages here
    ```

    Do NOT modify command logic, only ensure consistent Rich usage patterns.
  </action>
  <verify>
    - `grep -r "from rich" analysis/cli/` shows Rich imports in all command files
    - `grep -r "Progress(" analysis/cli/*.py` shows Progress usage in all command files
  </verify>
  <done>
    All CLI command files have consistent Rich imports and Progress context manager setup.
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhance main CLI with Rich status messages</name>
  <files>analysis/cli/main.py</files>
  <action>
    Update `analysis/cli/main.py` to add Rich status messages for top-level commands:

    ```python
    """Main CLI application for crime analysis."""

    import typer
    from rich.console import Console
    from rich.table import Table
    from rich.panel import Panel

    # Import command groups
    from analysis.cli import chief, patrol, policy, forecasting

    # Create main app
    app = typer.Typer(
        name="crime-analysis",
        help="Philadelphia Crime Incidents Analysis CLI",
        no_args_is_help=True,
        add_completion=False,
    )

    # Rich console for output
    console = Console()

    # ... existing command group registration ...


    @app.command()
    def version() -> None:
        """Show version information."""
        # Create a formatted table for version info
        table = Table(title="Crime Analysis CLI", show_header=False)
        table.add_column("Component", style="cyan")
        table.add_column("Version", style="green")

        table.add_row("CLI Version", "v1.1")
        table.add_row("typer", f"[green]{typer.__version__}[/green]")
        table.add_row("Python", "[green]3.14+[/green]")

        console.print(table)


    @app.command()
    def info() -> None:
        """Show project information."""
        from pathlib import Path

        info_text = """
        [bold blue]Philadelphia Crime Incidents Analysis[/bold blue]

        [cyan]Data sources:[/cyan]
          * Philadelphia Police Department crime incidents
          * U.S. Census Bureau demographic data
          * City event schedules

        [cyan]Analysis areas:[/cyan]
          * Chief: High-level trends and seasonality
          * Patrol: Spatial hotspots and district severity
          * Policy: Retail theft, vehicle crimes, event impacts
          * Forecasting: Time series and violence classification

        [cyan]Reports directory:[/cyan] [green]reports/[/green]
        """

        panel = Panel(
            info_text.strip(),
            title="[bold]Project Information[/bold]",
            border_style="blue",
        )
        console.print(panel)
    ```

    Use Rich Table for version command and Panel for info command to improve visual presentation.
  </action>
  <verify>
    - `python -m analysis.cli version` shows formatted table with version info
    - `python -m analysis.cli info` shows formatted panel with project information
    - Output uses Rich styling (colors, formatting)
  </verify>
  <done>
    Top-level commands (version, info) use Rich formatting for better presentation.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add color-coded status messages to all commands</name>
  <files>
    - analysis/cli/chief.py
    - analysis/cli/patrol.py
    - analysis/cli/policy.py
    - analysis/cli/forecasting.py
  </files>
  <action>
    Enhance status messages in all commands with Rich color coding. Update console.print statements to use colors:

    Find and replace standard print/console.print statements with colored versions:

    - Success messages: `[green]:heavy_check_mark:[/green]` or `[bold green]Complete[/bold green]`
    - Warning messages: `[yellow]Warning:[/yellow]` or `[bold yellow]Attention[/bold yellow]`
    - Error messages: `[red]Error:[/red]` or `[bold red]Failed[/bold red]`
    - Info messages: `[cyan]Info:[/cyan]` or `[bold cyan]Processing[/bold cyan]`
    - Headers: `[bold blue]Analysis Name[/bold blue]`

    Example updates:

    ```python
    # Before
    console.print(f"Analysis complete")

    # After
    console.print("[green]:heavy_check_mark:[/green] [bold green]Analysis complete[/bold green]")

    # Before
    console.print(f"Warning: Could not load data")

    # After
    console.print("[yellow]Warning:[/yellow] Could not load data")

    # Before
    console.print(f"Hotspots Analysis")

    # After
    console.print("[bold blue]Hotspots Analysis[/bold blue]")
    ```

    Update at least these messages in each command:
    - Command header (analysis name) - bold blue
    - Completion message - green checkmark
    - Warning messages - yellow
    - Error handling messages - red
    - Output path display - cyan

    Do NOT change command logic, only enhance visual formatting of messages.
  </action>
  <verify>
    - Run `python -m analysis.cli chief trends --fast` and observe colored output
    - Run `python -m analysis.cli patrol hotspots --fast` and observe colored output
    - Check that success messages are green, warnings are yellow, headers are blue
  </verify>
  <done>
    All commands use Rich color-coded status messages for improved readability and user experience.
  </done>
</task>

<task type="auto">
  <name>Task 4: Add multi-task progress bars for complex operations</name>
  <files>
    - analysis/cli/chief.py
    - analysis/cli/patrol.py
  </files>
  <action>
    For complex commands with multiple independent operations, add multi-task progress bars that show concurrent progress.

    Update commands that perform multiple independent operations to use Rich's multi-task progress:

    Example for a command with multiple data sources:

    ```python
    @app.command()
    def example_complex_command(
        # ... parameters
    ) -> None:
        """Example command with multi-task progress."""
        from rich.progress import Progress, SpinnerColumn, TextColumn, BarColumn, TaskProgressColumn, TimeRemainingColumn

        console.print(f"[bold blue]Complex Analysis[/bold blue]")

        with Progress(
            SpinnerColumn(),
            TextColumn("[progress.description]{task.description}"),
            BarColumn(),
            TaskProgressColumn(),
            TimeRemainingColumn(),
        ) as progress:
            # Create multiple tasks upfront
            load_task = progress.add_task("Loading crime data...", total=100)
            boundary_task = progress.add_task("Loading boundaries...", total=100, visible=False)
            preprocess_task = progress.add_task("Preprocessing...", total=100, visible=False)
            analyze_task = progress.add_task("Analyzing...", total=100, visible=False)

            # Load crime data
            df = load_crime_data()
            progress.update(load_task, advance=100)

            # Show boundary task
            progress.update(boundary_task, visible=True)
            boundaries = load_boundaries()
            progress.update(boundary_task, advance=100)

            # Show preprocess task
            progress.update(preprocess_task, visible=True)
            df = preprocess(df)
            progress.update(preprocess_task, advance=100)

            # Show analyze task
            progress.update(analyze_task, visible=True)
            results = analyze(df, boundaries)
            progress.update(analyze_task, advance=100)

        console.print("[green]:heavy_check_mark:[/green] Complete")
    ```

    Apply multi-task progress to at least:
    - `chief trends`: Separate tasks for loading, preprocessing, analysis, output
    - `patrol hotspots`: Separate tasks for loading, coordinate cleaning, clustering, output

    Use `visible=False` initially for tasks, then set `visible=True` when the task starts. This creates a sequential multi-task progress display.
  </action>
  <verify>
    - `python -m analysis.cli chief trends --fast` shows multiple progress stages
    - `python -m analysis.cli patrol hotspots --fast` shows multiple progress stages
    - Progress bars appear sequentially as operations complete
  </verify>
  <done>
    Complex commands use multi-task progress bars showing all stages of the analysis pipeline.
  </done>
</task>

</tasks>

<verification>
After completing this plan:

1. Test Rich formatting in all command groups:
   - `python -m analysis.cli chief trends --fast`
   - `python -m analysis.cli patrol hotspots --fast`
   - `python -m analysis.cli policy retail-theft --fast`
   - `python -m analysis.cli forecasting time-series --fast`

2. Verify color-coded messages:
   - Headers are bold blue
   - Success messages are green
   - Warnings are yellow
   - Output paths are cyan

3. Verify progress bars:
   - All commands show Progress with spinner, description, bar, percent, time remaining
   - Multi-task progress shows sequential stages for complex commands

4. Test top-level commands:
   - `python -m analysis.cli version` shows formatted table
   - `python -m analysis.cli info` shows formatted panel

Expected outcome: Beautiful, informative CLI output with consistent Rich styling across all 13 commands.
</verification>

<success_criteria>
1. All 13 CLI commands use Rich progress bars with consistent column setup
2. Status messages use color coding (blue headers, green success, yellow warnings, red errors)
3. Top-level commands (version, info) use Rich Table and Panel
4. Multi-task progress bars show sequential stages for complex operations
5. Console output is visually appealing and informative
</success_criteria>

<output>
After completion, create `.planning/phases/06-configuration-cli-system/06-07-SUMMARY.md` with:
- Rich integration completed across all commands
- Progress bar column configuration documented
- Color coding scheme documented
- Multi-task progress usage patterns
- Screenshots or examples of CLI output (if possible)
- ARCH-05 requirement satisfied
</output>
