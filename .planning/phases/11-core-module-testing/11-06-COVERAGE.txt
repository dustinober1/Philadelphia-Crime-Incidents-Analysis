============================= test session starts ==============================
platform darwin -- Python 3.13.9, pytest-8.4.2, pluggy-1.5.0 -- /opt/anaconda3/bin/python3.13
cachedir: .pytest_cache
rootdir: /Users/dustinober/Projects/Crime Incidents Philadelphia
configfile: pyproject.toml
plugins: xdist-3.8.0, anyio-4.10.0, cov-7.0.0
collecting ... collected 322 items

tests/test_models_classification.py::TestCreateTimeAwareSplit::test_returns_four_split_dataframes FAILED [  0%]
tests/test_models_classification.py::TestCreateTimeAwareSplit::test_maintains_temporal_ordering FAILED [  0%]
tests/test_models_classification.py::TestCreateTimeAwareSplit::test_ensure_sorted_default_true FAILED [  0%]
tests/test_models_classification.py::TestCreateTimeAwareSplit::test_ensure_sorted_false_skips_sorting FAILED [  1%]
tests/test_models_classification.py::TestCreateTimeAwareSplit::test_custom_test_size FAILED [  1%]
tests/test_models_classification.py::TestCreateTimeAwareSplit::test_handles_duplicate_index_stably FAILED [  1%]
tests/test_models_classification.py::TestCreateTimeAwareSplit::test_x_y_length_mismatch_handled_silently PASSED [  2%]
tests/test_models_classification.py::TestCreateTimeAwareSplit::test_empty_dataframe_raises PASSED [  2%]
tests/test_models_classification.py::TestGetTimeSeriesCV::test_returns_time_series_split PASSED [  2%]
tests/test_models_classification.py::TestGetTimeSeriesCV::test_custom_n_splits PASSED [  3%]
tests/test_models_classification.py::TestGetTimeSeriesCV::test_custom_max_train_size PASSED [  3%]
tests/test_models_classification.py::TestGetTimeSeriesCV::test_default_parameters PASSED [  3%]
tests/test_models_classification.py::TestTrainRandomForest::test_returns_fitted_model_and_scaler FAILED [  4%]
tests/test_models_classification.py::TestTrainRandomForest::test_scale_features_false_returns_none_scaler FAILED [  4%]
tests/test_models_classification.py::TestTrainRandomForest::test_model_has_expected_attributes FAILED [  4%]
tests/test_models_classification.py::TestTrainRandomForest::test_scaler_fitted_correctly FAILED [  4%]
tests/test_models_classification.py::TestTrainRandomForest::test_custom_hyperparameters FAILED [  5%]
tests/test_models_classification.py::TestTrainRandomForest::test_random_state_reproducible FAILED [  5%]
tests/test_models_classification.py::TestExtractFeatureImportance::test_returns_dataframe_with_feature_importance FAILED [  5%]
tests/test_models_classification.py::TestExtractFeatureImportance::test_sorted_by_importance_descending FAILED [  6%]
tests/test_models_classification.py::TestExtractFeatureImportance::test_top_n_parameter FAILED [  6%]
tests/test_models_classification.py::TestExtractFeatureImportance::test_top_n_none_returns_all FAILED [  6%]
tests/test_models_classification.py::TestEvaluateClassifier::test_returns_confusion_matrix FAILED [  7%]
tests/test_models_classification.py::TestEvaluateClassifier::test_returns_classification_report FAILED [  7%]
tests/test_models_classification.py::TestEvaluateClassifier::test_with_probabilities_adds_roc_auc FAILED [  7%]
tests/test_models_classification.py::TestEvaluateClassifier::test_without_probabilities_no_roc_auc FAILED [  8%]
tests/test_models_classification.py::TestEvaluateClassifier::test_target_names_in_report FAILED [  8%]
tests/test_models_classification.py::TestEvaluateClassifier::test_single_class_roc_auc_handles_gracefully FAILED [  8%]
tests/test_models_classification.py::TestHandleClassImbalance::test_returns_dict_mapping_classes_to_weights FAILED [  9%]
tests/test_models_classification.py::TestHandleClassImbalance::test_balanced_weights_for_imbalanced_data FAILED [  9%]
tests/test_models_classification.py::TestHandleClassImbalance::test_all_classes_present_in_keys FAILED [  9%]
tests/test_models_classification.py::TestHandleClassImbalance::test_weights_inversely_proportional_to_frequency FAILED [  9%]
tests/test_models_classification.py::TestHandleClassImbalance::test_handles_binary_classification FAILED [ 10%]
tests/test_models_classification.py::TestHandleClassImbalance::test_handles_multiclass_classification FAILED [ 10%]
tests/test_models_classification.py::TestTrainXGBoost::test_returns_fitted_model_and_scaler FAILED [ 10%]
tests/test_models_classification.py::TestTrainXGBoost::test_scale_features_defaults_to_false FAILED [ 11%]
tests/test_models_classification.py::TestTrainXGBoost::test_custom_hyperparameters FAILED [ 11%]
tests/test_models_classification.py::TestTrainXGBoost::test_eval_metric_set_to_logloss FAILED [ 11%]
tests/test_models_time_series.py::TestPrepareProphetData::test_returns_prophet_format_columns FAILED [ 12%]
tests/test_models_time_series.py::TestPrepareProphetData::test_converts_date_column_to_datetime FAILED [ 12%]
tests/test_models_time_series.py::TestPrepareProphetData::test_sorts_by_date_ascending FAILED [ 12%]
tests/test_models_time_series.py::TestPrepareProphetData::test_resets_index_after_sorting FAILED [ 13%]
tests/test_models_time_series.py::TestPrepareProphetData::test_handles_duplicate_dates FAILED [ 13%]
tests/test_models_time_series.py::TestPrepareProphetData::test_handles_empty_dataframe FAILED [ 13%]
tests/test_models_time_series.py::TestPrepareProphetData::test_custom_date_column_name FAILED [ 13%]
tests/test_models_time_series.py::TestPrepareProphetData::test_custom_value_column_name FAILED [ 14%]
tests/test_models_time_series.py::TestCreateTrainTestSplit::test_requires_ds_column_raises_value_error PASSED [ 14%]
tests/test_models_time_series.py::TestCreateTrainTestSplit::test_splits_by_date_cutoff FAILED [ 14%]
tests/test_models_time_series.py::TestCreateTrainTestSplit::test_custom_test_days_parameter FAILED [ 15%]
tests/test_models_time_series.py::TestCreateTrainTestSplit::test_test_days_30_default FAILED [ 15%]
tests/test_models_time_series.py::TestCreateTrainTestSplit::test_no_overlap_between_train_and_test FAILED [ 15%]
tests/test_models_time_series.py::TestCreateTrainTestSplit::test_handles_exact_boundary FAILED [ 16%]
tests/test_models_time_series.py::TestGetProphetConfig::test_default_configuration PASSED [ 16%]
tests/test_models_time_series.py::TestGetProphetConfig::test_seasonality_mode_additive PASSED [ 16%]
tests/test_models_time_series.py::TestGetProphetConfig::test_seasonality_mode_multiplicative PASSED [ 17%]
tests/test_models_time_series.py::TestGetProphetConfig::test_yearly_seasonality_parameter PASSED [ 17%]
tests/test_models_time_series.py::TestGetProphetConfig::test_weekly_seasonality_parameter PASSED [ 17%]
tests/test_models_time_series.py::TestGetProphetConfig::test_daily_seasonality_parameter PASSED [ 18%]
tests/test_models_time_series.py::TestGetProphetConfig::test_changepoint_prior_scale_parameter PASSED [ 18%]
tests/test_models_time_series.py::TestGetProphetConfig::test_interval_width_parameter PASSED [ 18%]
tests/test_models_time_series.py::TestGetProphetConfig::test_all_parameters_combination PASSED [ 18%]
tests/test_models_time_series.py::TestEvaluateForecast::test_perfect_forecast_returns_ideal_metrics PASSED [ 19%]
tests/test_models_time_series.py::TestEvaluateForecast::test_constant_bias_captured_in_bias_metric PASSED [ 19%]
tests/test_models_time_series.py::TestEvaluateForecast::test_mae_calculation PASSED [ 19%]
tests/test_models_time_series.py::TestEvaluateForecast::test_rmse_calculation PASSED [ 20%]
tests/test_models_time_series.py::TestEvaluateForecast::test_r2_calculation PASSED [ 20%]
tests/test_models_time_series.py::TestEvaluateForecast::test_mape_calculation PASSED [ 20%]
tests/test_models_time_series.py::TestEvaluateForecast::test_nan_handling_filters_nan_pairs PASSED [ 21%]
tests/test_models_time_series.py::TestEvaluateForecast::test_coverage_with_prediction_intervals PASSED [ 21%]
tests/test_models_time_series.py::TestEvaluateForecast::test_coverage_not_computed_without_intervals PASSED [ 21%]
tests/test_models_time_series.py::TestEvaluateForecast::test_returns_dict_with_all_expected_keys PASSED [ 22%]
tests/test_models_time_series.py::TestDetectAnomalies::test_returns_boolean_series PASSED [ 22%]
tests/test_models_time_series.py::TestDetectAnomalies::test_threshold_anomaly_detection PASSED [ 22%]
tests/test_models_time_series.py::TestDetectAnomalies::test_interval_anomaly_detection PASSED [ 22%]
tests/test_models_time_series.py::TestDetectAnomalies::test_custom_threshold_std_parameter PASSED [ 23%]
tests/test_models_time_series.py::TestDetectAnomalies::test_custom_column_names PASSED [ 23%]
tests/test_models_time_series.py::TestDetectAnomalies::test_handles_empty_dataframe PASSED [ 23%]
tests/test_models_time_series.py::TestDetectAnomalies::test_all_anomalies_when_all_outside_interval PASSED [ 24%]
tests/test_models_validation.py::TestTimeSeriesCVScore::test_returns_dict_with_scores_statistics FAILED [ 24%]
tests/test_models_validation.py::TestTimeSeriesCVScore::test_scores_array_length_matches_n_splits FAILED [ 24%]
tests/test_models_validation.py::TestTimeSeriesCVScore::test_mean_computed_correctly FAILED [ 25%]
tests/test_models_validation.py::TestTimeSeriesCVScore::test_std_computed_correctly FAILED [ 25%]
tests/test_models_validation.py::TestTimeSeriesCVScore::test_custom_n_splits_parameter FAILED [ 25%]
tests/test_models_validation.py::TestTimeSeriesCVScore::test_custom_scoring_parameter FAILED [ 26%]
tests/test_models_validation.py::TestTimeSeriesCVScore::test_default_scoring_neg_mean_absolute_error FAILED [ 26%]
tests/test_models_validation.py::TestComputeRegressionMetrics::test_returns_dict_with_expected_metrics PASSED [ 26%]
tests/test_models_validation.py::TestComputeRegressionMetrics::test_mae_calculation_with_synthetic_data PASSED [ 27%]
tests/test_models_validation.py::TestComputeRegressionMetrics::test_rmse_calculation_with_synthetic_data PASSED [ 27%]
tests/test_models_validation.py::TestComputeRegressionMetrics::test_r2_calculation_perfect_prediction PASSED [ 27%]
tests/test_models_validation.py::TestComputeRegressionMetrics::test_mape_calculation_with_synthetic_data PASSED [ 27%]
tests/test_models_validation.py::TestComputeRegressionMetrics::test_bias_calculation PASSED [ 28%]
tests/test_models_validation.py::TestComputeRegressionMetrics::test_prefix_added_to_all_metrics PASSED [ 28%]
tests/test_models_validation.py::TestComputeRegressionMetrics::test_empty_prefix_no_underscore PASSED [ 28%]
tests/test_models_validation.py::TestComputeRegressionMetrics::test_raises_error_with_nan_values PASSED [ 29%]
tests/test_models_validation.py::TestComputeForecastAccuracy::test_includes_all_regression_metrics PASSED [ 29%]
tests/test_models_validation.py::TestComputeForecastAccuracy::test_mase_with_naive_forecast PASSED [ 29%]
tests/test_models_validation.py::TestComputeForecastAccuracy::test_mase_with_seasonal_naive_forecast PASSED [ 30%]
tests/test_models_validation.py::TestComputeForecastAccuracy::test_mase_infinite_when_naive_error_zero PASSED [ 30%]
tests/test_models_validation.py::TestComputeForecastAccuracy::test_naive_forecast_uses_diff PASSED [ 30%]
tests/test_models_validation.py::TestCreateModelCard::test_returns_dict_with_expected_fields PASSED [ 31%]
tests/test_models_validation.py::TestCreateModelCard::test_n_features_matches_feature_list_length PASSED [ 31%]
tests/test_models_validation.py::TestCreateModelCard::test_train_metrics_preserved PASSED [ 31%]
tests/test_models_validation.py::TestCreateModelCard::test_test_metrics_preserved PASSED [ 31%]
tests/test_models_validation.py::TestCreateModelCard::test_limitations_default_to_empty_list PASSED [ 32%]
tests/test_models_validation.py::TestCreateModelCard::test_created_at_is_isoformat_timestamp PASSED [ 32%]
tests/test_models_validation.py::TestCreateModelCard::test_custom_limitations_preserved PASSED [ 32%]
tests/test_models_validation.py::TestCheckResidualAutocorrelation::test_returns_dict_with_diagnostics PASSED [ 33%]
tests/test_models_validation.py::TestCheckResidualAutocorrelation::test_ljung_box_pvalues_array_exists PASSED [ 33%]
tests/test_models_validation.py::TestCheckResidualAutocorrelation::test_significant_lags_count_exists PASSED [ 33%]
tests/test_models_validation.py::TestCheckResidualAutocorrelation::test_autocorrelation_detected_boolean_exists PASSED [ 34%]
tests/test_models_validation.py::TestCheckResidualAutocorrelation::test_handles_statsmodels_import_error PASSED [ 34%]
tests/test_models_validation.py::TestCheckResidualAutocorrelation::test_handles_short_residual_series PASSED [ 34%]
tests/test_models_validation.py::TestCheckResidualAutocorrelation::test_custom_max_lag_parameter PASSED [ 35%]
tests/test_models_validation.py::TestValidateTemporalSplit::test_returns_dict_with_validation_results FAILED [ 35%]
tests/test_models_validation.py::TestValidateTemporalSplit::test_valid_temporal_order_true_when_sorted FAILED [ 35%]
tests/test_models_validation.py::TestValidateTemporalSplit::test_valid_temporal_order_false_when_overlap FAILED [ 36%]
tests/test_models_validation.py::TestValidateTemporalSplit::test_gap_days_calculation FAILED [ 36%]
tests/test_models_validation.py::TestValidateTemporalSplit::test_sufficient_gap_true_when_gap_met FAILED [ 36%]
tests/test_models_validation.py::TestValidateTemporalSplit::test_sufficient_gap_false_when_gap_insufficient FAILED [ 36%]
tests/test_models_validation.py::TestValidateTemporalSplit::test_train_size_test_size_counts FAILED [ 37%]
tests/test_models_validation.py::TestValidateTemporalSplit::test_test_ratio_calculation FAILED [ 37%]
tests/test_models_validation.py::TestValidateTemporalSplit::test_custom_min_gap_days_parameter FAILED [ 37%]
tests/test_models_validation.py::TestValidateTemporalSplit::test_handles_datetime_series FAILED [ 38%]
tests/test_models_validation.py::TestWalkForwardValidation::test_returns_dataframe_with_results PASSED [ 38%]
tests/test_models_validation.py::TestWalkForwardValidation::test_dataframe_has_expected_columns PASSED [ 38%]
tests/test_models_validation.py::TestWalkForwardValidation::test_initial_train_size_parameter PASSED [ 39%]
tests/test_models_validation.py::TestWalkForwardValidation::test_step_size_parameter PASSED [ 39%]
tests/test_models_validation.py::TestWalkForwardValidation::test_custom_metric_function PASSED [ 39%]
tests/test_models_validation.py::TestWalkForwardValidation::test_stops_before_end_of_data PASSED [ 40%]
tests/test_models_validation.py::TestWalkForwardValidation::test_handles_empty_test_set_break PASSED [ 40%]
tests/test_models_validation.py::TestWalkForwardValidation::test_predictions_and_actuals_stored PASSED [ 40%]
tests/test_data_cache.py::TestMemoryInstance::test_memory_instance_exists PASSED [ 40%]
tests/test_data_cache.py::TestMemoryInstance::test_memory_has_location_attribute PASSED [ 41%]
tests/test_data_cache.py::TestMemoryInstance::test_memory_location_points_to_cache_dir PASSED [ 41%]
tests/test_data_cache.py::TestMemoryInstance::test_memory_verbose_is_zero PASSED [ 41%]
tests/test_data_cache.py::TestClearCache::test_clear_cache_removes_cached_files PASSED [ 42%]
tests/test_data_cache.py::TestClearCache::test_clear_cache_prints_confirmation PASSED [ 42%]
tests/test_data_cache.py::TestClearCache::test_clear_cache_handles_nonexistent_cache PASSED [ 42%]
tests/test_data_cache.py::TestClearCache::test_clear_cache_preserves_cache_directory PASSED [ 43%]
tests/test_data_cache.py::TestCacheDirectory::test_cache_dir_exists_after_import PASSED [ 43%]
tests/test_data_cache.py::TestCacheDirectory::test_cache_dir_is_absolute_path PASSED [ 43%]
tests/test_data_cache.py::TestCacheDirectory::test_cache_dir_name_is_joblib PASSED [ 44%]
tests/test_data_cache.py::TestCacheDirectory::test_cache_dir_under_project_cache PASSED [ 44%]
tests/test_data_loading.py::TestLoadCrimeData::test_returns_dataframe FAILED [ 44%]
tests/test_data_loading.py::TestLoadCrimeData::test_dataframe_not_empty FAILED [ 45%]
tests/test_data_loading.py::TestLoadCrimeData::test_has_expected_columns FAILED [ 45%]
tests/test_data_loading.py::TestLoadCrimeData::test_clean_parameter_defaults_to_true FAILED [ 45%]
tests/test_data_loading.py::TestLoadCrimeData::test_clean_false_includes_all_rows FAILED [ 45%]
tests/test_data_loading.py::TestLoadCrimeData::test_dispatch_date_is_datetime FAILED [ 46%]
tests/test_data_loading.py::TestLoadCrimeData::test_cache_performance_speedup FAILED [ 46%]
tests/test_data_loading.py::TestLoadCrimeData::test_cache_persists_across_calls FAILED [ 46%]
tests/test_data_loading.py::TestLoadCrimeData::test_cache_key_different_for_clean_parameter FAILED [ 47%]
tests/test_data_loading.py::TestCacheDirectory::test_cache_directory_exists FAILED [ 47%]
tests/test_data_loading.py::TestCacheDirectory::test_clear_cache_removes_cached_files FAILED [ 47%]
tests/test_data_loading.py::TestLoadBoundaries::test_raises_import_error_without_geopandas PASSED [ 48%]
tests/test_data_loading.py::TestLoadBoundaries::test_invalid_boundary_name_raises_value_error PASSED [ 48%]
tests/test_data_loading.py::TestLoadBoundaries::test_load_police_districts_returns_geodataframe FAILED [ 48%]
tests/test_data_loading.py::TestLoadBoundaries::test_load_census_tracts_returns_geodataframe SKIPPED [ 49%]
tests/test_data_loading.py::TestLoadExternalData::test_nonexistent_file_raises_file_not_found_error PASSED [ 49%]
tests/test_data_loading.py::TestLoadExternalData::test_loads_existing_csv_file SKIPPED [ 49%]
tests/test_data_loading.py::TestInternalLoadFunctions::test_load_crime_data_parquet_decorated_with_cache PASSED [ 50%]
tests/test_data_loading.py::TestInternalLoadFunctions::test_internal_function_returns_dataframe FAILED [ 50%]
tests/test_data_loading.py::TestMemoryInstance::test_memory_instance_exists PASSED [ 50%]
tests/test_data_loading.py::TestMemoryInstance::test_memory_location_is_cache_dir PASSED [ 50%]
tests/test_data_loading.py::TestGeopandasImport::test_has_geopandas_is_bool PASSED [ 51%]
tests/test_data_loading.py::TestFileNotFoundError::test_load_crime_data_raises_file_not_found PASSED [ 51%]
tests/test_data_loading.py::TestFileNotFoundError::test_load_boundaries_raises_file_not_found PASSED [ 51%]
tests/test_data_loading.py::TestFileNotFoundError::test_internal_function_raises_file_not_found PASSED [ 52%]
tests/test_data_loading.py::TestDatetimeParsing::test_dispatch_date_parsed_from_category_dtype PASSED [ 52%]
tests/test_data_loading.py::TestDatetimeParsing::test_dispatch_date_parsed_from_string_dtype PASSED [ 52%]
tests/test_data_loading.py::TestDatetimeParsing::test_dispatch_date_with_invalid_values FAILED [ 53%]
tests/test_data_loading.py::TestCleanParameter::test_clean_false_preserves_null_dates FAILED [ 53%]
tests/test_data_loading.py::TestCleanParameter::test_clean_true_drops_null_dates FAILED [ 53%]
tests/test_data_loading.py::TestBoundaryNameValidation::test_invalid_boundary_name_raises_value_error PASSED [ 54%]
tests/test_data_loading.py::TestBoundaryNameValidation::test_boundary_name_case_sensitivity PASSED [ 54%]
tests/test_data_loading.py::TestBoundaryNameValidation::test_valid_boundary_names_accepted PASSED [ 54%]
tests/test_data_preprocessing.py::TestFilterByDateRange::test_filter_by_start_and_end_date FAILED [ 54%]
tests/test_data_preprocessing.py::TestFilterByDateRange::test_filter_by_start_date_only FAILED [ 55%]
tests/test_data_preprocessing.py::TestFilterByDateRange::test_filter_by_end_date_only FAILED [ 55%]
tests/test_data_preprocessing.py::TestFilterByDateRange::test_no_filter_when_no_bounds PASSED [ 55%]
tests/test_data_preprocessing.py::TestFilterByDateRange::test_empty_result_when_no_rows_in_range PASSED [ 56%]
tests/test_data_preprocessing.py::TestFilterByDateRange::test_preserves_all_columns FAILED [ 56%]
tests/test_data_preprocessing.py::TestFilterByDateRange::test_returns_copy_not_view FAILED [ 56%]
tests/test_data_preprocessing.py::TestFilterByDateRange::test_string_date_column FAILED [ 57%]
tests/test_data_preprocessing.py::TestFilterByDateRange::test_custom_date_column FAILED [ 57%]
tests/test_data_preprocessing.py::TestFilterByDateRange::test_missing_date_column_raises_value_error PASSED [ 57%]
tests/test_data_preprocessing.py::TestFilterByDateRange::test_invalid_date_format PASSED [ 58%]
tests/test_data_preprocessing.py::TestAggregateByPeriod::test_daily_aggregation FAILED [ 58%]
tests/test_data_preprocessing.py::TestAggregateByPeriod::test_weekly_aggregation FAILED [ 58%]
tests/test_data_preprocessing.py::TestAggregateByPeriod::test_monthly_aggregation FAILED [ 59%]
tests/test_data_preprocessing.py::TestAggregateByPeriod::test_yearly_aggregation FAILED [ 59%]
tests/test_data_preprocessing.py::TestAggregateByPeriod::test_count_column_named_correctly FAILED [ 59%]
tests/test_data_preprocessing.py::TestAggregateByPeriod::test_count_values_are_correct FAILED [ 59%]
tests/test_data_preprocessing.py::TestAggregateByPeriod::test_custom_count_column FAILED [ 60%]
tests/test_data_preprocessing.py::TestAggregateByPeriod::test_custom_date_column FAILED [ 60%]
tests/test_data_preprocessing.py::TestAggregateByPeriod::test_missing_date_column_raises_value_error PASSED [ 60%]
tests/test_data_preprocessing.py::TestAggregateByPeriod::test_missing_count_column_raises_value_error PASSED [ 61%]
tests/test_data_preprocessing.py::TestAggregateByPeriod::test_empty_dataframe_returns_empty FAILED [ 61%]
tests/test_data_preprocessing.py::TestAggregateByPeriod::test_month_start_aggregation FAILED [ 61%]
tests/test_data_preprocessing.py::TestAddTemporalFeatures::test_adds_temporal_features PASSED [ 62%]
tests/test_data_preprocessing.py::TestAddTemporalFeatures::test_year_values_are_correct PASSED [ 62%]
tests/test_data_preprocessing.py::TestAddTemporalFeatures::test_month_values_are_correct PASSED [ 62%]
tests/test_data_preprocessing.py::TestAddTemporalFeatures::test_day_values_are_correct PASSED [ 63%]
tests/test_data_preprocessing.py::TestAddTemporalFeatures::test_day_of_week_values_are_correct PASSED [ 63%]
tests/test_data_preprocessing.py::TestAddTemporalFeatures::test_preserves_original_columns PASSED [ 63%]
tests/test_data_preprocessing.py::TestAddTemporalFeatures::test_returns_copy_not_view PASSED [ 63%]
tests/test_data_preprocessing.py::TestAddTemporalFeatures::test_empty_dataframe PASSED [ 64%]
tests/test_data_preprocessing.py::TestAddTemporalFeatures::test_dispatch_date_column PASSED [ 64%]
tests/test_data_preprocessing.py::TestAddTemporalFeatures::test_dispatch_datetime_column_exists PASSED [ 64%]
tests/test_data_validation.py::TestCoordinateBoundsConstants::test_philly_lon_min PASSED [ 65%]
tests/test_data_validation.py::TestCoordinateBoundsConstants::test_philly_lon_max PASSED [ 65%]
tests/test_data_validation.py::TestCoordinateBoundsConstants::test_philly_lat_min PASSED [ 65%]
tests/test_data_validation.py::TestCoordinateBoundsConstants::test_philly_lat_max PASSED [ 66%]
tests/test_data_validation.py::TestCrimeIncidentValidatorValidData::test_valid_incident_with_all_fields PASSED [ 66%]
tests/test_data_validation.py::TestCrimeIncidentValidatorValidData::test_valid_incident_with_required_fields_only PASSED [ 66%]
tests/test_data_validation.py::TestCrimeIncidentValidatorValidData::test_valid_ucr_code_in_expanded_format PASSED [ 67%]
tests/test_data_validation.py::TestCrimeIncidentValidatorValidData::test_valid_psa_as_letter_code PASSED [ 67%]
tests/test_data_validation.py::TestCrimeIncidentValidatorValidData::test_valid_psa_as_string_number PASSED [ 67%]
tests/test_data_validation.py::TestCrimeIncidentValidatorValidData::test_valid_coordinates_within_philly_bounds PASSED [ 68%]
tests/test_data_validation.py::TestCrimeIncidentValidatorValidData::test_valid_datetime_string PASSED [ 68%]
tests/test_data_validation.py::TestCrimeIncidentValidatorValidData::test_none_values_for_optional_fields PASSED [ 68%]
tests/test_data_validation.py::TestCrimeIncidentValidatorValidData::test_boundary_case_minimum_coordinates PASSED [ 68%]
tests/test_data_validation.py::TestCrimeIncidentValidatorValidData::test_boundary_case_maximum_coordinates PASSED [ 69%]
tests/test_data_validation.py::TestCrimeIncidentValidatorInvalidData::test_invalid_ucr_code_below_minimum PASSED [ 69%]
tests/test_data_validation.py::TestCrimeIncidentValidatorInvalidData::test_invalid_ucr_code_above_maximum PASSED [ 69%]
tests/test_data_validation.py::TestCrimeIncidentValidatorInvalidData::test_invalid_longitude_below_minimum PASSED [ 70%]
tests/test_data_validation.py::TestCrimeIncidentValidatorInvalidData::test_invalid_longitude_above_maximum PASSED [ 70%]
tests/test_data_validation.py::TestCrimeIncidentValidatorInvalidData::test_invalid_latitude_below_minimum PASSED [ 70%]
tests/test_data_validation.py::TestCrimeIncidentValidatorInvalidData::test_invalid_latitude_above_maximum PASSED [ 71%]
tests/test_data_validation.py::TestCrimeIncidentValidatorInvalidData::test_invalid_datetime_string PASSED [ 71%]
tests/test_data_validation.py::TestCrimeIncidentValidatorInvalidData::test_missing_required_field_dispatch_date PASSED [ 71%]
tests/test_data_validation.py::TestValidateCoordinates::test_valid_philly_coordinates_pass PASSED [ 72%]
tests/test_data_validation.py::TestValidateCoordinates::test_invalid_coordinates_filtered_out FAILED [ 72%]
tests/test_data_validation.py::TestValidateCoordinates::test_none_coordinates_filtered_out FAILED [ 72%]
tests/test_data_validation.py::TestValidateCoordinates::test_boundary_case_edge_coordinates PASSED [ 72%]
tests/test_data_validation.py::TestValidateCoordinates::test_boundary_case_just_outside_bounds PASSED [ 73%]
tests/test_data_validation.py::TestValidateCoordinates::test_custom_column_names PASSED [ 73%]
tests/test_data_validation.py::TestValidateCoordinates::test_missing_x_column_raises_value_error PASSED [ 73%]
tests/test_data_validation.py::TestValidateCoordinates::test_missing_y_column_raises_value_error PASSED [ 74%]
tests/test_data_validation.py::TestValidateCoordinates::test_custom_bounds PASSED [ 74%]
tests/test_data_validation.py::TestValidateCrimeData::test_valid_sample_dataframe_passes PASSED [ 74%]
tests/test_data_validation.py::TestValidateCrimeData::test_strict_mode_validates_all_rows PASSED [ 75%]
tests/test_data_validation.py::TestValidateCrimeData::test_invalid_dataframe_raises_value_error PASSED [ 75%]
tests/test_data_validation.py::TestValidateCrimeData::test_error_details_in_error_message PASSED [ 75%]
tests/test_data_validation.py::TestValidateCrimeData::test_empty_dataframe_raises_value_error PASSED [ 76%]
tests/test_data_validation.py::TestValidateCrimeData::test_sample_size_parameter_limits_validation FAILED [ 76%]
tests/test_data_validation.py::TestValidateCrimeData::test_returns_validated_dataframe PASSED [ 76%]
tests/test_data_validation.py::TestValidateCrimeData::test_strict_mode_with_large_dataset PASSED [ 77%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_filters_valid_philadelphia_coordinates FAILED [ 77%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_filters_out_nan_coordinates FAILED [ 77%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_filters_out_out_of_bounds_lon[-75.3-True] PASSED [ 77%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_filters_out_out_of_bounds_lon[-74.95-True] PASSED [ 78%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_filters_out_out_of_bounds_lon[-75.31-False] PASSED [ 78%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_filters_out_out_of_bounds_lon[-74.94-False] PASSED [ 78%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_filters_out_out_of_bounds_lon[-100.0-False] PASSED [ 79%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_filters_out_out_of_bounds_lat[39.85-True] PASSED [ 79%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_filters_out_out_of_bounds_lat[40.15-True] PASSED [ 79%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_filters_out_out_of_bounds_lat[39.84-False] PASSED [ 80%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_filters_out_out_of_bounds_lat[40.16-False] PASSED [ 80%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_filters_out_out_of_bounds_lat[50.0-False] PASSED [ 80%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_custom_x_col_parameter PASSED [ 81%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_custom_y_col_parameter PASSED [ 81%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_missing_columns_raises_value_error PASSED [ 81%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_returns_copy_not_view PASSED [ 81%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_preserves_original_columns PASSED [ 82%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_handles_empty_dataframe PASSED [ 82%]
tests/test_utils_spatial.py::TestCleanCoordinates::test_all_invalid_returns_empty PASSED [ 82%]
tests/test_utils_spatial.py::TestCalculateSeverityScore::test_ucr_100_band_returns_10_severity PASSED [ 83%]
tests/test_utils_spatial.py::TestCalculateSeverityScore::test_ucr_200_band_returns_8_severity PASSED [ 83%]
tests/test_utils_spatial.py::TestCalculateSeverityScore::test_ucr_300_band_returns_6_severity PASSED [ 83%]
tests/test_utils_spatial.py::TestCalculateSeverityScore::test_ucr_400_band_returns_5_severity PASSED [ 84%]
tests/test_utils_spatial.py::TestCalculateSeverityScore::test_ucr_500_band_returns_3_severity PASSED [ 84%]
tests/test_utils_spatial.py::TestCalculateSeverityScore::test_ucr_600_band_returns_1_severity PASSED [ 84%]
tests/test_utils_spatial.py::TestCalculateSeverityScore::test_ucr_700_band_returns_2_severity PASSED [ 85%]
tests/test_utils_spatial.py::TestCalculateSeverityScore::test_ucr_800_band_returns_4_severity PASSED [ 85%]
tests/test_utils_spatial.py::TestCalculateSeverityScore::test_unknown_ucr_defaults_to_0_5 PASSED [ 85%]
tests/test_utils_spatial.py::TestCalculateSeverityScore::test_custom_weights_override_defaults PASSED [ 86%]
tests/test_utils_spatial.py::TestCalculateSeverityScore::test_nan_ucr_code_defaults_to_0_5 PASSED [ 86%]
tests/test_utils_spatial.py::TestCalculateSeverityScore::test_custom_ucr_col_parameter PASSED [ 86%]
tests/test_utils_spatial.py::TestCalculateSeverityScore::test_missing_ucr_col_raises_value_error PASSED [ 86%]
tests/test_utils_spatial.py::TestCalculateSeverityScore::test_returns_series PASSED [ 87%]
tests/test_utils_spatial.py::TestGetCoordinateStats::test_returns_dict_with_expected_keys PASSED [ 87%]
tests/test_utils_spatial.py::TestGetCoordinateStats::test_total_records_matches_input_length PASSED [ 87%]
tests/test_utils_spatial.py::TestGetCoordinateStats::test_has_coordinates_counts_valid_coords FAILED [ 88%]
tests/test_utils_spatial.py::TestGetCoordinateStats::test_in_philadelphia_bounds_counts_valid_coords FAILED [ 88%]
tests/test_utils_spatial.py::TestGetCoordinateStats::test_coverage_rate_calculation FAILED [ 88%]
tests/test_utils_spatial.py::TestGetCoordinateStats::test_in_bounds_rate_calculation FAILED [ 89%]
tests/test_utils_spatial.py::TestGetCoordinateStats::test_lon_min_max_calculations PASSED [ 89%]
tests/test_utils_spatial.py::TestGetCoordinateStats::test_lat_min_max_calculations PASSED [ 89%]
tests/test_utils_spatial.py::TestGetCoordinateStats::test_empty_dataframe_returns_zero_stats PASSED [ 90%]
tests/test_utils_spatial.py::TestGetCoordinateStats::test_custom_x_col_y_col_parameters PASSED [ 90%]
tests/test_utils_spatial.py::TestGetCoordinateStats::test_all_nan_coordinates_returns_zero_coverage PASSED [ 90%]
tests/test_utils_spatial.py::TestDfToGeodataframe::test_returns_geodataframe PASSED [ 90%]
tests/test_utils_spatial.py::TestDfToGeodataframe::test_geometry_column_created PASSED [ 91%]
tests/test_utils_spatial.py::TestDfToGeodataframe::test_default_crs_is_epsg_4326 PASSED [ 91%]
tests/test_utils_spatial.py::TestDfToGeodataframe::test_custom_crs_parameter PASSED [ 91%]
tests/test_utils_spatial.py::TestDfToGeodataframe::test_nan_coordinates_create_none_geometry PASSED [ 92%]
tests/test_utils_spatial.py::TestDfToGeodataframe::test_custom_x_col_y_col_parameters PASSED [ 92%]
tests/test_utils_spatial.py::TestDfToGeodataframe::test_preserves_original_columns PASSED [ 92%]
tests/test_utils_spatial.py::TestLoadBoundaries::test_load_police_districts_returns_geodataframe PASSED [ 93%]
tests/test_utils_spatial.py::TestLoadBoundaries::test_load_census_tracts_returns_geodataframe PASSED [ 93%]
tests/test_utils_spatial.py::TestLoadBoundaries::test_load_census_tracts_pop_alias PASSED [ 93%]
tests/test_utils_spatial.py::TestLoadBoundaries::test_unknown_boundary_raises_value_error PASSED [ 94%]
tests/test_utils_spatial.py::TestLoadBoundaries::test_file_not_found_raises_file_not_found_error PASSED [ 94%]
tests/test_utils_spatial.py::TestLoadBoundaries::test_mock_file_path_uses_repo_root PASSED [ 94%]
tests/test_utils_spatial.py::TestSpatialJoinDistricts::test_returns_dataframe_with_joined_dist_num FAILED [ 95%]
tests/test_utils_spatial.py::TestSpatialJoinDistricts::test_calls_clean_coordinates_internally FAILED [ 95%]
tests/test_utils_spatial.py::TestSpatialJoinDistricts::test_calls_df_to_geodataframe_internally FAILED [ 95%]
tests/test_utils_spatial.py::TestSpatialJoinDistricts::test_drops_index_right_column FAILED [ 95%]
tests/test_utils_spatial.py::TestSpatialJoinDistricts::test_drops_geometry_column FAILED [ 96%]
tests/test_utils_spatial.py::TestSpatialJoinDistricts::test_custom_x_col_y_col_parameters FAILED [ 96%]
tests/test_utils_spatial.py::TestSpatialJoinDistricts::test_provided_district_gdf_used FAILED [ 96%]
tests/test_utils_spatial.py::TestSpatialJoinDistricts::test_handles_crs_mismatch FAILED [ 97%]
tests/test_utils_spatial.py::TestSpatialJoinTracts::test_returns_dataframe_with_tract_columns FAILED [ 97%]
tests/test_utils_spatial.py::TestSpatialJoinTracts::test_calls_clean_coordinates_internally FAILED [ 97%]
tests/test_utils_spatial.py::TestSpatialJoinTracts::test_calls_df_to_geodataframe_internally FAILED [ 98%]
tests/test_utils_spatial.py::TestSpatialJoinTracts::test_drops_index_right_column FAILED [ 98%]
tests/test_utils_spatial.py::TestSpatialJoinTracts::test_drops_geometry_column FAILED [ 98%]
tests/test_utils_spatial.py::TestSpatialJoinTracts::test_custom_x_col_y_col_parameters FAILED [ 99%]
tests/test_utils_spatial.py::TestSpatialJoinTracts::test_provided_tract_gdf_used FAILED [ 99%]
tests/test_utils_spatial.py::TestSpatialJoinTracts::test_handles_crs_mismatch FAILED [ 99%]
tests/test_utils_spatial.py::TestSpatialJoinTracts::test_handles_missing_tract_columns FAILED [100%]

=================================== FAILURES ===================================
_________ TestCreateTimeAwareSplit.test_returns_four_split_dataframes __________

self = <test_models_classification.TestCreateTimeAwareSplit object at 0x15ac52d50>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15ae674d0>

    def test_returns_four_split_dataframes(self, sample_crime_df):
        """Verify function returns (X_train, X_test, y_train, y_test) tuple."""
>       X = sample_crime_df[["point_x", "point_y"]]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
__________ TestCreateTimeAwareSplit.test_maintains_temporal_ordering ___________

self = <test_models_classification.TestCreateTimeAwareSplit object at 0x15ac53250>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15aeafb10>

    def test_maintains_temporal_ordering(self, sample_crime_df):
        """Verify train data ends before test data begins (no leakage)."""
>       X = sample_crime_df.set_index("dispatch_date")[["point_x", "point_y"]]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:50: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:6208: in set_index
    del frame[c]
        ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4529: in __delitem__
    self._mgr = self._mgr.idelete(loc)
                ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:1461: in idelete
    nbs = self._slice_take_blocks_ax0(taker, only_slice=True, ref_inplace_op=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
___________ TestCreateTimeAwareSplit.test_ensure_sorted_default_true ___________

self = <test_models_classification.TestCreateTimeAwareSplit object at 0x15acbb490>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15af26780>

    def test_ensure_sorted_default_true(self, sample_crime_df):
        """Verify data sorted by index when ensure_sorted=True (default)."""
        # Create unsorted data with datetime index
>       X = sample_crime_df.set_index("dispatch_date")[["point_x", "point_y"]].sample(frac=1, random_state=42)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:64: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:6208: in set_index
    del frame[c]
        ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4529: in __delitem__
    self._mgr = self._mgr.idelete(loc)
                ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:1461: in idelete
    nbs = self._slice_take_blocks_ax0(taker, only_slice=True, ref_inplace_op=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_______ TestCreateTimeAwareSplit.test_ensure_sorted_false_skips_sorting ________

self = <test_models_classification.TestCreateTimeAwareSplit object at 0x15acbb6f0>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15aec2330>

    def test_ensure_sorted_false_skips_sorting(self, sample_crime_df):
        """Verify sorting skipped when ensure_sorted=False."""
        # Create unsorted data
>       X_shuffled = sample_crime_df.set_index("dispatch_date")[["point_x", "point_y"]].sample(frac=1, random_state=42)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:76: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:6208: in set_index
    del frame[c]
        ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4529: in __delitem__
    self._mgr = self._mgr.idelete(loc)
                ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:1461: in idelete
    nbs = self._slice_take_blocks_ax0(taker, only_slice=True, ref_inplace_op=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
________________ TestCreateTimeAwareSplit.test_custom_test_size ________________

self = <test_models_classification.TestCreateTimeAwareSplit object at 0x15acbe7b0>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15b004e20>

    def test_custom_test_size(self, sample_crime_df):
        """Verify test_size parameter affects split ratio."""
>       X = sample_crime_df[["point_x", "point_y"]]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:93: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_________ TestCreateTimeAwareSplit.test_handles_duplicate_index_stably _________

self = <test_models_classification.TestCreateTimeAwareSplit object at 0x15acc3bd0>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15af1c250>

    def test_handles_duplicate_index_stably(self, sample_crime_df):
        """Verify stable sort (mergesort) for duplicate timestamps."""
        # Create data with duplicate dates
        df = sample_crime_df.copy()
        df["dispatch_date"] = pd.to_datetime("2020-01-01")  # All same date
    
>       X = df.set_index("dispatch_date")[["point_x", "point_y"]]
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:114: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:6208: in set_index
    del frame[c]
        ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4529: in __delitem__
    self._mgr = self._mgr.idelete(loc)
                ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:1461: in idelete
    nbs = self._slice_take_blocks_ax0(taker, only_slice=True, ref_inplace_op=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
__________ TestTrainRandomForest.test_returns_fitted_model_and_scaler __________

self = <test_models_classification.TestTrainRandomForest object at 0x15ac534d0>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15b235130>

    def test_returns_fitted_model_and_scaler(self, sample_crime_df):
        """Verify returns (model, scaler) tuple."""
>       X_train = sample_crime_df[["point_x", "point_y"]].iloc[:80]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:203: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____ TestTrainRandomForest.test_scale_features_false_returns_none_scaler ______

self = <test_models_classification.TestTrainRandomForest object at 0x15ac53610>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15b237610>

    def test_scale_features_false_returns_none_scaler(self, sample_crime_df):
        """Verify scaler=None when scale_features=False."""
>       X_train = sample_crime_df[["point_x", "point_y"]].iloc[:80]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:213: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
___________ TestTrainRandomForest.test_model_has_expected_attributes ___________

self = <test_models_classification.TestTrainRandomForest object at 0x15acbb950>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15b162330>

    def test_model_has_expected_attributes(self, sample_crime_df):
        """Verify model has feature_importances_ attribute after fitting."""
>       X_train = sample_crime_df[["point_x", "point_y"]].iloc[:80]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:224: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______________ TestTrainRandomForest.test_scaler_fitted_correctly ______________

self = <test_models_classification.TestTrainRandomForest object at 0x15acbba80>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15b22f6d0>

    def test_scaler_fitted_correctly(self, sample_crime_df):
        """Verify scaler.n_features_in_ matches X_train columns."""
>       X_train = sample_crime_df[["point_x", "point_y"]].iloc[:80]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:234: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______________ TestTrainRandomForest.test_custom_hyperparameters _______________

self = <test_models_classification.TestTrainRandomForest object at 0x15ad504d0>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15cc97d50>

    def test_custom_hyperparameters(self, sample_crime_df):
        """Verify n_estimators, max_depth, etc. passed through."""
>       X_train = sample_crime_df[["point_x", "point_y"]].iloc[:80]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:243: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestTrainRandomForest.test_random_state_reproducible _____________

self = <test_models_classification.TestTrainRandomForest object at 0x15acc3f00>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15c314b40>

    def test_random_state_reproducible(self, sample_crime_df):
        """Verify same random_state produces same results."""
>       X_train = sample_crime_df[["point_x", "point_y"]].iloc[:80]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:262: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_ TestExtractFeatureImportance.test_returns_dataframe_with_feature_importance __

self = <test_models_classification.TestExtractFeatureImportance object at 0x15ac53750>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15c316890>

    def test_returns_dataframe_with_feature_importance(self, sample_crime_df):
        """Verify returns DataFrame with correct columns."""
>       X_train = sample_crime_df[["point_x", "point_y"]].iloc[:80]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:279: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______ TestExtractFeatureImportance.test_sorted_by_importance_descending _______

self = <test_models_classification.TestExtractFeatureImportance object at 0x15ac53890>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15ad48b40>

    def test_sorted_by_importance_descending(self, sample_crime_df):
        """Verify importance column is monotonic decreasing."""
>       X_train = sample_crime_df[["point_x", "point_y"]].iloc[:80]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:295: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______________ TestExtractFeatureImportance.test_top_n_parameter _______________

self = <test_models_classification.TestExtractFeatureImportance object at 0x15acbbbb0>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15ad491d0>

    def test_top_n_parameter(self, sample_crime_df):
        """Verify top_n filters to N features."""
>       X_train = sample_crime_df[["point_x", "point_y", "dc_dist"]].iloc[:80]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:309: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
___________ TestExtractFeatureImportance.test_top_n_none_returns_all ___________

self = <test_models_classification.TestExtractFeatureImportance object at 0x15acbbce0>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15c3172a0>

    def test_top_n_none_returns_all(self, sample_crime_df):
        """Verify top_n=None returns all features."""
>       X_train = sample_crime_df[["point_x", "point_y"]].iloc[:80]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:322: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestEvaluateClassifier.test_returns_confusion_matrix _____________

self = <test_models_classification.TestEvaluateClassifier object at 0x15ac539d0>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15ad49710>

    def test_returns_confusion_matrix(self, sample_crime_df):
        """Verify confusion_matrix key exists and is numpy array."""
        y_true = sample_crime_df["ucr_general"].iloc[:80]
        y_pred = sample_crime_df["ucr_general"].iloc[:80].values
    
        from analysis.models.classification import evaluate_classifier
    
>       results = evaluate_classifier(y_true, y_pred)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:344: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/classification.py:246: in evaluate_classifier
    "confusion_matrix": confusion_matrix(y_true, y_pred),
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/metrics/_classification.py:518: in confusion_matrix
    cm = coo_matrix(
/opt/anaconda3/lib/python3.13/site-packages/scipy/sparse/_coo.py:57: in __init__
    idx_dtype = self._get_index_dtype(coords,
/opt/anaconda3/lib/python3.13/site-packages/scipy/sparse/_base.py:1552: in _get_index_dtype
    return get_index_dtype(arrays,
/opt/anaconda3/lib/python3.13/site-packages/scipy/sparse/_sputils.py:327: in get_index_dtype
    maxval = arr.max()
             ^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([6, 3, 4, 6, 2, 4, 4, 6, 1, 2, 6, 2, 2, 4, 3, 2, 5, 4, 1, 3, 5, 5,
       1, 3, 4, 0, 3, 1, 5, 4, 3, 0, 0, 2, 2,...    2, 3, 6, 3, 0, 2, 4, 2, 6, 4, 0, 6, 1, 3, 0, 3, 5, 1, 1, 0, 1, 4,
       1, 3, 3, 6, 3, 6, 3, 4, 6, 2, 5, 0, 3, 1])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
__________ TestEvaluateClassifier.test_returns_classification_report ___________

self = <test_models_classification.TestEvaluateClassifier object at 0x15ac53b10>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15b14f310>

    def test_returns_classification_report(self, sample_crime_df):
        """Verify classification_report key contains metrics."""
        y_true = sample_crime_df["ucr_general"].iloc[:80]
        y_pred = sample_crime_df["ucr_general"].iloc[:80].values
    
        from analysis.models.classification import evaluate_classifier
    
>       results = evaluate_classifier(y_true, y_pred)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:356: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/classification.py:246: in evaluate_classifier
    "confusion_matrix": confusion_matrix(y_true, y_pred),
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/metrics/_classification.py:518: in confusion_matrix
    cm = coo_matrix(
/opt/anaconda3/lib/python3.13/site-packages/scipy/sparse/_coo.py:57: in __init__
    idx_dtype = self._get_index_dtype(coords,
/opt/anaconda3/lib/python3.13/site-packages/scipy/sparse/_base.py:1552: in _get_index_dtype
    return get_index_dtype(arrays,
/opt/anaconda3/lib/python3.13/site-packages/scipy/sparse/_sputils.py:327: in get_index_dtype
    maxval = arr.max()
             ^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([6, 3, 4, 6, 2, 4, 4, 6, 1, 2, 6, 2, 2, 4, 3, 2, 5, 4, 1, 3, 5, 5,
       1, 3, 4, 0, 3, 1, 5, 4, 3, 0, 0, 2, 2,...    2, 3, 6, 3, 0, 2, 4, 2, 6, 4, 0, 6, 1, 3, 0, 3, 5, 1, 1, 0, 1, 4,
       1, 3, 3, 6, 3, 6, 3, 4, 6, 2, 5, 0, 3, 1])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_________ TestEvaluateClassifier.test_with_probabilities_adds_roc_auc __________

self = <test_models_classification.TestEvaluateClassifier object at 0x15acbbe10>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x102b88670>

    def test_with_probabilities_adds_roc_auc(self, sample_crime_df):
        """Verify roc_auc added when y_prob provided."""
        # Create binary classification data
        y_true = pd.Series([0, 1, 0, 1, 0, 1] * 13 + [0, 1])  # 79 samples
        y_pred = pd.Series([0, 1, 0, 1, 0, 1] * 13 + [0, 1])
        y_prob = pd.Series([0.1, 0.9, 0.2, 0.8, 0.3, 0.7] * 13 + [0.4, 0.6])
    
        from analysis.models.classification import evaluate_classifier
    
>       results = evaluate_classifier(y_true, y_pred, y_prob=y_prob)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:370: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/classification.py:246: in evaluate_classifier
    "confusion_matrix": confusion_matrix(y_true, y_pred),
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/metrics/_classification.py:496: in confusion_matrix
    and y_true.min() >= 0
        ^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
       0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,...    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
       0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amin(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_minimum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:45: TypeError
_________ TestEvaluateClassifier.test_without_probabilities_no_roc_auc _________

self = <test_models_classification.TestEvaluateClassifier object at 0x15ad68050>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15cbf7b60>

    def test_without_probabilities_no_roc_auc(self, sample_crime_df):
        """Verify roc_auc not in results when y_prob=None."""
        y_true = sample_crime_df["ucr_general"].iloc[:80]
        y_pred = sample_crime_df["ucr_general"].iloc[:80].values
    
        from analysis.models.classification import evaluate_classifier
    
>       results = evaluate_classifier(y_true, y_pred, y_prob=None)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:381: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/classification.py:246: in evaluate_classifier
    "confusion_matrix": confusion_matrix(y_true, y_pred),
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/metrics/_classification.py:518: in confusion_matrix
    cm = coo_matrix(
/opt/anaconda3/lib/python3.13/site-packages/scipy/sparse/_coo.py:57: in __init__
    idx_dtype = self._get_index_dtype(coords,
/opt/anaconda3/lib/python3.13/site-packages/scipy/sparse/_base.py:1552: in _get_index_dtype
    return get_index_dtype(arrays,
/opt/anaconda3/lib/python3.13/site-packages/scipy/sparse/_sputils.py:327: in get_index_dtype
    maxval = arr.max()
             ^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([6, 3, 4, 6, 2, 4, 4, 6, 1, 2, 6, 2, 2, 4, 3, 2, 5, 4, 1, 3, 5, 5,
       1, 3, 4, 0, 3, 1, 5, 4, 3, 0, 0, 2, 2,...    2, 3, 6, 3, 0, 2, 4, 2, 6, 4, 0, 6, 1, 3, 0, 3, 5, 1, 1, 0, 1, 4,
       1, 3, 3, 6, 3, 6, 3, 4, 6, 2, 5, 0, 3, 1])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______________ TestEvaluateClassifier.test_target_names_in_report ______________

self = <test_models_classification.TestEvaluateClassifier object at 0x15ad51d90>

    def test_target_names_in_report(self):
        """Verify target_names passed to classification_report."""
        # Create simple binary classification data
        y_true = pd.Series([0, 1, 0, 1, 0, 1] * 13 + [0, 1])  # 79 samples
        y_pred = pd.Series([0, 1, 0, 1, 0, 1] * 13 + [0, 1])
    
        target_names = ["low_crime", "high_crime"]
    
        from analysis.models.classification import evaluate_classifier
    
>       results = evaluate_classifier(y_true, y_pred, target_names=target_names)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:395: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/classification.py:246: in evaluate_classifier
    "confusion_matrix": confusion_matrix(y_true, y_pred),
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/metrics/_classification.py:496: in confusion_matrix
    and y_true.min() >= 0
        ^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
       0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0,...    0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1,
       0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amin(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_minimum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:45: TypeError
_____ TestEvaluateClassifier.test_single_class_roc_auc_handles_gracefully ______

self = <test_models_classification.TestEvaluateClassifier object at 0x15acc3ce0>

    def test_single_class_roc_auc_handles_gracefully(self):
        """Verify roc_auc handling for single class edge case."""
        # All same class - ROC-AUC undefined
        y_true = pd.Series([0] * 50)
        y_pred = pd.Series([0] * 50)
        y_prob = pd.Series([0.5] * 50)
    
        from analysis.models.classification import evaluate_classifier
    
>       results = evaluate_classifier(y_true, y_pred, y_prob=y_prob)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:410: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/classification.py:246: in evaluate_classifier
    "confusion_matrix": confusion_matrix(y_true, y_pred),
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/metrics/_classification.py:496: in confusion_matrix
    and y_true.min() >= 0
        ^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amin(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_minimum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:45: TypeError
____ TestHandleClassImbalance.test_returns_dict_mapping_classes_to_weights _____

self = <test_models_classification.TestHandleClassImbalance object at 0x15ac53c50>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15cbf4c90>

    def test_returns_dict_mapping_classes_to_weights(self, sample_crime_df):
        """Verify returns dict[int, float]."""
        y_train = sample_crime_df["ucr_general"].iloc[:80]
    
>       weights = handle_class_imbalance(y_train)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:425: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/classification.py:276: in handle_class_imbalance
    weights = compute_class_weight("balanced", classes=classes, y=y_train)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/class_weight.py:84: in compute_class_weight
    weight = recip_freq[le.transform(classes)]
                        ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/preprocessing/_label.py:134: in transform
    return _encode(y, uniques=self.classes_)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_encode.py:240: in _encode
    diff = _check_unknown(values, uniques)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_encode.py:305: in _check_unknown
    diff = xpx.setdiff1d(unique_values, known_values, assume_unique=True, xp=xp)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_extra/_lib/_funcs.py:826: in setdiff1d
    return x1_[_helpers.in1d(x1_, x2_, assume_unique=True, invert=True, xp=xp)]
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_extra/_lib/_utils/_helpers.py:62: in in1d
    mask = xp.ones(x1_shape[0], dtype=xp.bool, device=_compat.device(x1))
                                                      ^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:731: in device
    if is_numpy_array(x):
       ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:124: in is_numpy_array
    ) and not _is_jax_zero_gradient_array(x)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:87: in _is_jax_zero_gradient_array
    if not _issubclass_fast(cls, "numpy.dtypes", "VoidDType"):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

cls = <class 'numpy.dtypes.Int64DType'>, modname = 'numpy.dtypes'
clsname = 'VoidDType'

    @lru_cache(100)
    def _issubclass_fast(cls: type, modname: str, clsname: str) -> bool:
        try:
            mod = sys.modules[modname]
        except KeyError:
            return False
>       parent_cls = getattr(mod, clsname)
                     ^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: module 'numpy.dtypes' has no attribute 'VoidDType'

/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:71: AttributeError
______ TestHandleClassImbalance.test_balanced_weights_for_imbalanced_data ______

self = <test_models_classification.TestHandleClassImbalance object at 0x15ac53d90>

    def test_balanced_weights_for_imbalanced_data(self):
        """Create synthetic imbalanced classes, verify weights computed."""
        # Create imbalanced data: class 0 has 70 samples, class 1 has 10 samples
        y_train = pd.Series([0] * 70 + [1] * 10)
    
>       weights = handle_class_imbalance(y_train)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:438: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/classification.py:276: in handle_class_imbalance
    weights = compute_class_weight("balanced", classes=classes, y=y_train)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/class_weight.py:84: in compute_class_weight
    weight = recip_freq[le.transform(classes)]
                        ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/preprocessing/_label.py:134: in transform
    return _encode(y, uniques=self.classes_)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_encode.py:240: in _encode
    diff = _check_unknown(values, uniques)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_encode.py:305: in _check_unknown
    diff = xpx.setdiff1d(unique_values, known_values, assume_unique=True, xp=xp)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_extra/_lib/_funcs.py:826: in setdiff1d
    return x1_[_helpers.in1d(x1_, x2_, assume_unique=True, invert=True, xp=xp)]
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_extra/_lib/_utils/_helpers.py:62: in in1d
    mask = xp.ones(x1_shape[0], dtype=xp.bool, device=_compat.device(x1))
                                                      ^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:731: in device
    if is_numpy_array(x):
       ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:124: in is_numpy_array
    ) and not _is_jax_zero_gradient_array(x)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:87: in _is_jax_zero_gradient_array
    if not _issubclass_fast(cls, "numpy.dtypes", "VoidDType"):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

cls = <class 'numpy.dtypes.Int64DType'>, modname = 'numpy.dtypes'
clsname = 'VoidDType'

    @lru_cache(100)
    def _issubclass_fast(cls: type, modname: str, clsname: str) -> bool:
        try:
            mod = sys.modules[modname]
        except KeyError:
            return False
>       parent_cls = getattr(mod, clsname)
                     ^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: module 'numpy.dtypes' has no attribute 'VoidDType'

/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:71: AttributeError
__________ TestHandleClassImbalance.test_all_classes_present_in_keys ___________

self = <test_models_classification.TestHandleClassImbalance object at 0x15ad68180>
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15c321cc0>

    def test_all_classes_present_in_keys(self, sample_crime_df):
        """Verify all unique y_train values are keys."""
        y_train = sample_crime_df["ucr_general"].iloc[:80]
    
>       weights = handle_class_imbalance(y_train)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:447: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/classification.py:276: in handle_class_imbalance
    weights = compute_class_weight("balanced", classes=classes, y=y_train)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/class_weight.py:84: in compute_class_weight
    weight = recip_freq[le.transform(classes)]
                        ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/preprocessing/_label.py:134: in transform
    return _encode(y, uniques=self.classes_)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_encode.py:240: in _encode
    diff = _check_unknown(values, uniques)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_encode.py:305: in _check_unknown
    diff = xpx.setdiff1d(unique_values, known_values, assume_unique=True, xp=xp)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_extra/_lib/_funcs.py:826: in setdiff1d
    return x1_[_helpers.in1d(x1_, x2_, assume_unique=True, invert=True, xp=xp)]
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_extra/_lib/_utils/_helpers.py:62: in in1d
    mask = xp.ones(x1_shape[0], dtype=xp.bool, device=_compat.device(x1))
                                                      ^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:731: in device
    if is_numpy_array(x):
       ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:124: in is_numpy_array
    ) and not _is_jax_zero_gradient_array(x)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:87: in _is_jax_zero_gradient_array
    if not _issubclass_fast(cls, "numpy.dtypes", "VoidDType"):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

cls = <class 'numpy.dtypes.Int64DType'>, modname = 'numpy.dtypes'
clsname = 'VoidDType'

    @lru_cache(100)
    def _issubclass_fast(cls: type, modname: str, clsname: str) -> bool:
        try:
            mod = sys.modules[modname]
        except KeyError:
            return False
>       parent_cls = getattr(mod, clsname)
                     ^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: module 'numpy.dtypes' has no attribute 'VoidDType'

/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:71: AttributeError
__ TestHandleClassImbalance.test_weights_inversely_proportional_to_frequency ___

self = <test_models_classification.TestHandleClassImbalance object at 0x15ad682b0>

    def test_weights_inversely_proportional_to_frequency(self):
        """Verify rare classes get higher weights."""
        # Create highly imbalanced data
        y_train = pd.Series([0] * 80 + [1] * 10 + [2] * 5)
    
>       weights = handle_class_imbalance(y_train)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:459: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/classification.py:276: in handle_class_imbalance
    weights = compute_class_weight("balanced", classes=classes, y=y_train)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/class_weight.py:84: in compute_class_weight
    weight = recip_freq[le.transform(classes)]
                        ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/preprocessing/_label.py:134: in transform
    return _encode(y, uniques=self.classes_)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_encode.py:240: in _encode
    diff = _check_unknown(values, uniques)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_encode.py:305: in _check_unknown
    diff = xpx.setdiff1d(unique_values, known_values, assume_unique=True, xp=xp)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_extra/_lib/_funcs.py:826: in setdiff1d
    return x1_[_helpers.in1d(x1_, x2_, assume_unique=True, invert=True, xp=xp)]
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_extra/_lib/_utils/_helpers.py:62: in in1d
    mask = xp.ones(x1_shape[0], dtype=xp.bool, device=_compat.device(x1))
                                                      ^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:731: in device
    if is_numpy_array(x):
       ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:124: in is_numpy_array
    ) and not _is_jax_zero_gradient_array(x)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:87: in _is_jax_zero_gradient_array
    if not _issubclass_fast(cls, "numpy.dtypes", "VoidDType"):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

cls = <class 'numpy.dtypes.Int64DType'>, modname = 'numpy.dtypes'
clsname = 'VoidDType'

    @lru_cache(100)
    def _issubclass_fast(cls: type, modname: str, clsname: str) -> bool:
        try:
            mod = sys.modules[modname]
        except KeyError:
            return False
>       parent_cls = getattr(mod, clsname)
                     ^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: module 'numpy.dtypes' has no attribute 'VoidDType'

/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:71: AttributeError
_________ TestHandleClassImbalance.test_handles_binary_classification __________

self = <test_models_classification.TestHandleClassImbalance object at 0x15ad52c30>

    def test_handles_binary_classification(self):
        """Verify works with 2 classes."""
        y_train = pd.Series([0] * 50 + [1] * 30)
    
>       weights = handle_class_imbalance(y_train)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:469: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/classification.py:276: in handle_class_imbalance
    weights = compute_class_weight("balanced", classes=classes, y=y_train)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/class_weight.py:84: in compute_class_weight
    weight = recip_freq[le.transform(classes)]
                        ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/preprocessing/_label.py:134: in transform
    return _encode(y, uniques=self.classes_)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_encode.py:240: in _encode
    diff = _check_unknown(values, uniques)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_encode.py:305: in _check_unknown
    diff = xpx.setdiff1d(unique_values, known_values, assume_unique=True, xp=xp)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_extra/_lib/_funcs.py:826: in setdiff1d
    return x1_[_helpers.in1d(x1_, x2_, assume_unique=True, invert=True, xp=xp)]
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_extra/_lib/_utils/_helpers.py:62: in in1d
    mask = xp.ones(x1_shape[0], dtype=xp.bool, device=_compat.device(x1))
                                                      ^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:731: in device
    if is_numpy_array(x):
       ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:124: in is_numpy_array
    ) and not _is_jax_zero_gradient_array(x)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:87: in _is_jax_zero_gradient_array
    if not _issubclass_fast(cls, "numpy.dtypes", "VoidDType"):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

cls = <class 'numpy.dtypes.Int64DType'>, modname = 'numpy.dtypes'
clsname = 'VoidDType'

    @lru_cache(100)
    def _issubclass_fast(cls: type, modname: str, clsname: str) -> bool:
        try:
            mod = sys.modules[modname]
        except KeyError:
            return False
>       parent_cls = getattr(mod, clsname)
                     ^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: module 'numpy.dtypes' has no attribute 'VoidDType'

/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:71: AttributeError
_______ TestHandleClassImbalance.test_handles_multiclass_classification ________

self = <test_models_classification.TestHandleClassImbalance object at 0x15ad64050>

    def test_handles_multiclass_classification(self):
        """Verify works with 3+ classes."""
        y_train = pd.Series([0] * 30 + [1] * 20 + [2] * 10 + [3] * 5)
    
>       weights = handle_class_imbalance(y_train)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:479: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/classification.py:276: in handle_class_imbalance
    weights = compute_class_weight("balanced", classes=classes, y=y_train)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/class_weight.py:84: in compute_class_weight
    weight = recip_freq[le.transform(classes)]
                        ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/preprocessing/_label.py:134: in transform
    return _encode(y, uniques=self.classes_)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_encode.py:240: in _encode
    diff = _check_unknown(values, uniques)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_encode.py:305: in _check_unknown
    diff = xpx.setdiff1d(unique_values, known_values, assume_unique=True, xp=xp)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_extra/_lib/_funcs.py:826: in setdiff1d
    return x1_[_helpers.in1d(x1_, x2_, assume_unique=True, invert=True, xp=xp)]
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_extra/_lib/_utils/_helpers.py:62: in in1d
    mask = xp.ones(x1_shape[0], dtype=xp.bool, device=_compat.device(x1))
                                                      ^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:731: in device
    if is_numpy_array(x):
       ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:124: in is_numpy_array
    ) and not _is_jax_zero_gradient_array(x)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:87: in _is_jax_zero_gradient_array
    if not _issubclass_fast(cls, "numpy.dtypes", "VoidDType"):
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

cls = <class 'numpy.dtypes.Int64DType'>, modname = 'numpy.dtypes'
clsname = 'VoidDType'

    @lru_cache(100)
    def _issubclass_fast(cls: type, modname: str, clsname: str) -> bool:
        try:
            mod = sys.modules[modname]
        except KeyError:
            return False
>       parent_cls = getattr(mod, clsname)
                     ^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: module 'numpy.dtypes' has no attribute 'VoidDType'

/opt/anaconda3/lib/python3.13/site-packages/sklearn/externals/array_api_compat/common/_helpers.py:71: AttributeError
____________ TestTrainXGBoost.test_returns_fitted_model_and_scaler _____________

self = <test_models_classification.TestTrainXGBoost object at 0x15ad74050>
xgboost_available = True
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15afd9940>

    def test_returns_fitted_model_and_scaler(self, xgboost_available, sample_crime_df):
        """Verify returns (model, scaler) tuple."""
        from analysis.models.classification import train_xgboost
    
>       X_train = sample_crime_df[["point_x", "point_y"]].iloc[:80]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:502: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
____________ TestTrainXGBoost.test_scale_features_defaults_to_false ____________

self = <test_models_classification.TestTrainXGBoost object at 0x15ad74190>
xgboost_available = True
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15b155470>

    def test_scale_features_defaults_to_false(self, xgboost_available, sample_crime_df):
        """Verify XGBoost typically doesn't need scaling."""
        from analysis.models.classification import train_xgboost
    
>       X_train = sample_crime_df[["point_x", "point_y"]].iloc[:80]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:515: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_________________ TestTrainXGBoost.test_custom_hyperparameters _________________

self = <test_models_classification.TestTrainXGBoost object at 0x15ad683e0>
xgboost_available = True
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15b1550f0>

    def test_custom_hyperparameters(self, xgboost_available, sample_crime_df):
        """Verify n_estimators, max_depth, learning_rate passed through."""
        from analysis.models.classification import train_xgboost
    
>       X_train = sample_crime_df[["point_x", "point_y"]].iloc[:80]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:526: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_______________ TestTrainXGBoost.test_eval_metric_set_to_logloss _______________

self = <test_models_classification.TestTrainXGBoost object at 0x15ad68510>
xgboost_available = True
sample_crime_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x15b156c80>

    def test_eval_metric_set_to_logloss(self, xgboost_available, sample_crime_df):
        """Verify eval_metric configured."""
        from analysis.models.classification import train_xgboost
    
>       X_train = sample_crime_df[["point_x", "point_y"]].iloc[:80]
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_classification.py:546: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
__________ TestPrepareProphetData.test_returns_prophet_format_columns __________

self = <test_models_time_series.TestPrepareProphetData object at 0x15ad74410>

    def test_returns_prophet_format_columns(self):
        """Returns DataFrame with 'ds' and 'y' columns."""
        df = pd.DataFrame({
            "date": ["2020-01-01", "2020-01-02", "2020-01-03"],
            "count": [10, 20, 30]
        })
    
>       result = prepare_prophet_data(df, "date", "count")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_time_series.py:34: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/time_series.py:36: in prepare_prophet_data
    prophet_df = df[[date_col, value_col]].copy()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_________ TestPrepareProphetData.test_converts_date_column_to_datetime _________

self = <test_models_time_series.TestPrepareProphetData object at 0x15ad74550>

    def test_converts_date_column_to_datetime(self):
        """Converts date column to datetime64 dtype."""
        df = pd.DataFrame({
            "date": ["2020-01-01", "2020-01-02", "2020-01-03"],
            "count": [10, 20, 30]
        })
    
>       result = prepare_prophet_data(df, "date", "count")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_time_series.py:47: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/time_series.py:36: in prepare_prophet_data
    prophet_df = df[[date_col, value_col]].copy()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestPrepareProphetData.test_sorts_by_date_ascending ______________

self = <test_models_time_series.TestPrepareProphetData object at 0x15ad68640>

    def test_sorts_by_date_ascending(self):
        """Sorts DataFrame by date column in ascending order."""
        df = pd.DataFrame({
            "date": ["2020-01-03", "2020-01-01", "2020-01-02"],
            "count": [30, 10, 20]
        })
    
>       result = prepare_prophet_data(df, "date", "count")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_time_series.py:58: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/time_series.py:36: in prepare_prophet_data
    prophet_df = df[[date_col, value_col]].copy()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
____________ TestPrepareProphetData.test_resets_index_after_sorting ____________

self = <test_models_time_series.TestPrepareProphetData object at 0x15ad68770>

    def test_resets_index_after_sorting(self):
        """Resets index to 0, 1, 2, ... after sorting."""
        df = pd.DataFrame({
            "date": ["2020-01-03", "2020-01-01", "2020-01-02"],
            "count": [30, 10, 20]
        })
    
>       result = prepare_prophet_data(df, "date", "count")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_time_series.py:72: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/time_series.py:36: in prepare_prophet_data
    prophet_df = df[[date_col, value_col]].copy()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestPrepareProphetData.test_handles_duplicate_dates ______________

self = <test_models_time_series.TestPrepareProphetData object at 0x15ad52d50>

    def test_handles_duplicate_dates(self):
        """Preserves duplicate dates (does not aggregate)."""
        df = pd.DataFrame({
            "date": ["2020-01-01", "2020-01-01", "2020-01-02"],
            "count": [10, 15, 20]
        })
    
>       result = prepare_prophet_data(df, "date", "count")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_time_series.py:83: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/time_series.py:36: in prepare_prophet_data
    prophet_df = df[[date_col, value_col]].copy()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestPrepareProphetData.test_handles_empty_dataframe ______________

self = <test_models_time_series.TestPrepareProphetData object at 0x15acc39b0>

    def test_handles_empty_dataframe(self):
        """Returns empty DataFrame with correct columns for empty input."""
        df = pd.DataFrame({"date": [], "count": []})
    
>       result = prepare_prophet_data(df, "date", "count")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_time_series.py:93: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/time_series.py:36: in prepare_prophet_data
    prophet_df = df[[date_col, value_col]].copy()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestPrepareProphetData.test_custom_date_column_name ______________

self = <test_models_time_series.TestPrepareProphetData object at 0x15ad64270>

    def test_custom_date_column_name(self):
        """Accepts custom date column name."""
        df = pd.DataFrame({
            "my_date": ["2020-01-01", "2020-01-02"],
            "count": [10, 20]
        })
    
>       result = prepare_prophet_data(df, "my_date", "count")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_time_series.py:105: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/time_series.py:36: in prepare_prophet_data
    prophet_df = df[[date_col, value_col]].copy()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestPrepareProphetData.test_custom_value_column_name _____________

self = <test_models_time_series.TestPrepareProphetData object at 0x15ad15a50>

    def test_custom_value_column_name(self):
        """Accepts custom value column name."""
        df = pd.DataFrame({
            "date": ["2020-01-01", "2020-01-02"],
            "my_value": [10, 20]
        })
    
>       result = prepare_prophet_data(df, "date", "my_value")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_time_series.py:117: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/time_series.py:36: in prepare_prophet_data
    prophet_df = df[[date_col, value_col]].copy()
                 ^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestCreateTrainTestSplit.test_splits_by_date_cutoff ______________

self = <test_models_time_series.TestCreateTrainTestSplit object at 0x15ad74910>

    def test_splits_by_date_cutoff(self):
        """Splits data based on date cutoff."""
        df = pd.DataFrame({
            "ds": pd.date_range("2020-01-01", periods=100),
            "y": range(100)
        })
    
>       train, test = create_train_test_split(df, test_days=30)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_time_series.py:140: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/time_series.py:60: in create_train_test_split
    train_end = df["ds"].max() - pd.Timedelta(days=test_days)
                ^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6538: in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12469: in max
    return self._stat_function(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12442: in _stat_function
    return self._reduce(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6464: in _reduce
    return delegate._reduce(name, skipna=skipna, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/base.py:1958: in _reduce
    result = meth(skipna=skipna, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:181: in new_meth
    return meth(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:1597: in max
    result = nanops.nanmax(self._ndarray, axis=axis, skipna=skipna)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:147: in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:404: in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:1098: in reduction
    result = getattr(values, meth)(axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1577836800000000000, 1577923200000000000, 1578009600000000000,
       1578096000000000000, 1578182400000000000,...1586044800000000000,
       1586131200000000000, 1586217600000000000, 1586304000000000000,
       1586390400000000000])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
___________ TestCreateTrainTestSplit.test_custom_test_days_parameter ___________

self = <test_models_time_series.TestCreateTrainTestSplit object at 0x15ad688a0>

    def test_custom_test_days_parameter(self):
        """Respects custom test_days parameter."""
        df = pd.DataFrame({
            "ds": pd.date_range("2020-01-01", periods=100),
            "y": range(100)
        })
    
>       train, test = create_train_test_split(df, test_days=10)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_time_series.py:152: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/time_series.py:60: in create_train_test_split
    train_end = df["ds"].max() - pd.Timedelta(days=test_days)
                ^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6538: in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12469: in max
    return self._stat_function(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12442: in _stat_function
    return self._reduce(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6464: in _reduce
    return delegate._reduce(name, skipna=skipna, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/base.py:1958: in _reduce
    result = meth(skipna=skipna, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:181: in new_meth
    return meth(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:1597: in max
    result = nanops.nanmax(self._ndarray, axis=axis, skipna=skipna)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:147: in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:404: in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:1098: in reduction
    result = getattr(values, meth)(axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1577836800000000000, 1577923200000000000, 1578009600000000000,
       1578096000000000000, 1578182400000000000,...1586044800000000000,
       1586131200000000000, 1586217600000000000, 1586304000000000000,
       1586390400000000000])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______________ TestCreateTrainTestSplit.test_test_days_30_default ______________

self = <test_models_time_series.TestCreateTrainTestSplit object at 0x15ad689d0>

    def test_test_days_30_default(self):
        """Default 30 days held out for testing."""
        df = pd.DataFrame({
            "ds": pd.date_range("2020-01-01", periods=100),
            "y": range(100)
        })
    
>       train, test = create_train_test_split(df)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_time_series.py:164: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/time_series.py:60: in create_train_test_split
    train_end = df["ds"].max() - pd.Timedelta(days=test_days)
                ^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6538: in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12469: in max
    return self._stat_function(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12442: in _stat_function
    return self._reduce(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6464: in _reduce
    return delegate._reduce(name, skipna=skipna, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/base.py:1958: in _reduce
    result = meth(skipna=skipna, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:181: in new_meth
    return meth(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:1597: in max
    result = nanops.nanmax(self._ndarray, axis=axis, skipna=skipna)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:147: in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:404: in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:1098: in reduction
    result = getattr(values, meth)(axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1577836800000000000, 1577923200000000000, 1578009600000000000,
       1578096000000000000, 1578182400000000000,...1586044800000000000,
       1586131200000000000, 1586217600000000000, 1586304000000000000,
       1586390400000000000])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_______ TestCreateTrainTestSplit.test_no_overlap_between_train_and_test ________

self = <test_models_time_series.TestCreateTrainTestSplit object at 0x15ad50290>

    def test_no_overlap_between_train_and_test(self):
        """No overlap between train and test data."""
        df = pd.DataFrame({
            "ds": pd.date_range("2020-01-01", periods=100),
            "y": range(100)
        })
    
>       train, test = create_train_test_split(df, test_days=30)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_time_series.py:176: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/time_series.py:60: in create_train_test_split
    train_end = df["ds"].max() - pd.Timedelta(days=test_days)
                ^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6538: in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12469: in max
    return self._stat_function(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12442: in _stat_function
    return self._reduce(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6464: in _reduce
    return delegate._reduce(name, skipna=skipna, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/base.py:1958: in _reduce
    result = meth(skipna=skipna, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:181: in new_meth
    return meth(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:1597: in max
    result = nanops.nanmax(self._ndarray, axis=axis, skipna=skipna)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:147: in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:404: in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:1098: in reduction
    result = getattr(values, meth)(axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1577836800000000000, 1577923200000000000, 1578009600000000000,
       1578096000000000000, 1578182400000000000,...1586044800000000000,
       1586131200000000000, 1586217600000000000, 1586304000000000000,
       1586390400000000000])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestCreateTrainTestSplit.test_handles_exact_boundary _____________

self = <test_models_time_series.TestCreateTrainTestSplit object at 0x15ad64160>

    def test_handles_exact_boundary(self):
        """Handles boundary dates correctly."""
        df = pd.DataFrame({
            "ds": pd.date_range("2020-01-01", periods=31),
            "y": range(31)
        })
    
>       train, test = create_train_test_split(df, test_days=30)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_time_series.py:190: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/time_series.py:60: in create_train_test_split
    train_end = df["ds"].max() - pd.Timedelta(days=test_days)
                ^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6538: in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12469: in max
    return self._stat_function(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12442: in _stat_function
    return self._reduce(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6464: in _reduce
    return delegate._reduce(name, skipna=skipna, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/base.py:1958: in _reduce
    result = meth(skipna=skipna, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:181: in new_meth
    return meth(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:1597: in max
    result = nanops.nanmax(self._ndarray, axis=axis, skipna=skipna)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:147: in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:404: in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:1098: in reduction
    result = getattr(values, meth)(axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1577836800000000000, 1577923200000000000, 1578009600000000000,
       1578096000000000000, 1578182400000000000,...1580083200000000000,
       1580169600000000000, 1580256000000000000, 1580342400000000000,
       1580428800000000000])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
________ TestTimeSeriesCVScore.test_returns_dict_with_scores_statistics ________

self = <test_models_validation.TestTimeSeriesCVScore object at 0x15ad77390>

    def test_returns_dict_with_scores_statistics(self):
        """Returns dict with 'scores', 'mean', 'std', 'min', 'max' keys."""
        np.random.seed(42)
        X = pd.DataFrame({"feature": np.arange(50)})
        y = pd.Series(np.arange(50) + np.random.randn(50) * 0.1)
    
        model = RandomForestRegressor(n_estimators=5, random_state=42)
>       results = time_series_cv_score(model, X, y, n_splits=3)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:50: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:50: in time_series_cv_score
    scores = cross_val_score(model, X, y, cv=tscv, scoring=scoring)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:677: in cross_val_score
    cv_results = cross_validate(
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:399: in cross_validate
    results = parallel(
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/parallel.py:82: in __call__
    return super().__call__(iterable_with_config_and_warning_filters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/parallel.py:1986: in __call__
    return output if self.return_generator else list(output)
                                                ^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/parallel.py:1914: in _get_sequential_output
    res = func(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/parallel.py:147: in __call__
    return self.function(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:851: in _fit_and_score
    X_train, y_train = _safe_split(estimator, X, y, train)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/metaestimators.py:156: in _safe_split
    X_subset = _safe_indexing(X, indices)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_indexing.py:331: in _safe_indexing
    return _pandas_indexing(X, indices, indices_dtype, axis=axis)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_indexing.py:51: in _pandas_indexing
    return X.take(key, axis=axis)
           ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13]), axis = None
out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_______ TestTimeSeriesCVScore.test_scores_array_length_matches_n_splits ________

self = <test_models_validation.TestTimeSeriesCVScore object at 0x15ad77750>

    def test_scores_array_length_matches_n_splits(self):
        """Verify len(scores) == n_splits."""
        np.random.seed(42)
        X = pd.DataFrame({"feature": np.arange(50)})
        y = pd.Series(np.arange(50))
    
        model = RandomForestRegressor(n_estimators=5, random_state=42)
    
        for n_splits in [3, 5, 7]:
>           results = time_series_cv_score(model, X, y, n_splits=n_splits)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:68: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:50: in time_series_cv_score
    scores = cross_val_score(model, X, y, cv=tscv, scoring=scoring)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:677: in cross_val_score
    cv_results = cross_validate(
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:399: in cross_validate
    results = parallel(
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/parallel.py:82: in __call__
    return super().__call__(iterable_with_config_and_warning_filters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/parallel.py:1986: in __call__
    return output if self.return_generator else list(output)
                                                ^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/parallel.py:1914: in _get_sequential_output
    res = func(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/parallel.py:147: in __call__
    return self.function(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:851: in _fit_and_score
    X_train, y_train = _safe_split(estimator, X, y, train)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/metaestimators.py:156: in _safe_split
    X_subset = _safe_indexing(X, indices)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_indexing.py:331: in _safe_indexing
    return _pandas_indexing(X, indices, indices_dtype, axis=axis)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_indexing.py:51: in _pandas_indexing
    return X.take(key, axis=axis)
           ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13]), axis = None
out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______________ TestTimeSeriesCVScore.test_mean_computed_correctly ______________

self = <test_models_validation.TestTimeSeriesCVScore object at 0x15ad6a3f0>

    def test_mean_computed_correctly(self):
        """Verify mean equals scores.mean()."""
        np.random.seed(42)
        X = pd.DataFrame({"feature": np.arange(50)})
        y = pd.Series(np.arange(50))
    
        model = RandomForestRegressor(n_estimators=5, random_state=42)
>       results = time_series_cv_score(model, X, y, n_splits=5)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:78: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:50: in time_series_cv_score
    scores = cross_val_score(model, X, y, cv=tscv, scoring=scoring)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:677: in cross_val_score
    cv_results = cross_validate(
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:399: in cross_validate
    results = parallel(
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/parallel.py:82: in __call__
    return super().__call__(iterable_with_config_and_warning_filters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/parallel.py:1986: in __call__
    return output if self.return_generator else list(output)
                                                ^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/parallel.py:1914: in _get_sequential_output
    res = func(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/parallel.py:147: in __call__
    return self.function(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:851: in _fit_and_score
    X_train, y_train = _safe_split(estimator, X, y, train)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/metaestimators.py:156: in _safe_split
    X_subset = _safe_indexing(X, indices)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_indexing.py:331: in _safe_indexing
    return _pandas_indexing(X, indices, indices_dtype, axis=axis)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_indexing.py:51: in _pandas_indexing
    return X.take(key, axis=axis)
           ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9]), axis = None, out = None
keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______________ TestTimeSeriesCVScore.test_std_computed_correctly _______________

self = <test_models_validation.TestTimeSeriesCVScore object at 0x15ad6a650>

    def test_std_computed_correctly(self):
        """Verify std equals scores.std()."""
        np.random.seed(42)
        X = pd.DataFrame({"feature": np.arange(50)})
        y = pd.Series(np.arange(50))
    
        model = RandomForestRegressor(n_estimators=5, random_state=42)
>       results = time_series_cv_score(model, X, y, n_splits=5)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:89: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:50: in time_series_cv_score
    scores = cross_val_score(model, X, y, cv=tscv, scoring=scoring)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:677: in cross_val_score
    cv_results = cross_validate(
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:399: in cross_validate
    results = parallel(
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/parallel.py:82: in __call__
    return super().__call__(iterable_with_config_and_warning_filters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/parallel.py:1986: in __call__
    return output if self.return_generator else list(output)
                                                ^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/parallel.py:1914: in _get_sequential_output
    res = func(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/parallel.py:147: in __call__
    return self.function(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:851: in _fit_and_score
    X_train, y_train = _safe_split(estimator, X, y, train)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/metaestimators.py:156: in _safe_split
    X_subset = _safe_indexing(X, indices)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_indexing.py:331: in _safe_indexing
    return _pandas_indexing(X, indices, indices_dtype, axis=axis)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_indexing.py:51: in _pandas_indexing
    return X.take(key, axis=axis)
           ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9]), axis = None, out = None
keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestTimeSeriesCVScore.test_custom_n_splits_parameter _____________

self = <test_models_validation.TestTimeSeriesCVScore object at 0x15ad94b90>

    def test_custom_n_splits_parameter(self):
        """Verify n_splits parameter affects score count."""
        np.random.seed(42)
        X = pd.DataFrame({"feature": np.arange(50)})
        y = pd.Series(np.arange(50))
    
        model = RandomForestRegressor(n_estimators=5, random_state=42)
    
>       results_3 = time_series_cv_score(model, X, y, n_splits=3)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:101: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:50: in time_series_cv_score
    scores = cross_val_score(model, X, y, cv=tscv, scoring=scoring)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:677: in cross_val_score
    cv_results = cross_validate(
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:399: in cross_validate
    results = parallel(
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/parallel.py:82: in __call__
    return super().__call__(iterable_with_config_and_warning_filters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/parallel.py:1986: in __call__
    return output if self.return_generator else list(output)
                                                ^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/parallel.py:1914: in _get_sequential_output
    res = func(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/parallel.py:147: in __call__
    return self.function(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:851: in _fit_and_score
    X_train, y_train = _safe_split(estimator, X, y, train)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/metaestimators.py:156: in _safe_split
    X_subset = _safe_indexing(X, indices)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_indexing.py:331: in _safe_indexing
    return _pandas_indexing(X, indices, indices_dtype, axis=axis)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_indexing.py:51: in _pandas_indexing
    return X.take(key, axis=axis)
           ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13]), axis = None
out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestTimeSeriesCVScore.test_custom_scoring_parameter ______________

self = <test_models_validation.TestTimeSeriesCVScore object at 0x15ad64e20>

    def test_custom_scoring_parameter(self):
        """Verify scoring parameter passed through."""
        np.random.seed(42)
        X = pd.DataFrame({"feature": np.arange(50)})
        y = pd.Series(np.arange(50))
    
        model = RandomForestRegressor(n_estimators=5, random_state=42)
    
        # Test different scoring metrics
        for scoring in ["neg_mean_absolute_error", "neg_mean_squared_error", "r2"]:
>           results = time_series_cv_score(model, X, y, n_splits=3, scoring=scoring)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:117: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:50: in time_series_cv_score
    scores = cross_val_score(model, X, y, cv=tscv, scoring=scoring)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:677: in cross_val_score
    cv_results = cross_validate(
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:399: in cross_validate
    results = parallel(
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/parallel.py:82: in __call__
    return super().__call__(iterable_with_config_and_warning_filters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/parallel.py:1986: in __call__
    return output if self.return_generator else list(output)
                                                ^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/parallel.py:1914: in _get_sequential_output
    res = func(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/parallel.py:147: in __call__
    return self.function(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:851: in _fit_and_score
    X_train, y_train = _safe_split(estimator, X, y, train)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/metaestimators.py:156: in _safe_split
    X_subset = _safe_indexing(X, indices)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_indexing.py:331: in _safe_indexing
    return _pandas_indexing(X, indices, indices_dtype, axis=axis)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_indexing.py:51: in _pandas_indexing
    return X.take(key, axis=axis)
           ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13]), axis = None
out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______ TestTimeSeriesCVScore.test_default_scoring_neg_mean_absolute_error ______

self = <test_models_validation.TestTimeSeriesCVScore object at 0x15ad64af0>

    def test_default_scoring_neg_mean_absolute_error(self):
        """Verify default scoring is 'neg_mean_absolute_error'."""
        np.random.seed(42)
        X = pd.DataFrame({"feature": np.arange(50)})
        y = pd.Series(np.arange(50))
    
        model = RandomForestRegressor(n_estimators=5, random_state=42)
    
        # Call with default (no scoring param)
>       results_default = time_series_cv_score(model, X, y, n_splits=3)
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:130: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:50: in time_series_cv_score
    scores = cross_val_score(model, X, y, cv=tscv, scoring=scoring)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:677: in cross_val_score
    cv_results = cross_validate(
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_param_validation.py:218: in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:399: in cross_validate
    results = parallel(
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/parallel.py:82: in __call__
    return super().__call__(iterable_with_config_and_warning_filters)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/parallel.py:1986: in __call__
    return output if self.return_generator else list(output)
                                                ^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/parallel.py:1914: in _get_sequential_output
    res = func(*args, **kwargs)
          ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/parallel.py:147: in __call__
    return self.function(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/model_selection/_validation.py:851: in _fit_and_score
    X_train, y_train = _safe_split(estimator, X, y, train)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/metaestimators.py:156: in _safe_split
    X_subset = _safe_indexing(X, indices)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_indexing.py:331: in _safe_indexing
    return _pandas_indexing(X, indices, indices_dtype, axis=axis)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/sklearn/utils/_indexing.py:51: in _pandas_indexing
    return X.take(key, axis=axis)
           ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13]), axis = None
out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____ TestValidateTemporalSplit.test_returns_dict_with_validation_results ______

self = <test_models_validation.TestValidateTemporalSplit object at 0x15ae142d0>

    def test_returns_dict_with_validation_results(self):
        """Verify has 'train_end', 'test_start', 'gap_days', 'valid_temporal_order', 'sufficient_gap', 'train_size', 'test_size', 'test_ratio'."""
        train_dates = pd.Series(pd.date_range("2020-01-01", periods=50))
        test_dates = pd.Series(pd.date_range("2020-02-20", periods=30))
    
>       validation = validate_temporal_split(train_dates, test_dates)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:573: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:264: in validate_temporal_split
    train_max = train_dates.max()
                ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6538: in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12469: in max
    return self._stat_function(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12442: in _stat_function
    return self._reduce(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6464: in _reduce
    return delegate._reduce(name, skipna=skipna, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/base.py:1958: in _reduce
    result = meth(skipna=skipna, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:181: in new_meth
    return meth(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:1597: in max
    result = nanops.nanmax(self._ndarray, axis=axis, skipna=skipna)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:147: in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:404: in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:1098: in reduction
    result = getattr(values, meth)(axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1577836800000000000, 1577923200000000000, 1578009600000000000,
       1578096000000000000, 1578182400000000000,...       1581724800000000000, 1581811200000000000, 1581897600000000000,
       1581984000000000000, 1582070400000000000])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____ TestValidateTemporalSplit.test_valid_temporal_order_true_when_sorted _____

self = <test_models_validation.TestValidateTemporalSplit object at 0x15ae14410>

    def test_valid_temporal_order_true_when_sorted(self):
        """Verify valid_temporal_order=True when train_max < test_min."""
        train_dates = pd.Series(pd.date_range("2020-01-01", periods=50))
        test_dates = pd.Series(pd.date_range("2020-02-20", periods=30))
    
>       validation = validate_temporal_split(train_dates, test_dates)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:590: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:264: in validate_temporal_split
    train_max = train_dates.max()
                ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6538: in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12469: in max
    return self._stat_function(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12442: in _stat_function
    return self._reduce(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6464: in _reduce
    return delegate._reduce(name, skipna=skipna, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/base.py:1958: in _reduce
    result = meth(skipna=skipna, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:181: in new_meth
    return meth(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:1597: in max
    result = nanops.nanmax(self._ndarray, axis=axis, skipna=skipna)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:147: in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:404: in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:1098: in reduction
    result = getattr(values, meth)(axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1577836800000000000, 1577923200000000000, 1578009600000000000,
       1578096000000000000, 1578182400000000000,...       1581724800000000000, 1581811200000000000, 1581897600000000000,
       1581984000000000000, 1582070400000000000])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
____ TestValidateTemporalSplit.test_valid_temporal_order_false_when_overlap ____

self = <test_models_validation.TestValidateTemporalSplit object at 0x15ad6b100>

    def test_valid_temporal_order_false_when_overlap(self):
        """Verify valid_temporal_order=False when dates overlap."""
        train_dates = pd.Series(pd.date_range("2020-01-01", periods=50))
        # Test dates overlap with training dates
        test_dates = pd.Series(pd.date_range("2020-01-25", periods=30))
    
>       validation = validate_temporal_split(train_dates, test_dates)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:600: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:264: in validate_temporal_split
    train_max = train_dates.max()
                ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6538: in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12469: in max
    return self._stat_function(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12442: in _stat_function
    return self._reduce(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6464: in _reduce
    return delegate._reduce(name, skipna=skipna, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/base.py:1958: in _reduce
    result = meth(skipna=skipna, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:181: in new_meth
    return meth(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:1597: in max
    result = nanops.nanmax(self._ndarray, axis=axis, skipna=skipna)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:147: in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:404: in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:1098: in reduction
    result = getattr(values, meth)(axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1577836800000000000, 1577923200000000000, 1578009600000000000,
       1578096000000000000, 1578182400000000000,...       1581724800000000000, 1581811200000000000, 1581897600000000000,
       1581984000000000000, 1582070400000000000])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestValidateTemporalSplit.test_gap_days_calculation ______________

self = <test_models_validation.TestValidateTemporalSplit object at 0x15ad6b230>

    def test_gap_days_calculation(self):
        """Verify gap_days = (test_min - train_max).days."""
        train_dates = pd.Series(pd.date_range("2020-01-01", periods=50))
        # Train ends 2020-02-19, test starts 2020-02-25
        test_dates = pd.Series(pd.date_range("2020-02-25", periods=30))
    
>       validation = validate_temporal_split(train_dates, test_dates)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:610: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:264: in validate_temporal_split
    train_max = train_dates.max()
                ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6538: in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12469: in max
    return self._stat_function(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12442: in _stat_function
    return self._reduce(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6464: in _reduce
    return delegate._reduce(name, skipna=skipna, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/base.py:1958: in _reduce
    result = meth(skipna=skipna, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:181: in new_meth
    return meth(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:1597: in max
    result = nanops.nanmax(self._ndarray, axis=axis, skipna=skipna)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:147: in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:404: in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:1098: in reduction
    result = getattr(values, meth)(axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1577836800000000000, 1577923200000000000, 1578009600000000000,
       1578096000000000000, 1578182400000000000,...       1581724800000000000, 1581811200000000000, 1581897600000000000,
       1581984000000000000, 1582070400000000000])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_______ TestValidateTemporalSplit.test_sufficient_gap_true_when_gap_met ________

self = <test_models_validation.TestValidateTemporalSplit object at 0x15adcbad0>

    def test_sufficient_gap_true_when_gap_met(self):
        """Verify sufficient_gap=True when gap >= min_gap_days."""
        train_dates = pd.Series(pd.date_range("2020-01-01", periods=50))
        test_dates = pd.Series(pd.date_range("2020-02-25", periods=30))
    
>       validation = validate_temporal_split(train_dates, test_dates, min_gap_days=5)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:620: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:264: in validate_temporal_split
    train_max = train_dates.max()
                ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6538: in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12469: in max
    return self._stat_function(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12442: in _stat_function
    return self._reduce(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6464: in _reduce
    return delegate._reduce(name, skipna=skipna, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/base.py:1958: in _reduce
    result = meth(skipna=skipna, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:181: in new_meth
    return meth(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:1597: in max
    result = nanops.nanmax(self._ndarray, axis=axis, skipna=skipna)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:147: in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:404: in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:1098: in reduction
    result = getattr(values, meth)(axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1577836800000000000, 1577923200000000000, 1578009600000000000,
       1578096000000000000, 1578182400000000000,...       1581724800000000000, 1581811200000000000, 1581897600000000000,
       1581984000000000000, 1582070400000000000])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
__ TestValidateTemporalSplit.test_sufficient_gap_false_when_gap_insufficient ___

self = <test_models_validation.TestValidateTemporalSplit object at 0x15ad668b0>

    def test_sufficient_gap_false_when_gap_insufficient(self):
        """Verify sufficient_gap=False when gap < min_gap_days."""
        train_dates = pd.Series(pd.date_range("2020-01-01", periods=50))
        test_dates = pd.Series(pd.date_range("2020-02-25", periods=30))
    
>       validation = validate_temporal_split(train_dates, test_dates, min_gap_days=10)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:629: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:264: in validate_temporal_split
    train_max = train_dates.max()
                ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6538: in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12469: in max
    return self._stat_function(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12442: in _stat_function
    return self._reduce(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6464: in _reduce
    return delegate._reduce(name, skipna=skipna, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/base.py:1958: in _reduce
    result = meth(skipna=skipna, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:181: in new_meth
    return meth(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:1597: in max
    result = nanops.nanmax(self._ndarray, axis=axis, skipna=skipna)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:147: in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:404: in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:1098: in reduction
    result = getattr(values, meth)(axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1577836800000000000, 1577923200000000000, 1578009600000000000,
       1578096000000000000, 1578182400000000000,...       1581724800000000000, 1581811200000000000, 1581897600000000000,
       1581984000000000000, 1582070400000000000])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
__________ TestValidateTemporalSplit.test_train_size_test_size_counts __________

self = <test_models_validation.TestValidateTemporalSplit object at 0x15ad669c0>

    def test_train_size_test_size_counts(self):
        """Verify train_size = len(train_dates), test_size = len(test_dates)."""
        train_dates = pd.Series(pd.date_range("2020-01-01", periods=50))
        test_dates = pd.Series(pd.date_range("2020-02-20", periods=30))
    
>       validation = validate_temporal_split(train_dates, test_dates)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:638: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:264: in validate_temporal_split
    train_max = train_dates.max()
                ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6538: in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12469: in max
    return self._stat_function(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12442: in _stat_function
    return self._reduce(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6464: in _reduce
    return delegate._reduce(name, skipna=skipna, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/base.py:1958: in _reduce
    result = meth(skipna=skipna, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:181: in new_meth
    return meth(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:1597: in max
    result = nanops.nanmax(self._ndarray, axis=axis, skipna=skipna)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:147: in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:404: in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:1098: in reduction
    result = getattr(values, meth)(axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1577836800000000000, 1577923200000000000, 1578009600000000000,
       1578096000000000000, 1578182400000000000,...       1581724800000000000, 1581811200000000000, 1581897600000000000,
       1581984000000000000, 1582070400000000000])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
____________ TestValidateTemporalSplit.test_test_ratio_calculation _____________

self = <test_models_validation.TestValidateTemporalSplit object at 0x15ad17a50>

    def test_test_ratio_calculation(self):
        """Verify test_ratio = test_size / (train_size + test_size)."""
        train_dates = pd.Series(pd.date_range("2020-01-01", periods=50))
        test_dates = pd.Series(pd.date_range("2020-02-20", periods=30))
    
>       validation = validate_temporal_split(train_dates, test_dates)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:648: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:264: in validate_temporal_split
    train_max = train_dates.max()
                ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6538: in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12469: in max
    return self._stat_function(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12442: in _stat_function
    return self._reduce(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6464: in _reduce
    return delegate._reduce(name, skipna=skipna, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/base.py:1958: in _reduce
    result = meth(skipna=skipna, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:181: in new_meth
    return meth(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:1597: in max
    result = nanops.nanmax(self._ndarray, axis=axis, skipna=skipna)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:147: in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:404: in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:1098: in reduction
    result = getattr(values, meth)(axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1577836800000000000, 1577923200000000000, 1578009600000000000,
       1578096000000000000, 1578182400000000000,...       1581724800000000000, 1581811200000000000, 1581897600000000000,
       1581984000000000000, 1582070400000000000])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_________ TestValidateTemporalSplit.test_custom_min_gap_days_parameter _________

self = <test_models_validation.TestValidateTemporalSplit object at 0x15ad17e50>

    def test_custom_min_gap_days_parameter(self):
        """Verify min_gap_days affects sufficient_gap result."""
        train_dates = pd.Series(pd.date_range("2020-01-01", periods=50))
        test_dates = pd.Series(pd.date_range("2020-02-25", periods=30))
    
        # Gap is 6 days
>       validation_5 = validate_temporal_split(train_dates, test_dates, min_gap_days=5)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:659: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:264: in validate_temporal_split
    train_max = train_dates.max()
                ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6538: in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12469: in max
    return self._stat_function(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12442: in _stat_function
    return self._reduce(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6464: in _reduce
    return delegate._reduce(name, skipna=skipna, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/base.py:1958: in _reduce
    result = meth(skipna=skipna, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:181: in new_meth
    return meth(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:1597: in max
    result = nanops.nanmax(self._ndarray, axis=axis, skipna=skipna)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:147: in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:404: in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:1098: in reduction
    result = getattr(values, meth)(axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1577836800000000000, 1577923200000000000, 1578009600000000000,
       1578096000000000000, 1578182400000000000,...       1581724800000000000, 1581811200000000000, 1581897600000000000,
       1581984000000000000, 1582070400000000000])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
____________ TestValidateTemporalSplit.test_handles_datetime_series ____________

self = <test_models_validation.TestValidateTemporalSplit object at 0x15aceb5c0>

    def test_handles_datetime_series(self):
        """Verify works with pd.Series of datetime timestamps."""
        train_dates = pd.Series([
            pd.Timestamp("2020-01-01"),
            pd.Timestamp("2020-01-15"),
            pd.Timestamp("2020-02-01")
        ])
        test_dates = pd.Series([
            pd.Timestamp("2020-02-10"),
            pd.Timestamp("2020-02-20"),
            pd.Timestamp("2020-03-01")
        ])
    
>       validation = validate_temporal_split(train_dates, test_dates)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_models_validation.py:678: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/models/validation.py:264: in validate_temporal_split
    train_max = train_dates.max()
                ^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6538: in max
    return NDFrame.max(self, axis, skipna, numeric_only, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12469: in max
    return self._stat_function(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:12442: in _stat_function
    return self._reduce(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/series.py:6464: in _reduce
    return delegate._reduce(name, skipna=skipna, **kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/base.py:1958: in _reduce
    result = meth(skipna=skipna, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:181: in new_meth
    return meth(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/datetimelike.py:1597: in max
    result = nanops.nanmax(self._ndarray, axis=axis, skipna=skipna)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:147: in f
    result = alt(values, axis=axis, skipna=skipna, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:404: in new_func
    result = func(values, axis=axis, skipna=skipna, mask=mask, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/nanops.py:1098: in reduction
    result = getattr(values, meth)(axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1577836800000000000, 1579046400000000000, 1580515200000000000])
axis = None, out = None, keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
___________________ TestLoadCrimeData.test_returns_dataframe ___________________

self = <test_data_loading.TestLoadCrimeData object at 0x15ae156d0>

    def test_returns_dataframe(self):
        """load_crime_data returns a pandas DataFrame."""
>       df = load_crime_data()
             ^^^^^^^^^^^^^^^^^

tests/test_data_loading.py:32: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/loading.py:97: in load_crime_data
    return cast(pd.DataFrame, _load_crime_data_parquet(clean=clean))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:607: in __call__
    return self._cached_call(args, kwargs, shelving=False)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:562: in _cached_call
    return self._call(call_id, args, kwargs, shelving)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:832: in _call
    output = self.func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/data/loading.py:60: in _load_crime_data_parquet
    df = pd.read_parquet(CRIME_DATA_PATH)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:669: in read_parquet
    return impl.read(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:279: in read
    result = arrow_table_to_pandas(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/_util.py:93: in arrow_table_to_pandas
    df = table.to_pandas(types_mapper=types_mapper, **to_pandas_kwargs)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyarrow/array.pxi:1020: in pyarrow.lib._PandasConvertible.to_pandas
    ???
pyarrow/table.pxi:5177: in pyarrow.lib.Table._to_pandas
    ???
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:823: in table_to_dataframe
    _reconstruct_block(item, column_names, ext_columns_dtypes)
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:737: in _reconstruct_block
    arr = _pandas_api.categorical_type.from_codes(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:758: in from_codes
    codes = cls._validate_codes_for_dtype(codes, dtype=dtype)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:1633: in _validate_codes_for_dtype
    if len(codes) and (codes.max() >= len(dtype.categories) or codes.min() < -1):
                       ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 0, 0, ..., 0, 0, 0], dtype=int16), axis = None, out = None
keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
__________________ TestLoadCrimeData.test_dataframe_not_empty __________________

self = <test_data_loading.TestLoadCrimeData object at 0x15ae15810>

    def test_dataframe_not_empty(self):
        """load_crime_data returns non-empty DataFrame."""
>       df = load_crime_data()
             ^^^^^^^^^^^^^^^^^

tests/test_data_loading.py:37: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/loading.py:97: in load_crime_data
    return cast(pd.DataFrame, _load_crime_data_parquet(clean=clean))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:607: in __call__
    return self._cached_call(args, kwargs, shelving=False)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:562: in _cached_call
    return self._call(call_id, args, kwargs, shelving)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:832: in _call
    output = self.func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/data/loading.py:60: in _load_crime_data_parquet
    df = pd.read_parquet(CRIME_DATA_PATH)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:669: in read_parquet
    return impl.read(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:279: in read
    result = arrow_table_to_pandas(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/_util.py:93: in arrow_table_to_pandas
    df = table.to_pandas(types_mapper=types_mapper, **to_pandas_kwargs)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyarrow/array.pxi:1020: in pyarrow.lib._PandasConvertible.to_pandas
    ???
pyarrow/table.pxi:5177: in pyarrow.lib.Table._to_pandas
    ???
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:823: in table_to_dataframe
    _reconstruct_block(item, column_names, ext_columns_dtypes)
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:737: in _reconstruct_block
    arr = _pandas_api.categorical_type.from_codes(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:758: in from_codes
    codes = cls._validate_codes_for_dtype(codes, dtype=dtype)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:1633: in _validate_codes_for_dtype
    if len(codes) and (codes.max() >= len(dtype.categories) or codes.min() < -1):
                       ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 0, 0, ..., 0, 0, 0], dtype=int16), axis = None, out = None
keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_________________ TestLoadCrimeData.test_has_expected_columns __________________

self = <test_data_loading.TestLoadCrimeData object at 0x15ae54180>

    def test_has_expected_columns(self):
        """DataFrame has expected columns for crime data."""
>       df = load_crime_data()
             ^^^^^^^^^^^^^^^^^

tests/test_data_loading.py:42: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/loading.py:97: in load_crime_data
    return cast(pd.DataFrame, _load_crime_data_parquet(clean=clean))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:607: in __call__
    return self._cached_call(args, kwargs, shelving=False)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:562: in _cached_call
    return self._call(call_id, args, kwargs, shelving)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:832: in _call
    output = self.func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/data/loading.py:60: in _load_crime_data_parquet
    df = pd.read_parquet(CRIME_DATA_PATH)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:669: in read_parquet
    return impl.read(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:279: in read
    result = arrow_table_to_pandas(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/_util.py:93: in arrow_table_to_pandas
    df = table.to_pandas(types_mapper=types_mapper, **to_pandas_kwargs)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyarrow/array.pxi:1020: in pyarrow.lib._PandasConvertible.to_pandas
    ???
pyarrow/table.pxi:5177: in pyarrow.lib.Table._to_pandas
    ???
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:823: in table_to_dataframe
    _reconstruct_block(item, column_names, ext_columns_dtypes)
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:737: in _reconstruct_block
    arr = _pandas_api.categorical_type.from_codes(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:758: in from_codes
    codes = cls._validate_codes_for_dtype(codes, dtype=dtype)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:1633: in _validate_codes_for_dtype
    if len(codes) and (codes.max() >= len(dtype.categories) or codes.min() < -1):
                       ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 0, 0, ..., 0, 0, 0], dtype=int16), axis = None, out = None
keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
___________ TestLoadCrimeData.test_clean_parameter_defaults_to_true ____________

self = <test_data_loading.TestLoadCrimeData object at 0x15ae542b0>

    def test_clean_parameter_defaults_to_true(self):
        """Default clean=True drops rows with missing dispatch_date."""
>       df = load_crime_data()
             ^^^^^^^^^^^^^^^^^

tests/test_data_loading.py:49: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/loading.py:97: in load_crime_data
    return cast(pd.DataFrame, _load_crime_data_parquet(clean=clean))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:607: in __call__
    return self._cached_call(args, kwargs, shelving=False)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:562: in _cached_call
    return self._call(call_id, args, kwargs, shelving)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:832: in _call
    output = self.func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/data/loading.py:60: in _load_crime_data_parquet
    df = pd.read_parquet(CRIME_DATA_PATH)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:669: in read_parquet
    return impl.read(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:279: in read
    result = arrow_table_to_pandas(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/_util.py:93: in arrow_table_to_pandas
    df = table.to_pandas(types_mapper=types_mapper, **to_pandas_kwargs)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyarrow/array.pxi:1020: in pyarrow.lib._PandasConvertible.to_pandas
    ???
pyarrow/table.pxi:5177: in pyarrow.lib.Table._to_pandas
    ???
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:823: in table_to_dataframe
    _reconstruct_block(item, column_names, ext_columns_dtypes)
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:737: in _reconstruct_block
    arr = _pandas_api.categorical_type.from_codes(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:758: in from_codes
    codes = cls._validate_codes_for_dtype(codes, dtype=dtype)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:1633: in _validate_codes_for_dtype
    if len(codes) and (codes.max() >= len(dtype.categories) or codes.min() < -1):
                       ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 0, 0, ..., 0, 0, 0], dtype=int16), axis = None, out = None
keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestLoadCrimeData.test_clean_false_includes_all_rows _____________

self = <test_data_loading.TestLoadCrimeData object at 0x15ae60170>

    def test_clean_false_includes_all_rows(self):
        """clean=False includes rows with missing dispatch_date."""
>       df_dirty = load_crime_data(clean=False)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_loading.py:54: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/loading.py:97: in load_crime_data
    return cast(pd.DataFrame, _load_crime_data_parquet(clean=clean))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:607: in __call__
    return self._cached_call(args, kwargs, shelving=False)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:562: in _cached_call
    return self._call(call_id, args, kwargs, shelving)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:832: in _call
    output = self.func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/data/loading.py:60: in _load_crime_data_parquet
    df = pd.read_parquet(CRIME_DATA_PATH)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:669: in read_parquet
    return impl.read(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:279: in read
    result = arrow_table_to_pandas(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/_util.py:93: in arrow_table_to_pandas
    df = table.to_pandas(types_mapper=types_mapper, **to_pandas_kwargs)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyarrow/array.pxi:1020: in pyarrow.lib._PandasConvertible.to_pandas
    ???
pyarrow/table.pxi:5177: in pyarrow.lib.Table._to_pandas
    ???
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:823: in table_to_dataframe
    _reconstruct_block(item, column_names, ext_columns_dtypes)
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:737: in _reconstruct_block
    arr = _pandas_api.categorical_type.from_codes(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:758: in from_codes
    codes = cls._validate_codes_for_dtype(codes, dtype=dtype)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:1633: in _validate_codes_for_dtype
    if len(codes) and (codes.max() >= len(dtype.categories) or codes.min() < -1):
                       ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 0, 0, ..., 0, 0, 0], dtype=int16), axis = None, out = None
keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_______________ TestLoadCrimeData.test_dispatch_date_is_datetime _______________

self = <test_data_loading.TestLoadCrimeData object at 0x15ad67bd0>

    def test_dispatch_date_is_datetime(self):
        """dispatch_date column is parsed as datetime."""
>       df = load_crime_data()
             ^^^^^^^^^^^^^^^^^

tests/test_data_loading.py:61: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/loading.py:97: in load_crime_data
    return cast(pd.DataFrame, _load_crime_data_parquet(clean=clean))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:607: in __call__
    return self._cached_call(args, kwargs, shelving=False)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:562: in _cached_call
    return self._call(call_id, args, kwargs, shelving)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:832: in _call
    output = self.func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/data/loading.py:60: in _load_crime_data_parquet
    df = pd.read_parquet(CRIME_DATA_PATH)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:669: in read_parquet
    return impl.read(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:279: in read
    result = arrow_table_to_pandas(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/_util.py:93: in arrow_table_to_pandas
    df = table.to_pandas(types_mapper=types_mapper, **to_pandas_kwargs)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyarrow/array.pxi:1020: in pyarrow.lib._PandasConvertible.to_pandas
    ???
pyarrow/table.pxi:5177: in pyarrow.lib.Table._to_pandas
    ???
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:823: in table_to_dataframe
    _reconstruct_block(item, column_names, ext_columns_dtypes)
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:737: in _reconstruct_block
    arr = _pandas_api.categorical_type.from_codes(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:758: in from_codes
    codes = cls._validate_codes_for_dtype(codes, dtype=dtype)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:1633: in _validate_codes_for_dtype
    if len(codes) and (codes.max() >= len(dtype.categories) or codes.min() < -1):
                       ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 0, 0, ..., 0, 0, 0], dtype=int16), axis = None, out = None
keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_______________ TestLoadCrimeData.test_cache_performance_speedup _______________

self = <test_data_loading.TestLoadCrimeData object at 0x15ad678a0>

    @pytest.mark.slow
    def test_cache_performance_speedup(self):
        """Second load is at least 5x faster than first load (cache hit).
    
        This test verifies that joblib caching provides significant
        performance improvement. Expected speedup is 10-20x, but we
        assert at least 5x to account for system variability.
        """
        import time
    
        # Clear cache to ensure first load reads from disk
        clear_cache()
    
        # First load (reads from parquet)
        start = time.time()
>       df1 = load_crime_data()
              ^^^^^^^^^^^^^^^^^

tests/test_data_loading.py:79: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/loading.py:97: in load_crime_data
    return cast(pd.DataFrame, _load_crime_data_parquet(clean=clean))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:607: in __call__
    return self._cached_call(args, kwargs, shelving=False)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:562: in _cached_call
    return self._call(call_id, args, kwargs, shelving)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:832: in _call
    output = self.func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/data/loading.py:60: in _load_crime_data_parquet
    df = pd.read_parquet(CRIME_DATA_PATH)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:669: in read_parquet
    return impl.read(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:279: in read
    result = arrow_table_to_pandas(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/_util.py:93: in arrow_table_to_pandas
    df = table.to_pandas(types_mapper=types_mapper, **to_pandas_kwargs)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyarrow/array.pxi:1020: in pyarrow.lib._PandasConvertible.to_pandas
    ???
pyarrow/table.pxi:5177: in pyarrow.lib.Table._to_pandas
    ???
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:823: in table_to_dataframe
    _reconstruct_block(item, column_names, ext_columns_dtypes)
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:737: in _reconstruct_block
    arr = _pandas_api.categorical_type.from_codes(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:758: in from_codes
    codes = cls._validate_codes_for_dtype(codes, dtype=dtype)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:1633: in _validate_codes_for_dtype
    if len(codes) and (codes.max() >= len(dtype.categories) or codes.min() < -1):
                       ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 0, 0, ..., 0, 0, 0], dtype=int16), axis = None, out = None
keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
----------------------------- Captured stdout call -----------------------------
Cache cleared: /Users/dustinober/Projects/Crime Incidents Philadelphia/.cache/joblib
______________ TestLoadCrimeData.test_cache_persists_across_calls ______________

self = <test_data_loading.TestLoadCrimeData object at 0x15adec250>

    @pytest.mark.slow
    def test_cache_persists_across_calls(self):
        """Cached result persists across multiple function calls."""
        clear_cache()
    
>       df1 = load_crime_data()
              ^^^^^^^^^^^^^^^^^

tests/test_data_loading.py:99: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/loading.py:97: in load_crime_data
    return cast(pd.DataFrame, _load_crime_data_parquet(clean=clean))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:607: in __call__
    return self._cached_call(args, kwargs, shelving=False)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:562: in _cached_call
    return self._call(call_id, args, kwargs, shelving)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:832: in _call
    output = self.func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/data/loading.py:60: in _load_crime_data_parquet
    df = pd.read_parquet(CRIME_DATA_PATH)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:669: in read_parquet
    return impl.read(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:279: in read
    result = arrow_table_to_pandas(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/_util.py:93: in arrow_table_to_pandas
    df = table.to_pandas(types_mapper=types_mapper, **to_pandas_kwargs)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyarrow/array.pxi:1020: in pyarrow.lib._PandasConvertible.to_pandas
    ???
pyarrow/table.pxi:5177: in pyarrow.lib.Table._to_pandas
    ???
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:823: in table_to_dataframe
    _reconstruct_block(item, column_names, ext_columns_dtypes)
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:737: in _reconstruct_block
    arr = _pandas_api.categorical_type.from_codes(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:758: in from_codes
    codes = cls._validate_codes_for_dtype(codes, dtype=dtype)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:1633: in _validate_codes_for_dtype
    if len(codes) and (codes.max() >= len(dtype.categories) or codes.min() < -1):
                       ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 0, 0, ..., 0, 0, 0], dtype=int16), axis = None, out = None
keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
----------------------------- Captured stdout call -----------------------------
Cache cleared: /Users/dustinober/Projects/Crime Incidents Philadelphia/.cache/joblib
________ TestLoadCrimeData.test_cache_key_different_for_clean_parameter ________

self = <test_data_loading.TestLoadCrimeData object at 0x15adeda50>

    def test_cache_key_different_for_clean_parameter(self):
        """Cache key includes 'clean' parameter."""
        clear_cache()
    
        # Load with clean=True (first call, reads from disk)
>       df1 = load_crime_data(clean=True)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_loading.py:111: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/loading.py:97: in load_crime_data
    return cast(pd.DataFrame, _load_crime_data_parquet(clean=clean))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:607: in __call__
    return self._cached_call(args, kwargs, shelving=False)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:562: in _cached_call
    return self._call(call_id, args, kwargs, shelving)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:832: in _call
    output = self.func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/data/loading.py:60: in _load_crime_data_parquet
    df = pd.read_parquet(CRIME_DATA_PATH)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:669: in read_parquet
    return impl.read(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:279: in read
    result = arrow_table_to_pandas(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/_util.py:93: in arrow_table_to_pandas
    df = table.to_pandas(types_mapper=types_mapper, **to_pandas_kwargs)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyarrow/array.pxi:1020: in pyarrow.lib._PandasConvertible.to_pandas
    ???
pyarrow/table.pxi:5177: in pyarrow.lib.Table._to_pandas
    ???
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:823: in table_to_dataframe
    _reconstruct_block(item, column_names, ext_columns_dtypes)
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:737: in _reconstruct_block
    arr = _pandas_api.categorical_type.from_codes(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:758: in from_codes
    codes = cls._validate_codes_for_dtype(codes, dtype=dtype)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:1633: in _validate_codes_for_dtype
    if len(codes) and (codes.max() >= len(dtype.categories) or codes.min() < -1):
                       ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 0, 0, ..., 0, 0, 0], dtype=int16), axis = None, out = None
keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
----------------------------- Captured stdout call -----------------------------
Cache cleared: /Users/dustinober/Projects/Crime Incidents Philadelphia/.cache/joblib
________________ TestCacheDirectory.test_cache_directory_exists ________________

self = <test_data_loading.TestCacheDirectory object at 0x15ae15950>

    def test_cache_directory_exists(self):
        """Cache directory .cache/joblib/ exists after first load."""
>       load_crime_data()

tests/test_data_loading.py:125: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/loading.py:97: in load_crime_data
    return cast(pd.DataFrame, _load_crime_data_parquet(clean=clean))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:607: in __call__
    return self._cached_call(args, kwargs, shelving=False)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:562: in _cached_call
    return self._call(call_id, args, kwargs, shelving)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:832: in _call
    output = self.func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/data/loading.py:60: in _load_crime_data_parquet
    df = pd.read_parquet(CRIME_DATA_PATH)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:669: in read_parquet
    return impl.read(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:279: in read
    result = arrow_table_to_pandas(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/_util.py:93: in arrow_table_to_pandas
    df = table.to_pandas(types_mapper=types_mapper, **to_pandas_kwargs)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyarrow/array.pxi:1020: in pyarrow.lib._PandasConvertible.to_pandas
    ???
pyarrow/table.pxi:5177: in pyarrow.lib.Table._to_pandas
    ???
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:823: in table_to_dataframe
    _reconstruct_block(item, column_names, ext_columns_dtypes)
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:737: in _reconstruct_block
    arr = _pandas_api.categorical_type.from_codes(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:758: in from_codes
    codes = cls._validate_codes_for_dtype(codes, dtype=dtype)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:1633: in _validate_codes_for_dtype
    if len(codes) and (codes.max() >= len(dtype.categories) or codes.min() < -1):
                       ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 0, 0, ..., 0, 0, 0], dtype=int16), axis = None, out = None
keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
___________ TestCacheDirectory.test_clear_cache_removes_cached_files ___________

self = <test_data_loading.TestCacheDirectory object at 0x15ae15a90>

    def test_clear_cache_removes_cached_files(self):
        """clear_cache() removes cached files from cache directory."""
        # Load data to populate cache
>       load_crime_data()

tests/test_data_loading.py:131: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/loading.py:97: in load_crime_data
    return cast(pd.DataFrame, _load_crime_data_parquet(clean=clean))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:607: in __call__
    return self._cached_call(args, kwargs, shelving=False)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:562: in _cached_call
    return self._call(call_id, args, kwargs, shelving)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:832: in _call
    output = self.func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/data/loading.py:60: in _load_crime_data_parquet
    df = pd.read_parquet(CRIME_DATA_PATH)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:669: in read_parquet
    return impl.read(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:279: in read
    result = arrow_table_to_pandas(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/_util.py:93: in arrow_table_to_pandas
    df = table.to_pandas(types_mapper=types_mapper, **to_pandas_kwargs)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyarrow/array.pxi:1020: in pyarrow.lib._PandasConvertible.to_pandas
    ???
pyarrow/table.pxi:5177: in pyarrow.lib.Table._to_pandas
    ???
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:823: in table_to_dataframe
    _reconstruct_block(item, column_names, ext_columns_dtypes)
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:737: in _reconstruct_block
    arr = _pandas_api.categorical_type.from_codes(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:758: in from_codes
    codes = cls._validate_codes_for_dtype(codes, dtype=dtype)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:1633: in _validate_codes_for_dtype
    if len(codes) and (codes.max() >= len(dtype.categories) or codes.min() < -1):
                       ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 0, 0, ..., 0, 0, 0], dtype=int16), axis = None, out = None
keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______ TestLoadBoundaries.test_load_police_districts_returns_geodataframe ______

self = <test_data_loading.TestLoadBoundaries object at 0x15ae543e0>

    @pytest.mark.skipif(
        not Path("data/boundaries/Police_Districts.geojson").exists(),
        reason="Boundary data file not found",
    )
    @pytest.mark.slow
    def test_load_police_districts_returns_geodataframe(self):
        """load_boundaries('police_districts') returns GeoDataFrame."""
        try:
            import geopandas as gpd
    
>           districts = load_boundaries("police_districts")
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_loading.py:176: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/loading.py:165: in load_boundaries
    gpd.GeoDataFrame.from_file(geojson_bytes).__geo_interface__["features"]
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/geopandas/geodataframe.py:1087: in __geo_interface__
    return self.to_geo_dict(na="null", show_bbox=True, drop_id=False)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/geopandas/geodataframe.py:1239: in to_geo_dict
    "features": list(
/opt/anaconda3/lib/python3.13/site-packages/geopandas/geodataframe.py:1141: in iterfeatures
    properties_cols = self[properties_cols]
                      ^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/geopandas/geodataframe.py:1891: in __getitem__
    result = super().__getitem__(key)
             ^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______ TestInternalLoadFunctions.test_internal_function_returns_dataframe ______

self = <test_data_loading.TestInternalLoadFunctions object at 0x15ae16210>

    @pytest.mark.slow
    def test_internal_function_returns_dataframe(self):
        """Internal function returns DataFrame with parsed dispatch_date."""
>       df = _load_crime_data_parquet(clean=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_loading.py:245: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:607: in __call__
    return self._cached_call(args, kwargs, shelving=False)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:562: in _cached_call
    return self._call(call_id, args, kwargs, shelving)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:832: in _call
    output = self.func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/data/loading.py:60: in _load_crime_data_parquet
    df = pd.read_parquet(CRIME_DATA_PATH)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:669: in read_parquet
    return impl.read(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/parquet.py:279: in read
    result = arrow_table_to_pandas(
/opt/anaconda3/lib/python3.13/site-packages/pandas/io/_util.py:93: in arrow_table_to_pandas
    df = table.to_pandas(types_mapper=types_mapper, **to_pandas_kwargs)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pyarrow/array.pxi:1020: in pyarrow.lib._PandasConvertible.to_pandas
    ???
pyarrow/table.pxi:5177: in pyarrow.lib.Table._to_pandas
    ???
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:823: in table_to_dataframe
    _reconstruct_block(item, column_names, ext_columns_dtypes)
/opt/anaconda3/lib/python3.13/site-packages/pyarrow/pandas_compat.py:737: in _reconstruct_block
    arr = _pandas_api.categorical_type.from_codes(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:758: in from_codes
    codes = cls._validate_codes_for_dtype(codes, dtype=dtype)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/arrays/categorical.py:1633: in _validate_codes_for_dtype
    if len(codes) and (codes.max() >= len(dtype.categories) or codes.min() < -1):
                       ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 0, 0, ..., 0, 0, 0], dtype=int16), axis = None, out = None
keepdims = False, initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
__________ TestDatetimeParsing.test_dispatch_date_with_invalid_values __________

self = <test_data_loading.TestDatetimeParsing object at 0x15ae54770>

    def test_dispatch_date_with_invalid_values(self):
        """dispatch_date parsing handles invalid values with errors='coerce'."""
        # Create a DataFrame with some invalid dates
        dates = ["2020-01-01", "invalid_date", "2020-01-03"]
        df = pd.DataFrame({"dispatch_date": dates})
    
        with patch("pandas.read_parquet", return_value=df):
            result = _load_crime_data_parquet(clean=False)
    
            # Verify dispatch_date was parsed to datetime
            assert pd.api.types.is_datetime64_any_dtype(result["dispatch_date"])
            # Verify invalid dates became NaT (invalid_date becomes NaT)
>           assert result["dispatch_date"].isna().sum() >= 1
E           assert 0 >= 1
E            +  where 0 = sum()
E            +    where sum = 0    False\n1    False\n2    False\nName: dispatch_date, dtype: bool.sum
E            +      where 0    False\n1    False\n2    False\nName: dispatch_date, dtype: bool = isna()
E            +        where isna = 0   2020-01-01\n1   2020-01-02\n2   2020-01-03\nName: dispatch_date, dtype: datetime64[ns].isna

tests/test_data_loading.py:358: AssertionError
___________ TestCleanParameter.test_clean_false_preserves_null_dates ___________

self = <test_data_loading.TestCleanParameter object at 0x15ae16c10>

    def test_clean_false_preserves_null_dates(self):
        """clean=False preserves rows with null dispatch_date."""
        # Create a DataFrame with some null dates
        dates = ["2020-01-01", None, "2020-01-03", None]
        df = pd.DataFrame({
            "dispatch_date": dates,
            "other_col": [1, 2, 3, 4]
        })
    
        with patch("pandas.read_parquet", return_value=df):
            result = _load_crime_data_parquet(clean=False)
    
            # All rows should be preserved
>           assert len(result) == 4
E           assert 3 == 4
E            +  where 3 = len(  dispatch_date\n0    2020-01-01\n1    2020-01-02\n2    2020-01-03)

tests/test_data_loading.py:377: AssertionError
_____________ TestCleanParameter.test_clean_true_drops_null_dates ______________

self = <test_data_loading.TestCleanParameter object at 0x15ae16d50>

    def test_clean_true_drops_null_dates(self):
        """clean=True drops rows with null dispatch_date."""
        # Create a DataFrame with some null dates
        dates = ["2020-01-01", None, "2020-01-03", None]
        df = pd.DataFrame({
            "dispatch_date": dates,
            "other_col": [1, 2, 3, 4]
        })
    
        with patch("pandas.read_parquet", return_value=df):
>           result = _load_crime_data_parquet(clean=True)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_loading.py:389: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:607: in __call__
    return self._cached_call(args, kwargs, shelving=False)[0]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:562: in _cached_call
    return self._call(call_id, args, kwargs, shelving)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/joblib/memory.py:832: in _call
    output = self.func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/data/loading.py:70: in _load_crime_data_parquet
    df = df.dropna(subset=["dispatch_date"])
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:6693: in dropna
    agg_obj = self.take(indices, axis=agg_axis)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
___________ TestFilterByDateRange.test_filter_by_start_and_end_date ____________

self = <test_data_preprocessing.TestFilterByDateRange object at 0x15ae17110>
sample_df =   dispatch_date  objectid  ucr_general
0    2019-12-01         1          100
1    2020-01-15         2          200
2    2020-06-01         3          300
3    2021-01-01         4          400
4    2021-12-31         5          500

    def test_filter_by_start_and_end_date(self, sample_df):
        """Filter DataFrame with both start and end date."""
>       result = filter_by_date_range(sample_df, "2020-01-01", "2020-12-31")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:39: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:60: in filter_by_date_range
    result = result[result[date_col] >= pd.to_datetime(start)]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4104: in __getitem__
    return self._getitem_bool_array(key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4166: in _getitem_bool_array
    return self._take_with_is_copy(indexer, axis=0)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1, 2, 3, 4]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestFilterByDateRange.test_filter_by_start_date_only _____________

self = <test_data_preprocessing.TestFilterByDateRange object at 0x15ae179d0>
sample_df =   dispatch_date  objectid  ucr_general
0    2019-12-01         1          100
1    2020-01-15         2          200
2    2020-06-01         3          300
3    2021-01-01         4          400
4    2021-12-31         5          500

    def test_filter_by_start_date_only(self, sample_df):
        """Filter DataFrame with only start date."""
>       result = filter_by_date_range(sample_df, start="2020-06-01")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:46: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:60: in filter_by_date_range
    result = result[result[date_col] >= pd.to_datetime(start)]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4104: in __getitem__
    return self._getitem_bool_array(key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4166: in _getitem_bool_array
    return self._take_with_is_copy(indexer, axis=0)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([2, 3, 4]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______________ TestFilterByDateRange.test_filter_by_end_date_only ______________

self = <test_data_preprocessing.TestFilterByDateRange object at 0x15ae54b00>
sample_df =   dispatch_date  objectid  ucr_general
0    2019-12-01         1          100
1    2020-01-15         2          200
2    2020-06-01         3          300
3    2021-01-01         4          400
4    2021-12-31         5          500

    def test_filter_by_end_date_only(self, sample_df):
        """Filter DataFrame with only end date."""
>       result = filter_by_date_range(sample_df, end="2020-12-31")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:52: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:63: in filter_by_date_range
    result = result[result[date_col] <= pd.to_datetime(end)]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4104: in __getitem__
    return self._getitem_bool_array(key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4166: in _getitem_bool_array
    return self._take_with_is_copy(indexer, axis=0)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1, 2]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_______________ TestFilterByDateRange.test_preserves_all_columns _______________

self = <test_data_preprocessing.TestFilterByDateRange object at 0x15ad67df0>
sample_df =   dispatch_date  objectid  ucr_general
0    2019-12-01         1          100
1    2020-01-15         2          200
2    2020-06-01         3          300
3    2021-01-01         4          400
4    2021-12-31         5          500

    def test_preserves_all_columns(self, sample_df):
        """Preserves all original columns."""
>       result = filter_by_date_range(sample_df, "2020-01-01", "2020-12-31")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:68: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:60: in filter_by_date_range
    result = result[result[date_col] >= pd.to_datetime(start)]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4104: in __getitem__
    return self._getitem_bool_array(key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4166: in _getitem_bool_array
    return self._take_with_is_copy(indexer, axis=0)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1, 2, 3, 4]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_______________ TestFilterByDateRange.test_returns_copy_not_view _______________

self = <test_data_preprocessing.TestFilterByDateRange object at 0x15ad67f00>
sample_df =   dispatch_date  objectid  ucr_general
0    2019-12-01         1          100
1    2020-01-15         2          200
2    2020-06-01         3          300
3    2021-01-01         4          400
4    2021-12-31         5          500

    def test_returns_copy_not_view(self, sample_df):
        """Returns a copy, not a view."""
>       result = filter_by_date_range(sample_df, "2020-01-01", "2020-12-31")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:73: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:60: in filter_by_date_range
    result = result[result[date_col] >= pd.to_datetime(start)]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4104: in __getitem__
    return self._getitem_bool_array(key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4166: in _getitem_bool_array
    return self._take_with_is_copy(indexer, axis=0)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1, 2, 3, 4]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
________________ TestFilterByDateRange.test_string_date_column _________________

self = <test_data_preprocessing.TestFilterByDateRange object at 0x15adedb50>
sample_df =   dispatch_date  objectid  ucr_general
0    2019-12-01         1          100
1    2020-01-15         2          200
2    2020-06-01         3          300
3    2021-01-01         4          400
4    2021-12-31         5          500

    def test_string_date_column(self, sample_df):
        """Handles date column as string.
    
        Note: The filter_by_date_range function expects the date_col to already
        be datetime or comparable to datetime. String dates that can be compared
        will work, but pandas comparison behavior may vary.
        """
        df = sample_df.copy()
        # Keep as datetime - function expects datetime column
>       result = filter_by_date_range(df, "2020-01-01", "2020-12-31")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:86: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:60: in filter_by_date_range
    result = result[result[date_col] >= pd.to_datetime(start)]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4104: in __getitem__
    return self._getitem_bool_array(key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4166: in _getitem_bool_array
    return self._take_with_is_copy(indexer, axis=0)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1, 2, 3, 4]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
________________ TestFilterByDateRange.test_custom_date_column _________________

self = <test_data_preprocessing.TestFilterByDateRange object at 0x15adedd50>

    def test_custom_date_column(self):
        """Filter using custom date column name."""
        df = pd.DataFrame(
            {
                "custom_date": pd.to_datetime(["2020-01-01", "2020-06-01", "2021-01-01"]),
                "value": [1, 2, 3],
            }
        )
>       result = filter_by_date_range(df, "2020-01-01", "2020-12-31", date_col="custom_date")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:97: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:63: in filter_by_date_range
    result = result[result[date_col] <= pd.to_datetime(end)]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4104: in __getitem__
    return self._getitem_bool_array(key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4166: in _getitem_bool_array
    return self._take_with_is_copy(indexer, axis=0)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_________________ TestAggregateByPeriod.test_daily_aggregation _________________

self = <test_data_preprocessing.TestAggregateByPeriod object at 0x15ae17b10>
sample_df =   dispatch_date  objectid  ucr_general
0    2020-01-01         1          100
1    2020-01-15         2          200
2...00
3    2020-03-01         4          400
4    2020-04-01         5          500
5    2020-05-01         6          600

    def test_daily_aggregation(self, sample_df):
        """Aggregate by day (period='D').
    
        Note: resample creates all dates in the range, including empty ones
        (count=0). This is expected pandas resample behavior.
        """
>       result = aggregate_by_period(sample_df, period="D")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:142: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:116: in aggregate_by_period
    df_copy = df.set_index(date_col)
              ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:6208: in set_index
    del frame[c]
        ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4529: in __delitem__
    self._mgr = self._mgr.idelete(loc)
                ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:1461: in idelete
    nbs = self._slice_take_blocks_ax0(taker, only_slice=True, ref_inplace_op=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
________________ TestAggregateByPeriod.test_weekly_aggregation _________________

self = <test_data_preprocessing.TestAggregateByPeriod object at 0x15ae17c50>
sample_df =   dispatch_date  objectid  ucr_general
0    2020-01-01         1          100
1    2020-01-15         2          200
2...00
3    2020-03-01         4          400
4    2020-04-01         5          500
5    2020-05-01         6          600

    def test_weekly_aggregation(self, sample_df):
        """Aggregate by week (period='W').
    
        Note: resample creates all weeks in the range, including empty ones.
        """
>       result = aggregate_by_period(sample_df, period="W")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:154: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:116: in aggregate_by_period
    df_copy = df.set_index(date_col)
              ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:6208: in set_index
    del frame[c]
        ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4529: in __delitem__
    self._mgr = self._mgr.idelete(loc)
                ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:1461: in idelete
    nbs = self._slice_take_blocks_ax0(taker, only_slice=True, ref_inplace_op=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
________________ TestAggregateByPeriod.test_monthly_aggregation ________________

self = <test_data_preprocessing.TestAggregateByPeriod object at 0x15ae54d60>
sample_df =   dispatch_date  objectid  ucr_general
0    2020-01-01         1          100
1    2020-01-15         2          200
2...00
3    2020-03-01         4          400
4    2020-04-01         5          500
5    2020-05-01         6          600

    def test_monthly_aggregation(self, sample_df):
        """Aggregate by month (period='ME')."""
>       result = aggregate_by_period(sample_df, period="ME")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:162: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:116: in aggregate_by_period
    df_copy = df.set_index(date_col)
              ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:6208: in set_index
    del frame[c]
        ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4529: in __delitem__
    self._mgr = self._mgr.idelete(loc)
                ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:1461: in idelete
    nbs = self._slice_take_blocks_ax0(taker, only_slice=True, ref_inplace_op=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
________________ TestAggregateByPeriod.test_yearly_aggregation _________________

self = <test_data_preprocessing.TestAggregateByPeriod object at 0x15ae54e90>
sample_df =   dispatch_date  objectid  ucr_general
0    2020-01-01         1          100
1    2020-01-15         2          200
2...00
3    2020-03-01         4          400
4    2020-04-01         5          500
5    2020-05-01         6          600

    def test_yearly_aggregation(self, sample_df):
        """Aggregate by year (period='YE')."""
>       result = aggregate_by_period(sample_df, period="YE")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:169: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:116: in aggregate_by_period
    df_copy = df.set_index(date_col)
              ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:6208: in set_index
    del frame[c]
        ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4529: in __delitem__
    self._mgr = self._mgr.idelete(loc)
                ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:1461: in idelete
    nbs = self._slice_take_blocks_ax0(taker, only_slice=True, ref_inplace_op=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
___________ TestAggregateByPeriod.test_count_column_named_correctly ____________

self = <test_data_preprocessing.TestAggregateByPeriod object at 0x15ae90290>
sample_df =   dispatch_date  objectid  ucr_general
0    2020-01-01         1          100
1    2020-01-15         2          200
2...00
3    2020-03-01         4          400
4    2020-04-01         5          500
5    2020-05-01         6          600

    def test_count_column_named_correctly(self, sample_df):
        """Count column is named 'count'."""
>       result = aggregate_by_period(sample_df, period="ME")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:176: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:116: in aggregate_by_period
    df_copy = df.set_index(date_col)
              ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:6208: in set_index
    del frame[c]
        ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4529: in __delitem__
    self._mgr = self._mgr.idelete(loc)
                ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:1461: in idelete
    nbs = self._slice_take_blocks_ax0(taker, only_slice=True, ref_inplace_op=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestAggregateByPeriod.test_count_values_are_correct ______________

self = <test_data_preprocessing.TestAggregateByPeriod object at 0x15ae80050>
sample_df =   dispatch_date  objectid  ucr_general
0    2020-01-01         1          100
1    2020-01-15         2          200
2...00
3    2020-03-01         4          400
4    2020-04-01         5          500
5    2020-05-01         6          600

    def test_count_values_are_correct(self, sample_df):
        """Count values match number of incidents per period."""
>       result = aggregate_by_period(sample_df, period="ME")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:181: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:116: in aggregate_by_period
    df_copy = df.set_index(date_col)
              ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:6208: in set_index
    del frame[c]
        ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4529: in __delitem__
    self._mgr = self._mgr.idelete(loc)
                ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:1461: in idelete
    nbs = self._slice_take_blocks_ax0(taker, only_slice=True, ref_inplace_op=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
________________ TestAggregateByPeriod.test_custom_count_column ________________

self = <test_data_preprocessing.TestAggregateByPeriod object at 0x15ae80160>

    def test_custom_count_column(self):
        """Use custom column for counting."""
        df = pd.DataFrame(
            {
                "dispatch_date": pd.to_datetime(["2020-01-01", "2020-01-15", "2020-02-01"]),
                "custom_id": [1, 2, 3],
            }
        )
>       result = aggregate_by_period(df, period="ME", count_col="custom_id")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:194: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:116: in aggregate_by_period
    df_copy = df.set_index(date_col)
              ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:6208: in set_index
    del frame[c]
        ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4529: in __delitem__
    self._mgr = self._mgr.idelete(loc)
                ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:1461: in idelete
    nbs = self._slice_take_blocks_ax0(taker, only_slice=True, ref_inplace_op=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
________________ TestAggregateByPeriod.test_custom_date_column _________________

self = <test_data_preprocessing.TestAggregateByPeriod object at 0x15adede50>

    def test_custom_date_column(self):
        """Use custom date column."""
        df = pd.DataFrame(
            {
                "custom_date": pd.to_datetime(["2020-01-01", "2020-01-15", "2020-02-01"]),
                "objectid": [1, 2, 3],
            }
        )
>       result = aggregate_by_period(df, period="ME", date_col="custom_date")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:206: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:116: in aggregate_by_period
    df_copy = df.set_index(date_col)
              ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:6208: in set_index
    del frame[c]
        ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4529: in __delitem__
    self._mgr = self._mgr.idelete(loc)
                ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:1461: in idelete
    nbs = self._slice_take_blocks_ax0(taker, only_slice=True, ref_inplace_op=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
___________ TestAggregateByPeriod.test_empty_dataframe_returns_empty ___________

self = <test_data_preprocessing.TestAggregateByPeriod object at 0x15add8140>

    def test_empty_dataframe_returns_empty(self):
        """Handles empty DataFrame."""
        df = pd.DataFrame({"dispatch_date": pd.to_datetime([]), "objectid": []})
>       result = aggregate_by_period(df, period="ME")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:225: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:116: in aggregate_by_period
    df_copy = df.set_index(date_col)
              ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:6208: in set_index
    del frame[c]
        ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4529: in __delitem__
    self._mgr = self._mgr.idelete(loc)
                ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:1461: in idelete
    nbs = self._slice_take_blocks_ax0(taker, only_slice=True, ref_inplace_op=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______________ TestAggregateByPeriod.test_month_start_aggregation ______________

self = <test_data_preprocessing.TestAggregateByPeriod object at 0x15ae89710>
sample_df =   dispatch_date  objectid  ucr_general
0    2020-01-01         1          100
1    2020-01-15         2          200
2...00
3    2020-03-01         4          400
4    2020-04-01         5          500
5    2020-05-01         6          600

    def test_month_start_aggregation(self, sample_df):
        """Aggregate by month start (period='MS')."""
>       result = aggregate_by_period(sample_df, period="MS")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_preprocessing.py:230: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/preprocessing.py:116: in aggregate_by_period
    df_copy = df.set_index(date_col)
              ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:6208: in set_index
    del frame[c]
        ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4529: in __delitem__
    self._mgr = self._mgr.idelete(loc)
                ^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:1461: in idelete
    nbs = self._slice_take_blocks_ax0(taker, only_slice=True, ref_inplace_op=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
________ TestValidateCoordinates.test_invalid_coordinates_filtered_out _________

self = <test_data_validation.TestValidateCoordinates object at 0x15aeac910>

    def test_invalid_coordinates_filtered_out(self):
        """Invalid coordinates outside Philly bounds are filtered out."""
        df = pd.DataFrame(
            {
                "point_x": [-75.16, -100.0, -75.10],  # -100.0 is invalid
                "point_y": [39.95, 40.00, 50.0],  # 50.0 is invalid
            }
        )
>       result = validate_coordinates(df)
                 ^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_validation.py:212: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/validation.py:227: in validate_coordinates
    return result[valid_mask].copy()
           ^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4104: in __getitem__
    return self._getitem_bool_array(key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4166: in _getitem_bool_array
    return self._take_with_is_copy(indexer, axis=0)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
__________ TestValidateCoordinates.test_none_coordinates_filtered_out __________

self = <test_data_validation.TestValidateCoordinates object at 0x15ae55ba0>

    def test_none_coordinates_filtered_out(self):
        """None/NaN coordinates are filtered out."""
        df = pd.DataFrame(
            {
                "point_x": [-75.16, None, -75.10],
                "point_y": [39.95, 40.00, None],
            }
        )
>       result = validate_coordinates(df)
                 ^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_validation.py:223: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/validation.py:227: in validate_coordinates
    return result[valid_mask].copy()
           ^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4104: in __getitem__
    return self._getitem_bool_array(key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4166: in _getitem_bool_array
    return self._take_with_is_copy(indexer, axis=0)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______ TestValidateCrimeData.test_sample_size_parameter_limits_validation ______

self = <test_data_validation.TestValidateCrimeData object at 0x15ae80c00>
valid_sample_df = <[TypeError("int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'") raised in repr()] DataFrame object at 0x178a16890>

    def test_sample_size_parameter_limits_validation(self, valid_sample_df):
        """sample_size parameter limits number of rows validated."""
        # Should only validate first 2 rows (default sample_size=1000)
>       result = validate_crime_data(valid_sample_df, sample_size=2)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_data_validation.py:351: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/data/validation.py:145: in validate_crime_data
    df.sample(n=sample_size_actual, random_state=42) if len(df) > sample_size_actual else df
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:6141: in sample
    result = self.take(sampled_indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1, 4]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_______ TestCleanCoordinates.test_filters_valid_philadelphia_coordinates _______

self = <test_utils_spatial.TestCleanCoordinates object at 0x15aeacf50>

    def test_filters_valid_philadelphia_coordinates(self):
        """Filters to valid Philadelphia coordinates only."""
        df = pd.DataFrame({
            "point_x": [-75.16, -100.0, -75.20],  # Middle invalid
            "point_y": [39.95, 40.0, 40.0],       # Middle invalid (lon out of bounds)
            "id": [1, 2, 3]
        })
    
>       result = clean_coordinates(df)
                 ^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:59: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:91: in clean_coordinates
    return df[mask].copy()
           ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4104: in __getitem__
    return self._getitem_bool_array(key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4166: in _getitem_bool_array
    return self._take_with_is_copy(indexer, axis=0)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 2]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
____________ TestCleanCoordinates.test_filters_out_nan_coordinates _____________

self = <test_utils_spatial.TestCleanCoordinates object at 0x15aead1d0>

    def test_filters_out_nan_coordinates(self):
        """Filters out rows with NaN in point_x or point_y."""
        df = pd.DataFrame({
            "point_x": [-75.16, None, -75.20],
            "point_y": [39.95, 40.0, None],
            "id": [1, 2, 3]
        })
    
>       result = clean_coordinates(df)
                 ^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:72: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:91: in clean_coordinates
    return df[mask].copy()
           ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4104: in __getitem__
    return self._getitem_bool_array(key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4166: in _getitem_bool_array
    return self._take_with_is_copy(indexer, axis=0)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_______ TestGetCoordinateStats.test_has_coordinates_counts_valid_coords ________

self = <test_utils_spatial.TestGetCoordinateStats object at 0x15ae57230>

    def test_has_coordinates_counts_valid_coords(self):
        """has_coordinates counts rows with non-NaN coordinates."""
        df = pd.DataFrame({
            "point_x": [-75.16, None, -75.20],
            "point_y": [39.95, 40.0, None]
        })
    
>       stats = get_coordinate_stats(df)
                ^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:373: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:369: in get_coordinate_stats
    df_clean = clean_coordinates(df, x_col, y_col)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/utils/spatial.py:91: in clean_coordinates
    return df[mask].copy()
           ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4104: in __getitem__
    return self._getitem_bool_array(key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4166: in _getitem_bool_array
    return self._take_with_is_copy(indexer, axis=0)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
____ TestGetCoordinateStats.test_in_philadelphia_bounds_counts_valid_coords ____

self = <test_utils_spatial.TestGetCoordinateStats object at 0x15ae57360>

    def test_in_philadelphia_bounds_counts_valid_coords(self):
        """Counts coordinates in Philadelphia bounds."""
        df = pd.DataFrame({
            "point_x": [-75.16, -100.0, -75.20],  # Middle out of bounds
            "point_y": [39.95, 40.0, 50.0]
        })
    
>       stats = get_coordinate_stats(df)
                ^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:385: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:369: in get_coordinate_stats
    df_clean = clean_coordinates(df, x_col, y_col)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/utils/spatial.py:91: in clean_coordinates
    return df[mask].copy()
           ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4104: in __getitem__
    return self._getitem_bool_array(key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4166: in _getitem_bool_array
    return self._take_with_is_copy(indexer, axis=0)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
____________ TestGetCoordinateStats.test_coverage_rate_calculation _____________

self = <test_utils_spatial.TestGetCoordinateStats object at 0x15aefc170>

    def test_coverage_rate_calculation(self):
        """coverage_rate = has_coordinates / total_records."""
        df = pd.DataFrame({
            "point_x": [-75.16, None, -75.20],
            "point_y": [39.95, 40.0, None]
        })
    
>       stats = get_coordinate_stats(df)
                ^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:397: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:369: in get_coordinate_stats
    df_clean = clean_coordinates(df, x_col, y_col)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/utils/spatial.py:91: in clean_coordinates
    return df[mask].copy()
           ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4104: in __getitem__
    return self._getitem_bool_array(key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4166: in _getitem_bool_array
    return self._take_with_is_copy(indexer, axis=0)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
____________ TestGetCoordinateStats.test_in_bounds_rate_calculation ____________

self = <test_utils_spatial.TestGetCoordinateStats object at 0x15ae818c0>

    def test_in_bounds_rate_calculation(self):
        """in_bounds_rate = in_philadelphia_bounds / total_records."""
        df = pd.DataFrame({
            "point_x": [-75.16, -100.0, -75.20],  # Middle out of bounds
            "point_y": [39.95, 40.0, 50.0]
        })
    
>       stats = get_coordinate_stats(df)
                ^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:409: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:369: in get_coordinate_stats
    df_clean = clean_coordinates(df, x_col, y_col)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
analysis/utils/spatial.py:91: in clean_coordinates
    return df[mask].copy()
           ^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4104: in __getitem__
    return self._getitem_bool_array(key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4166: in _getitem_bool_array
    return self._take_with_is_copy(indexer, axis=0)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:912: in take
    new_labels = self.axes[axis].take(indexer)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/indexes/range.py:1168: in take
    ind_max = indices.max()
              ^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____ TestSpatialJoinDistricts.test_returns_dataframe_with_joined_dist_num _____

self = <test_utils_spatial.TestSpatialJoinDistricts object at 0x15aeae0d0>
mock_clean = <MagicMock name='clean_coordinates' id='6319753264'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='6319753600'>
mock_sjoin = <MagicMock name='sjoin' id='6319753936'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_returns_dataframe_with_joined_dist_num(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Returns DataFrame with 'joined_dist_num' column."""
        # Setup mocks
        mock_clean.return_value = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "id": [1]
        })
    
        mock_gdf = MagicMock()
        mock_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = mock_gdf
    
        mock_joined = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "id": [1],
            "dist_num": [1],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "id": [1]
        })
    
>       result = spatial_join_districts(crime_df, district_gdf=None)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:688: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:210: in spatial_join_districts
    district_gdf[["dist_num", "geometry"]],
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/geopandas/geodataframe.py:1891: in __getitem__
    result = super().__getitem__(key)
             ^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_______ TestSpatialJoinDistricts.test_calls_clean_coordinates_internally _______

self = <test_utils_spatial.TestSpatialJoinDistricts object at 0x15aeae210>
mock_clean = <MagicMock name='clean_coordinates' id='5826274576'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='5826276256'>
mock_sjoin = <MagicMock name='sjoin' id='5826276928'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_calls_clean_coordinates_internally(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Calls coordinate cleaning before join."""
        mock_clean.return_value = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95]
        })
    
        mock_gdf = MagicMock()
        mock_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = mock_gdf
    
        mock_joined = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "dist_num": [1],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({"point_x": [-75.16], "point_y": [39.95]})
    
>       spatial_join_districts(crime_df, district_gdf=None)

tests/test_utils_spatial.py:718: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:210: in spatial_join_districts
    district_gdf[["dist_num", "geometry"]],
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/geopandas/geodataframe.py:1891: in __getitem__
    result = super().__getitem__(key)
             ^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______ TestSpatialJoinDistricts.test_calls_df_to_geodataframe_internally _______

self = <test_utils_spatial.TestSpatialJoinDistricts object at 0x15ae57950>
mock_clean = <MagicMock name='clean_coordinates' id='5826270880'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='5826280288'>
mock_sjoin = <MagicMock name='sjoin' id='5826271216'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_calls_df_to_geodataframe_internally(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Calls conversion to GeoDataFrame."""
        mock_clean.return_value = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95]
        })
    
        mock_gdf = MagicMock()
        mock_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = mock_gdf
    
        mock_joined = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "dist_num": [1],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({"point_x": [-75.16], "point_y": [39.95]})
    
>       spatial_join_districts(crime_df, district_gdf=None)

tests/test_utils_spatial.py:747: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:210: in spatial_join_districts
    district_gdf[["dist_num", "geometry"]],
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/geopandas/geodataframe.py:1891: in __getitem__
    result = super().__getitem__(key)
             ^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
____________ TestSpatialJoinDistricts.test_drops_index_right_column ____________

self = <test_utils_spatial.TestSpatialJoinDistricts object at 0x15ae57a80>
mock_clean = <MagicMock name='clean_coordinates' id='6319751248'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='6319751584'>
mock_sjoin = <MagicMock name='sjoin' id='6319751920'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_drops_index_right_column(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Drops 'index_right' cleanup column."""
        mock_clean.return_value = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95]
        })
    
        mock_gdf = MagicMock()
        mock_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = mock_gdf
    
        mock_joined = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "dist_num": [1],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({"point_x": [-75.16], "point_y": [39.95]})
    
>       result = spatial_join_districts(crime_df, district_gdf=None)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:776: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:210: in spatial_join_districts
    district_gdf[["dist_num", "geometry"]],
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/geopandas/geodataframe.py:1891: in __getitem__
    result = super().__getitem__(key)
             ^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestSpatialJoinDistricts.test_drops_geometry_column ______________

self = <test_utils_spatial.TestSpatialJoinDistricts object at 0x15aefd910>
mock_clean = <MagicMock name='clean_coordinates' id='5826271216'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='5826270880'>
mock_sjoin = <MagicMock name='sjoin' id='5826273568'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_drops_geometry_column(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Drops 'geometry' column from output."""
        mock_clean.return_value = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95]
        })
    
        mock_gdf = MagicMock()
        mock_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = mock_gdf
    
        mock_joined = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "dist_num": [1],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({"point_x": [-75.16], "point_y": [39.95]})
    
>       result = spatial_join_districts(crime_df, district_gdf=None)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:805: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:210: in spatial_join_districts
    district_gdf[["dist_num", "geometry"]],
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/geopandas/geodataframe.py:1891: in __getitem__
    result = super().__getitem__(key)
             ^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_________ TestSpatialJoinDistricts.test_custom_x_col_y_col_parameters __________

self = <test_utils_spatial.TestSpatialJoinDistricts object at 0x15ae81e10>
mock_clean = <MagicMock name='clean_coordinates' id='6319756288'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='6319756960'>
mock_sjoin = <MagicMock name='sjoin' id='6319753264'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_custom_x_col_y_col_parameters(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Custom column names work."""
        mock_clean.return_value = pd.DataFrame({
            "custom_lon": [-75.16],
            "custom_lat": [39.95]
        })
    
        mock_gdf = MagicMock()
        mock_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = mock_gdf
    
        mock_joined = pd.DataFrame({
            "custom_lon": [-75.16],
            "custom_lat": [39.95],
            "dist_num": [1],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({
            "custom_lon": [-75.16],
            "custom_lat": [39.95]
        })
    
>       result = spatial_join_districts(
            crime_df,
            district_gdf=None,
            x_col="custom_lon",
            y_col="custom_lat"
        )

tests/test_utils_spatial.py:837: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:210: in spatial_join_districts
    district_gdf[["dist_num", "geometry"]],
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/geopandas/geodataframe.py:1891: in __getitem__
    result = super().__getitem__(key)
             ^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([1]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
___________ TestSpatialJoinDistricts.test_provided_district_gdf_used ___________

self = <test_utils_spatial.TestSpatialJoinDistricts object at 0x15ae81f20>
mock_clean = <MagicMock name='clean_coordinates' id='5826270880'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='5826280288'>
mock_sjoin = <MagicMock name='sjoin' id='5826273568'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_provided_district_gdf_used(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Custom district_gdf parameter used when provided."""
        mock_clean.return_value = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95]
        })
    
        crime_gdf = MagicMock()
        crime_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = crime_gdf
    
        # Create custom district gdf
        custom_district_gdf = MagicMock()
        custom_district_gdf.crs = "EPSG:4326"
        custom_district_gdf.__getitem__ = lambda self, key: custom_district_gdf
        custom_district_gdf.columns = ["dist_num", "geometry"]
    
        mock_joined = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "dist_num": [5],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({"point_x": [-75.16], "point_y": [39.95]})
    
>       result = spatial_join_districts(crime_df, district_gdf=custom_district_gdf)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:881: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:221: in spatial_join_districts
    joined = joined.drop(columns=["index_right"])
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:5603: in drop
    return super().drop(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4810: in drop
    obj = obj._drop_axis(labels, axis, level=level, errors=errors)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4891: in _drop_axis
    new_mgr = self._mgr.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______________ TestSpatialJoinDistricts.test_handles_crs_mismatch ______________

self = <test_utils_spatial.TestSpatialJoinDistricts object at 0x15adefb50>
mock_clean = <MagicMock name='clean_coordinates' id='6319757632'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='6319758304'>
mock_sjoin = <MagicMock name='sjoin' id='6319752928'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_handles_crs_mismatch(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Handles CRS conversion when district_gdf.crs != crime_gdf.crs."""
        mock_clean.return_value = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95]
        })
    
        crime_gdf = MagicMock()
        crime_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = crime_gdf
    
        # Create district gdf with different CRS
        district_gdf = MagicMock()
        district_gdf.crs = "EPSG:3857"
        district_gdf.__getitem__ = lambda self, key: district_gdf
        district_gdf.columns = ["dist_num", "geometry"]
    
        # Mock to_crs to return self
        district_gdf.to_crs = lambda crs: district_gdf
    
        mock_joined = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "dist_num": [1],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({"point_x": [-75.16], "point_y": [39.95]})
    
>       result = spatial_join_districts(crime_df, district_gdf=district_gdf)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:919: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:221: in spatial_join_districts
    joined = joined.drop(columns=["index_right"])
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:5603: in drop
    return super().drop(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4810: in drop
    obj = obj._drop_axis(labels, axis, level=level, errors=errors)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4891: in _drop_axis
    new_mgr = self._mgr.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_______ TestSpatialJoinTracts.test_returns_dataframe_with_tract_columns ________

self = <test_utils_spatial.TestSpatialJoinTracts object at 0x15aeae350>
mock_clean = <MagicMock name='clean_coordinates' id='5826273568'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='5826280288'>
mock_sjoin = <MagicMock name='sjoin' id='5826270880'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_returns_dataframe_with_tract_columns(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Returns DataFrame with GEOID and/or total_pop columns."""
        mock_clean.return_value = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95]
        })
    
        mock_gdf = MagicMock()
        mock_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = mock_gdf
    
        mock_joined = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "GEOID": ["42101010100"],
            "total_pop": [1000],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({"point_x": [-75.16], "point_y": [39.95]})
    
>       result = spatial_join_tracts(crime_df, tract_gdf=None)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:953: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:274: in spatial_join_tracts
    tract_gdf[available_cols],
    ^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/geopandas/geodataframe.py:1891: in __getitem__
    result = super().__getitem__(key)
             ^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([3]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
________ TestSpatialJoinTracts.test_calls_clean_coordinates_internally _________

self = <test_utils_spatial.TestSpatialJoinTracts object at 0x15aeae490>
mock_clean = <MagicMock name='clean_coordinates' id='6319754272'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='6319759984'>
mock_sjoin = <MagicMock name='sjoin' id='6319758640'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_calls_clean_coordinates_internally(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Calls coordinate cleaning before join."""
        mock_clean.return_value = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95]
        })
    
        mock_gdf = MagicMock()
        mock_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = mock_gdf
    
        mock_joined = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "GEOID": ["42101010100"],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({"point_x": [-75.16], "point_y": [39.95]})
    
>       spatial_join_tracts(crime_df, tract_gdf=None)

tests/test_utils_spatial.py:983: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:274: in spatial_join_tracts
    tract_gdf[available_cols],
    ^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/geopandas/geodataframe.py:1891: in __getitem__
    result = super().__getitem__(key)
             ^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([3]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
________ TestSpatialJoinTracts.test_calls_df_to_geodataframe_internally ________

self = <test_utils_spatial.TestSpatialJoinTracts object at 0x15ae57bb0>
mock_clean = <MagicMock name='clean_coordinates' id='5826270880'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='5826280288'>
mock_sjoin = <MagicMock name='sjoin' id='5826273568'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_calls_df_to_geodataframe_internally(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Calls conversion to GeoDataFrame."""
        mock_clean.return_value = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95]
        })
    
        mock_gdf = MagicMock()
        mock_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = mock_gdf
    
        mock_joined = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "GEOID": ["42101010100"],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({"point_x": [-75.16], "point_y": [39.95]})
    
>       spatial_join_tracts(crime_df, tract_gdf=None)

tests/test_utils_spatial.py:1012: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:274: in spatial_join_tracts
    tract_gdf[available_cols],
    ^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/geopandas/geodataframe.py:1891: in __getitem__
    result = super().__getitem__(key)
             ^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([3]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_____________ TestSpatialJoinTracts.test_drops_index_right_column ______________

self = <test_utils_spatial.TestSpatialJoinTracts object at 0x15ae57ce0>
mock_clean = <MagicMock name='clean_coordinates' id='6319759312'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='6319761664'>
mock_sjoin = <MagicMock name='sjoin' id='6319758976'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_drops_index_right_column(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Drops 'index_right' cleanup column."""
        mock_clean.return_value = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95]
        })
    
        mock_gdf = MagicMock()
        mock_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = mock_gdf
    
        mock_joined = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "GEOID": ["42101010100"],
            "total_pop": [1000],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({"point_x": [-75.16], "point_y": [39.95]})
    
>       result = spatial_join_tracts(crime_df, tract_gdf=None)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:1042: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:274: in spatial_join_tracts
    tract_gdf[available_cols],
    ^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/geopandas/geodataframe.py:1891: in __getitem__
    result = super().__getitem__(key)
             ^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([3]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_______________ TestSpatialJoinTracts.test_drops_geometry_column _______________

self = <test_utils_spatial.TestSpatialJoinTracts object at 0x15aefec30>
mock_clean = <MagicMock name='clean_coordinates' id='5826273568'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='5826280288'>
mock_sjoin = <MagicMock name='sjoin' id='5826270880'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_drops_geometry_column(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Drops 'geometry' column from output."""
        mock_clean.return_value = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95]
        })
    
        mock_gdf = MagicMock()
        mock_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = mock_gdf
    
        mock_joined = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "GEOID": ["42101010100"],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({"point_x": [-75.16], "point_y": [39.95]})
    
>       result = spatial_join_tracts(crime_df, tract_gdf=None)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:1071: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:274: in spatial_join_tracts
    tract_gdf[available_cols],
    ^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/geopandas/geodataframe.py:1891: in __getitem__
    result = super().__getitem__(key)
             ^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([3]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
___________ TestSpatialJoinTracts.test_custom_x_col_y_col_parameters ___________

self = <test_utils_spatial.TestSpatialJoinTracts object at 0x15ae82030>
mock_clean = <MagicMock name='clean_coordinates' id='6319762336'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='6319764016'>
mock_sjoin = <MagicMock name='sjoin' id='6319762672'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_custom_x_col_y_col_parameters(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Custom column names work."""
        mock_clean.return_value = pd.DataFrame({
            "custom_lon": [-75.16],
            "custom_lat": [39.95]
        })
    
        mock_gdf = MagicMock()
        mock_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = mock_gdf
    
        mock_joined = pd.DataFrame({
            "custom_lon": [-75.16],
            "custom_lat": [39.95],
            "GEOID": ["42101010100"],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({
            "custom_lon": [-75.16],
            "custom_lat": [39.95]
        })
    
>       result = spatial_join_tracts(
            crime_df,
            tract_gdf=None,
            x_col="custom_lon",
            y_col="custom_lat"
        )

tests/test_utils_spatial.py:1103: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:274: in spatial_join_tracts
    tract_gdf[available_cols],
    ^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/geopandas/geodataframe.py:1891: in __getitem__
    result = super().__getitem__(key)
             ^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:4128: in __getitem__
    data = self._take_with_is_copy(indexer, axis=1)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4175: in _take_with_is_copy
    result = self.take(indices=indices, axis=axis)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4155: in take
    new_data = self._mgr.take(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:913: in take
    return self.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([3]), axis = None, out = None, keepdims = False, initial = <no value>
where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
______________ TestSpatialJoinTracts.test_provided_tract_gdf_used ______________

self = <test_utils_spatial.TestSpatialJoinTracts object at 0x15ae82140>
mock_clean = <MagicMock name='clean_coordinates' id='5826280288'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='5826273568'>
mock_sjoin = <MagicMock name='sjoin' id='5826279280'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_provided_tract_gdf_used(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Custom tract_gdf parameter used when provided."""
        mock_clean.return_value = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95]
        })
    
        crime_gdf = MagicMock()
        crime_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = crime_gdf
    
        # Create custom tract gdf
        custom_tract_gdf = MagicMock()
        custom_tract_gdf.crs = "EPSG:4326"
        custom_tract_gdf.__getitem__ = lambda self, key: custom_tract_gdf
        custom_tract_gdf.columns = ["GEOID", "total_pop", "geometry"]
    
        mock_joined = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "GEOID": ["42101019999"],
            "total_pop": [500],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({"point_x": [-75.16], "point_y": [39.95]})
    
>       result = spatial_join_tracts(crime_df, tract_gdf=custom_tract_gdf)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:1148: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:281: in spatial_join_tracts
    joined = joined.drop(columns=["index_right"])
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:5603: in drop
    return super().drop(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4810: in drop
    obj = obj._drop_axis(labels, axis, level=level, errors=errors)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4891: in _drop_axis
    new_mgr = self._mgr.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
_______________ TestSpatialJoinTracts.test_handles_crs_mismatch ________________

self = <test_utils_spatial.TestSpatialJoinTracts object at 0x15adefc50>
mock_clean = <MagicMock name='clean_coordinates' id='6319759648'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='6319764352'>
mock_sjoin = <MagicMock name='sjoin' id='6319763344'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_handles_crs_mismatch(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Handles CRS conversion when tract_gdf.crs != crime_gdf.crs."""
        mock_clean.return_value = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95]
        })
    
        crime_gdf = MagicMock()
        crime_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = crime_gdf
    
        # Create tract gdf with different CRS
        tract_gdf = MagicMock()
        tract_gdf.crs = "EPSG:3857"
        tract_gdf.__getitem__ = lambda self, key: tract_gdf
        tract_gdf.columns = ["GEOID", "total_pop", "geometry"]
    
        # Mock to_crs to return self
        tract_gdf.to_crs = lambda crs: tract_gdf
    
        mock_joined = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "GEOID": ["42101010100"],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({"point_x": [-75.16], "point_y": [39.95]})
    
>       result = spatial_join_tracts(crime_df, tract_gdf=tract_gdf)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:1186: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:281: in spatial_join_tracts
    joined = joined.drop(columns=["index_right"])
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:5603: in drop
    return super().drop(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4810: in drop
    obj = obj._drop_axis(labels, axis, level=level, errors=errors)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4891: in _drop_axis
    new_mgr = self._mgr.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
___________ TestSpatialJoinTracts.test_handles_missing_tract_columns ___________

self = <test_utils_spatial.TestSpatialJoinTracts object at 0x15adefd50>
mock_clean = <MagicMock name='clean_coordinates' id='6319766704'>
mock_to_gdf = <MagicMock name='df_to_geodataframe' id='6319763680'>
mock_sjoin = <MagicMock name='sjoin' id='6319765360'>

    @patch("analysis.utils.spatial.gpd.sjoin")
    @patch("analysis.utils.spatial.df_to_geodataframe")
    @patch("analysis.utils.spatial.clean_coordinates")
    def test_handles_missing_tract_columns(self, mock_clean, mock_to_gdf, mock_sjoin):
        """Only available columns selected from tract_gdf."""
        mock_clean.return_value = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95]
        })
    
        crime_gdf = MagicMock()
        crime_gdf.crs = "EPSG:4326"
        mock_to_gdf.return_value = crime_gdf
    
        # Create tract gdf without total_pop column
        tract_gdf = MagicMock()
        tract_gdf.crs = "EPSG:4326"
        tract_gdf.__getitem__ = lambda self, key: tract_gdf
        tract_gdf.columns = ["GEOID", "geometry"]
    
        mock_joined = pd.DataFrame({
            "point_x": [-75.16],
            "point_y": [39.95],
            "GEOID": ["42101010100"],
            "index_right": [0],
            "geometry": [Point(-75.16, 39.95)]
        })
        mock_sjoin.return_value = mock_joined
    
        crime_df = pd.DataFrame({"point_x": [-75.16], "point_y": [39.95]})
    
>       result = spatial_join_tracts(crime_df, tract_gdf=tract_gdf)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_utils_spatial.py:1221: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
analysis/utils/spatial.py:281: in spatial_join_tracts
    joined = joined.drop(columns=["index_right"])
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/frame.py:5603: in drop
    return super().drop(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4810: in drop
    obj = obj._drop_axis(labels, axis, level=level, errors=errors)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/generic.py:4891: in _drop_axis
    new_mgr = self._mgr.reindex_indexer(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:699: in reindex_indexer
    new_blocks = self._slice_take_blocks_ax0(
/opt/anaconda3/lib/python3.13/site-packages/pandas/core/internals/managers.py:845: in _slice_take_blocks_ax0
    max_len = max(len(mgr_locs), taker.max() + 1)
                                 ^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

a = array([0, 1]), axis = None, out = None, keepdims = False
initial = <no value>, where = True

    def _amax(a, axis=None, out=None, keepdims=False,
              initial=_NoValue, where=True):
>       return umr_maximum(a, axis, None, out, keepdims, initial, where)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: int() argument must be a string, a bytes-like object or a real number, not '_NoValueType'

/opt/anaconda3/lib/python3.13/site-packages/numpy/core/_methods.py:41: TypeError
=============================== warnings summary ===============================
../../../../opt/anaconda3/lib/python3.13/site-packages/coverage/config.py:346
  /opt/anaconda3/lib/python3.13/site-packages/coverage/config.py:346: CoverageWarning: Unrecognized option '[tool.coverage.html] filterwarnings=' in config file pyproject.toml
    warn(

tests/conftest.py:24
  /Users/dustinober/Projects/Crime Incidents Philadelphia/tests/conftest.py:24: UserWarning: The NumPy module was reloaded (imported a second time). This can in some cases result in small but subtle issues and is discouraged.
    import numpy as np

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform darwin, python 3.13.9-final-0 _______________

Name                                Stmts   Miss Branch BrPart   Cover   Missing
--------------------------------------------------------------------------------
analysis/data/cache.py                 15      0      8      1  95.65%   44->41
analysis/data/loading.py               55      5     18      4  87.67%   35-36, 58, 63->69, 66->69, 189, 215
analysis/data/preprocessing.py         25      3     10      0  91.43%   119-122
analysis/data/validation.py            65      5     22      3  90.80%   86, 156, 160-161, 169
analysis/models/classification.py      70     35     12      2  45.12%   48->54, 55, 107-129, 156-178, 195-202, 217-224, 253-260, 278
analysis/models/time_series.py         48      7      4      0  86.54%   37-41, 61-64
analysis/models/validation.py          60      6      6      1  89.39%   52, 95, 265-280
analysis/utils/classification.py       13      9      4      0  23.53%   56-67
analysis/utils/spatial.py              69      2     26      3  94.74%   216->220, 223, 283
analysis/utils/temporal.py             14      1      4      1  88.89%   67
--------------------------------------------------------------------------------
TOTAL                                 434     73    114     15  81.75%
Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
=========================== short test summary info ============================
FAILED tests/test_models_classification.py::TestCreateTimeAwareSplit::test_returns_four_split_dataframes
FAILED tests/test_models_classification.py::TestCreateTimeAwareSplit::test_maintains_temporal_ordering
FAILED tests/test_models_classification.py::TestCreateTimeAwareSplit::test_ensure_sorted_default_true
FAILED tests/test_models_classification.py::TestCreateTimeAwareSplit::test_ensure_sorted_false_skips_sorting
FAILED tests/test_models_classification.py::TestCreateTimeAwareSplit::test_custom_test_size
FAILED tests/test_models_classification.py::TestCreateTimeAwareSplit::test_handles_duplicate_index_stably
FAILED tests/test_models_classification.py::TestTrainRandomForest::test_returns_fitted_model_and_scaler
FAILED tests/test_models_classification.py::TestTrainRandomForest::test_scale_features_false_returns_none_scaler
FAILED tests/test_models_classification.py::TestTrainRandomForest::test_model_has_expected_attributes
FAILED tests/test_models_classification.py::TestTrainRandomForest::test_scaler_fitted_correctly
FAILED tests/test_models_classification.py::TestTrainRandomForest::test_custom_hyperparameters
FAILED tests/test_models_classification.py::TestTrainRandomForest::test_random_state_reproducible
FAILED tests/test_models_classification.py::TestExtractFeatureImportance::test_returns_dataframe_with_feature_importance
FAILED tests/test_models_classification.py::TestExtractFeatureImportance::test_sorted_by_importance_descending
FAILED tests/test_models_classification.py::TestExtractFeatureImportance::test_top_n_parameter
FAILED tests/test_models_classification.py::TestExtractFeatureImportance::test_top_n_none_returns_all
FAILED tests/test_models_classification.py::TestEvaluateClassifier::test_returns_confusion_matrix
FAILED tests/test_models_classification.py::TestEvaluateClassifier::test_returns_classification_report
FAILED tests/test_models_classification.py::TestEvaluateClassifier::test_with_probabilities_adds_roc_auc
FAILED tests/test_models_classification.py::TestEvaluateClassifier::test_without_probabilities_no_roc_auc
FAILED tests/test_models_classification.py::TestEvaluateClassifier::test_target_names_in_report
FAILED tests/test_models_classification.py::TestEvaluateClassifier::test_single_class_roc_auc_handles_gracefully
FAILED tests/test_models_classification.py::TestHandleClassImbalance::test_returns_dict_mapping_classes_to_weights
FAILED tests/test_models_classification.py::TestHandleClassImbalance::test_balanced_weights_for_imbalanced_data
FAILED tests/test_models_classification.py::TestHandleClassImbalance::test_all_classes_present_in_keys
FAILED tests/test_models_classification.py::TestHandleClassImbalance::test_weights_inversely_proportional_to_frequency
FAILED tests/test_models_classification.py::TestHandleClassImbalance::test_handles_binary_classification
FAILED tests/test_models_classification.py::TestHandleClassImbalance::test_handles_multiclass_classification
FAILED tests/test_models_classification.py::TestTrainXGBoost::test_returns_fitted_model_and_scaler
FAILED tests/test_models_classification.py::TestTrainXGBoost::test_scale_features_defaults_to_false
FAILED tests/test_models_classification.py::TestTrainXGBoost::test_custom_hyperparameters
FAILED tests/test_models_classification.py::TestTrainXGBoost::test_eval_metric_set_to_logloss
FAILED tests/test_models_time_series.py::TestPrepareProphetData::test_returns_prophet_format_columns
FAILED tests/test_models_time_series.py::TestPrepareProphetData::test_converts_date_column_to_datetime
FAILED tests/test_models_time_series.py::TestPrepareProphetData::test_sorts_by_date_ascending
FAILED tests/test_models_time_series.py::TestPrepareProphetData::test_resets_index_after_sorting
FAILED tests/test_models_time_series.py::TestPrepareProphetData::test_handles_duplicate_dates
FAILED tests/test_models_time_series.py::TestPrepareProphetData::test_handles_empty_dataframe
FAILED tests/test_models_time_series.py::TestPrepareProphetData::test_custom_date_column_name
FAILED tests/test_models_time_series.py::TestPrepareProphetData::test_custom_value_column_name
FAILED tests/test_models_time_series.py::TestCreateTrainTestSplit::test_splits_by_date_cutoff
FAILED tests/test_models_time_series.py::TestCreateTrainTestSplit::test_custom_test_days_parameter
FAILED tests/test_models_time_series.py::TestCreateTrainTestSplit::test_test_days_30_default
FAILED tests/test_models_time_series.py::TestCreateTrainTestSplit::test_no_overlap_between_train_and_test
FAILED tests/test_models_time_series.py::TestCreateTrainTestSplit::test_handles_exact_boundary
FAILED tests/test_models_validation.py::TestTimeSeriesCVScore::test_returns_dict_with_scores_statistics
FAILED tests/test_models_validation.py::TestTimeSeriesCVScore::test_scores_array_length_matches_n_splits
FAILED tests/test_models_validation.py::TestTimeSeriesCVScore::test_mean_computed_correctly
FAILED tests/test_models_validation.py::TestTimeSeriesCVScore::test_std_computed_correctly
FAILED tests/test_models_validation.py::TestTimeSeriesCVScore::test_custom_n_splits_parameter
FAILED tests/test_models_validation.py::TestTimeSeriesCVScore::test_custom_scoring_parameter
FAILED tests/test_models_validation.py::TestTimeSeriesCVScore::test_default_scoring_neg_mean_absolute_error
FAILED tests/test_models_validation.py::TestValidateTemporalSplit::test_returns_dict_with_validation_results
FAILED tests/test_models_validation.py::TestValidateTemporalSplit::test_valid_temporal_order_true_when_sorted
FAILED tests/test_models_validation.py::TestValidateTemporalSplit::test_valid_temporal_order_false_when_overlap
FAILED tests/test_models_validation.py::TestValidateTemporalSplit::test_gap_days_calculation
FAILED tests/test_models_validation.py::TestValidateTemporalSplit::test_sufficient_gap_true_when_gap_met
FAILED tests/test_models_validation.py::TestValidateTemporalSplit::test_sufficient_gap_false_when_gap_insufficient
FAILED tests/test_models_validation.py::TestValidateTemporalSplit::test_train_size_test_size_counts
FAILED tests/test_models_validation.py::TestValidateTemporalSplit::test_test_ratio_calculation
FAILED tests/test_models_validation.py::TestValidateTemporalSplit::test_custom_min_gap_days_parameter
FAILED tests/test_models_validation.py::TestValidateTemporalSplit::test_handles_datetime_series
FAILED tests/test_data_loading.py::TestLoadCrimeData::test_returns_dataframe
FAILED tests/test_data_loading.py::TestLoadCrimeData::test_dataframe_not_empty
FAILED tests/test_data_loading.py::TestLoadCrimeData::test_has_expected_columns
FAILED tests/test_data_loading.py::TestLoadCrimeData::test_clean_parameter_defaults_to_true
FAILED tests/test_data_loading.py::TestLoadCrimeData::test_clean_false_includes_all_rows
FAILED tests/test_data_loading.py::TestLoadCrimeData::test_dispatch_date_is_datetime
FAILED tests/test_data_loading.py::TestLoadCrimeData::test_cache_performance_speedup
FAILED tests/test_data_loading.py::TestLoadCrimeData::test_cache_persists_across_calls
FAILED tests/test_data_loading.py::TestLoadCrimeData::test_cache_key_different_for_clean_parameter
FAILED tests/test_data_loading.py::TestCacheDirectory::test_cache_directory_exists
FAILED tests/test_data_loading.py::TestCacheDirectory::test_clear_cache_removes_cached_files
FAILED tests/test_data_loading.py::TestLoadBoundaries::test_load_police_districts_returns_geodataframe
FAILED tests/test_data_loading.py::TestInternalLoadFunctions::test_internal_function_returns_dataframe
FAILED tests/test_data_loading.py::TestDatetimeParsing::test_dispatch_date_with_invalid_values
FAILED tests/test_data_loading.py::TestCleanParameter::test_clean_false_preserves_null_dates
FAILED tests/test_data_loading.py::TestCleanParameter::test_clean_true_drops_null_dates
FAILED tests/test_data_preprocessing.py::TestFilterByDateRange::test_filter_by_start_and_end_date
FAILED tests/test_data_preprocessing.py::TestFilterByDateRange::test_filter_by_start_date_only
FAILED tests/test_data_preprocessing.py::TestFilterByDateRange::test_filter_by_end_date_only
FAILED tests/test_data_preprocessing.py::TestFilterByDateRange::test_preserves_all_columns
FAILED tests/test_data_preprocessing.py::TestFilterByDateRange::test_returns_copy_not_view
FAILED tests/test_data_preprocessing.py::TestFilterByDateRange::test_string_date_column
FAILED tests/test_data_preprocessing.py::TestFilterByDateRange::test_custom_date_column
FAILED tests/test_data_preprocessing.py::TestAggregateByPeriod::test_daily_aggregation
FAILED tests/test_data_preprocessing.py::TestAggregateByPeriod::test_weekly_aggregation
FAILED tests/test_data_preprocessing.py::TestAggregateByPeriod::test_monthly_aggregation
FAILED tests/test_data_preprocessing.py::TestAggregateByPeriod::test_yearly_aggregation
FAILED tests/test_data_preprocessing.py::TestAggregateByPeriod::test_count_column_named_correctly
FAILED tests/test_data_preprocessing.py::TestAggregateByPeriod::test_count_values_are_correct
FAILED tests/test_data_preprocessing.py::TestAggregateByPeriod::test_custom_count_column
FAILED tests/test_data_preprocessing.py::TestAggregateByPeriod::test_custom_date_column
FAILED tests/test_data_preprocessing.py::TestAggregateByPeriod::test_empty_dataframe_returns_empty
FAILED tests/test_data_preprocessing.py::TestAggregateByPeriod::test_month_start_aggregation
FAILED tests/test_data_validation.py::TestValidateCoordinates::test_invalid_coordinates_filtered_out
FAILED tests/test_data_validation.py::TestValidateCoordinates::test_none_coordinates_filtered_out
FAILED tests/test_data_validation.py::TestValidateCrimeData::test_sample_size_parameter_limits_validation
FAILED tests/test_utils_spatial.py::TestCleanCoordinates::test_filters_valid_philadelphia_coordinates
FAILED tests/test_utils_spatial.py::TestCleanCoordinates::test_filters_out_nan_coordinates
FAILED tests/test_utils_spatial.py::TestGetCoordinateStats::test_has_coordinates_counts_valid_coords
FAILED tests/test_utils_spatial.py::TestGetCoordinateStats::test_in_philadelphia_bounds_counts_valid_coords
FAILED tests/test_utils_spatial.py::TestGetCoordinateStats::test_coverage_rate_calculation
FAILED tests/test_utils_spatial.py::TestGetCoordinateStats::test_in_bounds_rate_calculation
FAILED tests/test_utils_spatial.py::TestSpatialJoinDistricts::test_returns_dataframe_with_joined_dist_num
FAILED tests/test_utils_spatial.py::TestSpatialJoinDistricts::test_calls_clean_coordinates_internally
FAILED tests/test_utils_spatial.py::TestSpatialJoinDistricts::test_calls_df_to_geodataframe_internally
FAILED tests/test_utils_spatial.py::TestSpatialJoinDistricts::test_drops_index_right_column
FAILED tests/test_utils_spatial.py::TestSpatialJoinDistricts::test_drops_geometry_column
FAILED tests/test_utils_spatial.py::TestSpatialJoinDistricts::test_custom_x_col_y_col_parameters
FAILED tests/test_utils_spatial.py::TestSpatialJoinDistricts::test_provided_district_gdf_used
FAILED tests/test_utils_spatial.py::TestSpatialJoinDistricts::test_handles_crs_mismatch
FAILED tests/test_utils_spatial.py::TestSpatialJoinTracts::test_returns_dataframe_with_tract_columns
FAILED tests/test_utils_spatial.py::TestSpatialJoinTracts::test_calls_clean_coordinates_internally
FAILED tests/test_utils_spatial.py::TestSpatialJoinTracts::test_calls_df_to_geodataframe_internally
FAILED tests/test_utils_spatial.py::TestSpatialJoinTracts::test_drops_index_right_column
FAILED tests/test_utils_spatial.py::TestSpatialJoinTracts::test_drops_geometry_column
FAILED tests/test_utils_spatial.py::TestSpatialJoinTracts::test_custom_x_col_y_col_parameters
FAILED tests/test_utils_spatial.py::TestSpatialJoinTracts::test_provided_tract_gdf_used
FAILED tests/test_utils_spatial.py::TestSpatialJoinTracts::test_handles_crs_mismatch
FAILED tests/test_utils_spatial.py::TestSpatialJoinTracts::test_handles_missing_tract_columns
=========== 121 failed, 199 passed, 2 skipped, 2 warnings in 33.97s ============
