---
phase: 01-navigation-layout
plan: "02"
type: execute
wave: 1
depends_on: []
files_modified:
  - web/src/lib/navigation.ts
  - web/src/components/Navbar.tsx
  - web/src/app/sitemap.ts
autonomous: true
must_haves:
  truths:
    - User can reach every analysis section from the header navigation without hunting through crowded links.
    - Desktop navigation exposes grouped analysis routes through a clear dropdown interaction.
    - Mobile users can open/close navigation and tap links with touch-friendly targets and predictable behavior.
  artifacts:
    - path: web/src/lib/navigation.ts
      provides: Single source of truth for nav groups/items and helper accessors
      contains: "export"
    - path: web/src/components/Navbar.tsx
      provides: Responsive header with desktop dropdown and mobile navigation pattern
      contains: "usePathname"
    - path: web/src/app/sitemap.ts
      provides: Sitemap generation aligned to navigation route definitions
      contains: "MetadataRoute.Sitemap"
  key_links:
    - from: web/src/lib/navigation.ts
      to: web/src/components/Navbar.tsx
      via: Navbar consumes shared route metadata
      pattern: "import .*navigation"
    - from: web/src/components/Navbar.tsx
      to: Next.js route segments
      via: Link components built from shared nav config
      pattern: "<Link"
    - from: web/src/lib/navigation.ts
      to: web/src/app/sitemap.ts
      via: Sitemap derives URLs from same manifest to prevent drift
      pattern: "map"
---

<objective>
Deliver the primary navigation system required by Phase 1, including grouped desktop navigation and touch-first mobile behavior.

Purpose: Satisfy NAV-02 and NAV-03 with a maintainable navigation architecture that avoids duplicated route definitions.
Output: A route-manifest-driven navbar with dropdown/disclosure interactions and synchronized sitemap paths.
</objective>

<execution_context>
@.codex/get-shit-done/workflows/execute-plan.md
@.codex/get-shit-done/templates/summary.md
@.codex/get-shit-done/references/ui-brand.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/01-navigation-/01-RESEARCH.md
@web/src/components/Navbar.tsx
@web/src/app/sitemap.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create a typed navigation manifest for grouped routes</name>
  <files>web/src/lib/navigation.ts</files>
  <action>Create a reusable navigation config that groups routes for header rendering (for example: primary links + analysis dropdown items). Include labels, hrefs, and helper selectors so both desktop and mobile nav UIs can consume the same definitions. Keep it lightweight and framework-native; no external state manager.</action>
  <verify>cd web && npm run lint</verify>
  <done>`navigation.ts` exports typed route metadata that can drive both navbar rendering and sitemap generation.</done>
</task>

<task type="auto">
  <name>Task 2: Refactor Navbar into desktop dropdown + mobile disclosure patterns</name>
  <files>web/src/components/Navbar.tsx</files>
  <action>Refactor `Navbar.tsx` to consume the shared navigation manifest and implement a responsive interaction model: grouped dropdown behavior on desktop and a collapsible mobile menu with sufficiently large tap targets. Maintain active-route highlighting with `usePathname`, add meaningful aria labels, and ensure keyboard plus touch interactions both work. Prefer the already installed Headless UI primitives rather than hand-rolled accessibility logic.</action>
  <verify>cd web && npm run typecheck</verify>
  <done>Navbar supports grouped desktop navigation and touch-friendly mobile interactions while preserving active state visibility.</done>
</task>

<task type="auto">
  <name>Task 3: Align sitemap generation with navigation manifest</name>
  <files>web/src/app/sitemap.ts</files>
  <action>Update sitemap generation to derive route paths from the new navigation manifest (or shared route constants) so nav and sitemap cannot drift. Preserve existing base URL behavior and static sitemap export pattern.</action>
  <verify>cd web && npm run build</verify>
  <done>Sitemap and navbar are driven by the same route inventory, preventing missing or stale route entries.</done>
</task>

</tasks>

<verification>
- Run `cd web && npm run lint`.
- Run `cd web && npm run typecheck`.
- Run `cd web && npm run build`.
- Manual QA: verify desktop dropdown and mobile menu at ~390px and ~1280px widths, including open/close behavior, active-route highlight, and tap reliability.
</verification>

<success_criteria>
- Header navigation is clear, grouped, and functional across desktop and mobile (NAV-02).
- Mobile interaction is touch-friendly with predictable open/close and link activation behavior (NAV-03).
- Route definitions are centralized and reused by sitemap generation.
</success_criteria>

<output>
After completion, create `.planning/phases/01-navigation-/01-02-SUMMARY.md`.
</output>
