---
phase: 02-core-analysis
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - notebooks/07_cross_factor_analysis.ipynb
  - output/figures/cross_factor/
  - output/tables/cross_factor/
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Cross-factor analysis completed with statistical testing"
    - "Chi-square tests for independence between temporal, geographic, and offense factors"
    - "Correlation matrices and statistical significance tests"
    - "10+ publication-quality cross-factor figures"
    - "Statistical test results with multiple testing correction"
  artifacts:
    - path: "notebooks/07_cross_factor_analysis.ipynb"
      provides: "Complete cross-factor interaction analysis"
      min_lines: 300
    - path: "output/figures/cross_factor/"
      provides: "Cross-factor visualizations"
      count: 10
    - path: "output/tables/cross_factor/interaction_tests.csv"
      provides: "Statistical test results for all interactions"
    - path: "output/tables/cross_factor/correlation_matrix.csv"
      provides: "Variable correlation matrix"
  key_links:
    - from: "notebooks/07_cross_factor_analysis.ipynb"
      to: "data/processed/crime_incidents_cleaned.parquet"
      via: "pd.read_parquet()"
      pattern: "read_parquet.*cleaned"
    - from: "notebooks/07_cross_factor_analysis.ipynb"
      to: "scipy.stats.chi2_contingency"
      via: "chi-square tests for independence"
      pattern: "chi2_contingency"
    - from: "notebooks/07_cross_factor_analysis.ipynb"
      to: "statsmodels.stats.multitest.multipletests"
      via: "multiple comparison correction"
      pattern: "multipletests"
---

<objective>
Execute the cross-factor analysis notebook that was created but not properly run, generating all required output files including statistical tests, figures, and tables.

Purpose: Complete CROSS-01 to CROSS-05 requirements by running the cross-factor analysis notebook end-to-end and generating all missing output files.
Output: All cross-factor analysis figures, tables, and completed notebook with executed cells.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-analysis/02-RESEARCH.md
@.planning/phases/02-core-analysis/02-CONTEXT.md
@.planning/phases/02-core-analysis/02-VERIFICATION.md
@scripts/config.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Execute Cross-Factor Analysis Notebook End-to-End</name>
  <files>notebooks/07_cross_factor_analysis.ipynb</files>
  <action>
    Execute the cross-factor analysis notebook from start to finish to generate all missing output files:
    
    1. Ensure the notebook environment has all required dependencies:
       - pandas, numpy, matplotlib, seaborn
       - scipy.stats (chi2_contingency, pearsonr, spearmanr)
       - statsmodels.stats.multitest (multipletests)
       - sklearn (LabelEncoder, LinearRegression)
       - All imports in the existing notebook
    
    2. Run the notebook cells in order, verifying each section completes successfully:
       - Cell 1-5: Setup and imports (already done)
       - Cell 6-10: Factor variable creation and cross-factor design (already done)
       - Cell 11-19: Temporal×Offense and Geographic×Offense interactions (need execution)
       - Cell 20-30: Temporal×Geographic interactions and correlation analysis (need execution)
       - Cell 31-35: Multi-factor analysis and regression (need execution)
       - Cell 36-37: Multiple comparison correction (need execution)
       - Cell 38-39: Conclusion (need execution)
    
    3. Verify that all output files are generated in the correct directories:
       - output/figures/cross_factor/ (should have 10+ figures)
       - output/tables/cross_factor/ (should have interaction_tests.csv, correlation_matrix.csv)
    
    4. Confirm that the notebook ran without errors from top to bottom
  </action>
  <verify>
    jupyter nbconvert --to notebook --execute --ExecutePreprocessor.timeout=600 notebooks/07_cross_factor_analysis.ipynb --output executed_cross_factor
    ls -la output/figures/cross_factor/
    ls -la output/tables/cross_factor/
    [[ $(ls output/figures/cross_factor/ | wc -l) -gt 10 ]] && echo "More than 10 figures generated" || echo "Less than 10 figures generated"
  </verify>
  <done>Cross-factor analysis notebook executed end-to-end with all cells completed, generating all required output figures and tables</done>
</task>

</tasks>

<verification>
- [ ] Notebook 07 runs without errors from top to bottom
- [ ] All cells executed successfully (no null execution_count)
- [ ] 10+ publication-quality figures saved to output/figures/cross_factor/
- [ ] interaction_tests.csv with all test results and corrected p-values
- [ ] Correlation matrices saved to output/tables/cross_factor/
- [ ] Chi-square tests with Cramer's V effect sizes executed
- [ ] Multiple comparison correction applied to all interaction tests
</verification>

<success_criteria>
- Notebook 07 fully executed with all cells showing execution numbers
- 10+ publication-quality figures generated in output/figures/cross_factor/
- All statistical tests completed and results saved to output/tables/cross_factor/
- Cross-factor analysis complete addressing CROSS-01 to CROSS-05 requirements
- All output files verified as properly generated
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-analysis/02-07-SUMMARY.md`
</output>