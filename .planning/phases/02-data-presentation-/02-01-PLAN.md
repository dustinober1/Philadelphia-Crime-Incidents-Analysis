---
phase: 02-data-presentation
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - web/src/components/charts/CustomTooltip.tsx
  - web/src/components/charts/TrendChart.tsx
  - web/src/app/trends/page.tsx
  - web/src/lib/api.ts
  - web/package.json
autonomous: true
must_haves:
  truths:
    - User can hover over chart elements and see detailed tooltip with value, date, percent change, and comparison to historical average
    - User can view multiple crime type series simultaneously with distinct colors
    - Empty chart states display helpful messages rather than blank space
    - Charts remain responsive and properly sized on mobile, tablet, and desktop viewports
  artifacts:
    - path: web/src/components/charts/CustomTooltip.tsx
      provides: Reusable tooltip component with percent change and historical comparison
      min_lines: 30
    - path: web/src/components/charts/TrendChart.tsx
      provides: Unified line/bar/area chart wrapper with ResponsiveContainer
      min_lines: 40
    - path: web/src/lib/api.ts
      provides: Enhanced SWR hooks with proper TypeScript types
      contains: "TrendRow|useAnnualTrends|useMonthlyTrends"
  key_links:
    - from: web/src/app/trends/page.tsx
      to: web/src/components/charts/TrendChart.tsx
      via: Component import and rendering
      pattern: "TrendChart"
    - from: web/src/components/charts/TrendChart.tsx
      to: web/src/components/charts/CustomTooltip.tsx
      via: Recharts Tooltip content prop
      pattern: "content=\{<CustomTooltip"
    - from: web/src/components/charts/TrendChart.tsx
      to: recharts
      via: ResponsiveContainer and chart type components
      pattern: "ResponsiveContainer|LineChart|AreaChart|BarChart"
---

<objective>
Enhance data chart presentation with custom tooltips, multiple series support, and improved user experience.

Purpose: Create professional, interactive charts that display crime trend data with rich contextual information (percent changes, historical comparisons) and support comparative analysis across crime categories.
Output: Reusable chart components with custom tooltips, proper typing, and multi-series support.
</objective>

<execution_context>
@.claude/get-shit-done/workflows/execute-plan.md
@.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/02-data-presentation-/02-RESEARCH.md
@.planning/phases/02-data-presentation-/02-CONTEXT.md
@web/src/app/trends/page.tsx
@web/src/lib/api.ts
@web/src/components/ChartCard.tsx
@web/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install TanStack Table dependency</name>
  <files>web/package.json</files>
  <action>Add `@tanstack/react-table` to package.json dependencies. Run `npm install` to install the package. This dependency is needed for the data table component in plan 02-02.</action>
  <verify>cd web && npm list @tanstack/react-table</verify>
  <done>TanStack Table v8.x is installed and available for use.</done>
</task>

<task type="auto">
  <name>Task 2: Create CustomTooltip component with percent change calculation</name>
  <files>web/src/components/charts/CustomTooltip.tsx</files>
  <action>Create a reusable Recharts tooltip component that displays:
  - Date/period label
  - Basic value (count/rate) with proper formatting (toLocaleString)
  - Percent change from previous period (calculated by comparing with previous data point)
  - Comparison to historical average (if data available)

Use Recharts TooltipProps type for proper TypeScript typing. Include accessibility attributes (role, aria-live). Return null if no active payload.

DO NOT: Create complex animations or external dependencies for simple tooltip display.</action>
  <verify>cd web && npm run typecheck</verify>
  <done>CustomTooltip component exists, compiles without type errors, and handles empty/active states properly.</done>
</task>

<task type="auto">
  <name>Task 3: Create unified TrendChart component with multi-series support</name>
  <files>web/src/components/charts/TrendChart.tsx</files>
  <action>Create a reusable chart component that supports line, bar, and area chart types via a `chartType` prop ("line" | "bar" | "area"). Component should:
  - Accept `data` array with generic typing
  - Accept `series` configuration array defining dataKey, color, name for each crime category
  - Use ResponsiveContainer for proper sizing (100% width, 100% height)
  - Include CartesianGrid, XAxis, YAxis, Legend
  - Use CustomTooltip from Task 2
  - Handle empty states with helpful message
  - Support hiding XAxis labels for density (via `showXLabels` prop)

Export as named export `TrendChart`. Use "use client" directive for client-side interactivity.

DO NOT: Hand-roll responsive sizing logic (ResponsiveContainer handles this).</action>
  <verify>cd web && npm run lint && npm run typecheck</verify>
  <done>TrendChart component supports three chart types, multi-series overlay, proper responsiveness, and has clean TypeScript types.</done>
</task>

<task type="auto">
  <name>Task 4: Refactor trends page to use new TrendChart component</name>
  <files>web/src/app/trends/page.tsx</files>
  <action>Refactor the trends page to use the new TrendChart component from Task 3 instead of inline Recharts components. Update each chart card:
  - Annual trends: Use chartType="line" with Violent, Property, Other series
  - Monthly trends: Use chartType="area" with stackId for stacked areas
  - COVID comparison: Use chartType="bar" for single series

Keep existing DateRangeFilter and data transformation logic (annualSeries, monthlySeries useMemo). Maintain all existing insight text and download links.

DO NOT: Change the data fetching logic or filter behavior.</action>
  <verify>cd web && npm run build</verify>
  <done>Trends page renders all charts using TrendChart component with consistent styling and interaction patterns.</done>
</task>

</tasks>

<verification>
- Run `cd web && npm run lint`
- Run `cd web && npm run typecheck`
- Run `cd web && npm run build`
- Manual QA: Start dev server, visit /trends, hover over charts and verify tooltips display with percent change and values
- Verify charts resize properly on mobile (390px), tablet (768px), and desktop (1280px)
</verification>

<success_criteria>
- DATA-01 complete: Line, bar, and area charts display crime trends with proper data
- DATA-04 partial: Multiple series support enables comparative views
- Custom tooltips show percent change from previous period
- Charts are fully responsive and handle empty states gracefully
- All existing trends page functionality is preserved
</success_criteria>

<output>
After completion, create `.planning/phases/02-data-presentation-/02-01-SUMMARY.md`.
</output>
