---
phase: 02-data-presentation
plan: "02"
type: execute
wave: 1
depends_on: []
files_modified:
  - web/src/components/tables/DataTable.tsx
  - web/src/components/tables/TableFilters.tsx
  - web/src/app/policy/page.tsx
  - web/src/lib/types.ts
autonomous: true
must_haves:
  truths:
    - User can view tabular data with sortable columns (click column header to sort asc/desc)
    - User can search/filter data using global search bar
    - User can navigate between pages of data (10-25 rows per page)
    - Table remains readable on mobile with horizontal scroll if needed
  artifacts:
    - path: web/src/components/tables/DataTable.tsx
      provides: Headless TanStack Table wrapper with sorting and pagination
      min_lines: 60
    - path: web/src/components/tables/TableFilters.tsx
      provides: Search and filter controls for table data
      min_lines: 30
    - path: web/src/lib/types.ts
      provides: Shared TypeScript types for data tables
      contains: "TrendRow|PolicyRow"
  key_links:
    - from: web/src/app/policy/page.tsx
      to: web/src/components/tables/DataTable.tsx
      via: Component import for displaying tabular data
      pattern: "DataTable"
    - from: web/src/components/tables/DataTable.tsx
      to: @tanstack/react-table
      via: useReactTable hook with sorting and pagination models
      pattern: "useReactTable|getSortedRowModel|getPaginationRowModel"
    - from: web/src/components/tables/DataTable.tsx
      to: web/src/components/tables/TableFilters.tsx
      via: Import for filter controls
      pattern: "TableFilters"
---

<objective>
Create a reusable data table component with sorting, pagination, and filtering capabilities.

Purpose: Enable users to explore crime data in tabular format with sorting by column, search filtering, and pagination for manageable viewing.
Output: Headless TanStack Table wrapper with client-side sorting, pagination, and integrated filter controls.
</objective>

<execution_context>
@.claude/get-shit-done/workflows/execute-plan.md
@.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/02-data-presentation-/02-RESEARCH.md
@.planning/phases/02-data-presentation-/02-CONTEXT.md
@web/src/app/policy/page.tsx
@web/src/lib/api.ts
@web/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared types for data table columns</name>
  <files>web/src/lib/types.ts</files>
  <action>Create a centralized types file for shared data table types. Define:
  - `TableColumn` type with id, header, accessorKey (optional), cell (optional render function)
  - Export existing `TrendRow` from api.ts if not already exported
  - Add `PolicyRow` type for policy data (month, crime_type, count, etc.)

Use proper TypeScript generics for flexibility. Keep types minimal and focused on table needs.

DO NOT: Create overly complex type hierarchies or unused utility types.</action>
  <verify>cd web && npm run typecheck</verify>
  <done>types.ts exports shared types for table columns and data rows.</done>
</task>

<task type="auto">
  <name>Task 2: Create TableFilters component with search and filter controls</name>
  <files>web/src/components/tables/TableFilters.tsx</files>
  <action>Create a filter controls component that provides:
  - Global search input (searches all columns)
  - Reset filters button
  - Optional: Crime type dropdown filter
  - Optional: Date range inputs

Accept `onSearchChange`, `onReset` props. Use controlled inputs with proper typing. Include loading state if needed for async filters.

Use lucide-react icons (Search, X, Filter) for visual clarity.

DO NOT: Implement complex multi-column filter UI in this task (keep it simple for now).</action>
  <verify>cd web && npm run lint</verify>
  <done>TableFilters component renders search input and reset button with proper event handling.</done>
</task>

<task type="auto">
  <name>Task 3: Create DataTable component with TanStack Table</name>
  <files>web/src/components/tables/DataTable.tsx</files>
  <action>Create a generic data table component using @tanstack/react-table v8. Component should:
  - Accept generic data array and column definitions
  - Use `useReactTable` hook with:
    - `getCoreRowModel()` for basic rendering
    - `getSortedRowModel()` for column sorting
    - `getPaginationRowModel()` for pagination
  - Support sortable columns via header click (show sort indicator)
  - Render pagination controls (prev/next, page info)
  - Handle empty state with message
  - Use Tailwind classes for styling (overflow-x-auto for mobile)
  - Include aria labels for accessibility

Export as named export `DataTable`. Use "use client" directive.

Column sorting should use `onSortingChange` and `state.sorting`. Pagination defaults to 10 rows per page.

DO NOT: Implement server-side sorting/pagination (use client-side only for now).</action>
  <verify>cd web && npm run typecheck</verify>
  <done>DataTable component renders sorted, paginated tables with proper TypeScript types.</done>
</task>

<task type="auto">
  <name>Task 4: Add data table to policy page for composition data</name>
  <files>web/src/app/policy/page.tsx</files>
  <action>Add a DataTable instance to the policy page displaying the composition data (year-based crime category shares). Place it after the existing composition ChartCard component.

Create column definitions for: year, crime_category, count, percentage (calculate from count/total).

Include TableFilters above the table for search. Keep existing chart visualizations unchanged.

DO NOT: Remove or modify existing chart visualizations on the policy page.</action>
  <verify>cd web && npm run build</verify>
  <done>Policy page includes a sortable, filterable data table for composition analysis below existing charts.</done>
</task>

</tasks>

<verification>
- Run `cd web && npm run lint`
- Run `cd web && npm run typecheck`
- Run `cd web && npm run build`
- Manual QA: Visit /policy, scroll to composition table, test column sorting (click headers), test search filter, verify pagination works
- Verify table scrolls horizontally on mobile without breaking layout
</verification>

<success_criteria>
- DATA-02 complete: Data tables with sorting, filtering, and pagination
- Tables are responsive and usable on mobile devices
- TanStack Table integration follows standard patterns from research
- Client-side operations work smoothly for datasets under 1000 rows
</success_criteria>

<output>
After completion, create `.planning/phases/02-data-presentation-/02-02-SUMMARY.md`.
</output>
