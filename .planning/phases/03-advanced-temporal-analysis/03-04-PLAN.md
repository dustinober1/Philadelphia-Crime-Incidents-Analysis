---
phase: 03-advanced-temporal-analysis
plan: 04
type: execute
wave: 2
depends_on: [03-01, 03-02, 03-03]
files_modified:
  - analysis/03-04-advanced_temporal_report.py
  - reports/16_advanced_temporal_analysis_report.md
autonomous: true

must_haves:
  truths:
    - "User can view unified report combining holiday effects, crime type profiles, and shift analysis"
    - "Report includes executive summary with 5-10 key findings across all analyses"
    - "Statistical presentation tiered: key findings inline, detailed statistics in appendix"
    - "Visualization mix includes time series, heatmaps, bar charts, and spatial maps"
  artifacts:
    - path: "analysis/03-04-advanced_temporal_report.py"
      provides: "Advanced temporal analysis report generator (orchestrator)"
      min_lines: 250
      exports:
        - "generate_advanced_temporal_report"
        - "create_executive_summary"
    - path: "reports/16_advanced_temporal_analysis_report.md"
      provides: "Unified markdown report with embedded plots"
      min_lines: 500
  key_links:
    - from: "analysis/03-04-advanced_temporal_report.py"
      to: "analysis/03-01-holiday_effects.py"
      via: "import analyze_holiday_effects, generate_holiday_markdown_report"
      pattern: "from analysis\\.03_01_holiday_effects import"
    - from: "analysis/03-04-advanced_temporal_report.py"
      to: "analysis/03-02-crime_type_profiles.py"
      via: "import analyze_all_crime_types, generate_crime_type_report"
      pattern: "from analysis\\.03_02_crime_type_profiles import"
    - from: "analysis/03-04-advanced_temporal_report.py"
      to: "analysis/03-03-shift_analysis.py"
      via: "import analyze_shift_patterns, analyze_crime_by_shift, generate_shift_report"
      pattern: "from analysis\\.03_03_shift_analysis import"
---

<objective>
Create unified advanced temporal analysis report generator that orchestrates holiday effects, crime type profiles, and shift analysis modules into a comprehensive markdown report.

Purpose: Produce a single publication-quality report combining all Phase 3 analyses with executive summary, cross-analysis insights, and detailed appendices. This is the primary deliverable for Phase 3.

Output: Report generator `analysis/03-04-advanced_temporal_report.py` and unified markdown report `reports/16_advanced_temporal_analysis_report.md`.
</objective>

<execution_context>
@/Users/dustinober/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dustinober/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md

@analysis/06_generate_report.py
@analysis/07_report_safety_trend.py
@analysis/03-01-holiday_effects.py
@analysis/03-02-crime_type_profiles.py
@analysis/03-03-shift_analysis.py
@analysis/config.py
@analysis/reproducibility.py
</context>

<tasks>

<task type="auto">
  <name>Create advanced temporal analysis report generator</name>
  <files>analysis/03-04-advanced_temporal_report.py</files>
  <action>
Create file `analysis/03-04-advanced_temporal_report.py` following pattern from `analysis/06_generate_report.py`.

Module must include:

1. **IMPORTS**:
```python
from analysis.03_01_holiday_effects import analyze_holiday_effects, generate_holiday_markdown_report
from analysis.03_02_crime_type_profiles import analyze_all_crime_types, generate_crime_type_report
from analysis.03_03_shift_analysis import analyze_shift_patterns, analyze_crime_by_shift, generate_shift_report
from analysis.config import PROJECT_ROOT, REPORTS_DIR
from analysis.reproducibility import format_metadata_markdown
```

2. **FUNCTION: create_executive_summary(holiday_results, crime_type_results, shift_results) -> str**:
   - Analyze all results to extract 5-10 key findings
   - Format as bulleted list with significance markers
   - Include both statistical and practical insights
   - Findings should span all three analyses (holidays, crime types, shifts)
   - Return formatted markdown section

   Key finding template:
   - "**[Finding]**: [Description] (p=[value], [effect size])"
   - Highlight findings with ** for emphasis
   - Note practical implications (e.g., "suggests increased staffing needed")

3. **FUNCTION: create_cross_analysis_section(holiday_results, crime_type_results, shift_results) -> str**:
   - Identify patterns that emerge across multiple analyses
   - Example: "Summer months show both holiday effects (July 4) and overall crime increase"
   - Example: "Violent crimes peak during Evening shift, which also includes pre-holiday periods"
   - Create summary table of inter-relationships
   - Return formatted markdown section

4. **FUNCTION: create_methodology_summary() -> str**:
   - Document combined methodology for all three analyses
   - Include statistical parameters (confidence level, alpha, bootstrap)
   - Note data limitations (2026 incomplete, missing coordinates)
   - Return formatted markdown section

5. **FUNCTION: create_detailed_statistics_appendix(holiday_results, crime_type_results, shift_results) -> str**:
   - Collapsible/appendix section with full statistical details
   - Holiday analysis: chi-square values, p-values for each holiday
   - Crime types: Mann-Kendall tau values, yearly trends
   - Shift analysis: post-hoc comparison table with FDR-adjusted p-values
   - Return formatted markdown section

6. **FUNCTION: generate_advanced_temporal_report() -> None**:
   - Set seed via set_global_seed(STAT_CONFIG["random_seed"])
   - Print progress messages for each analysis
   - Run analyze_holiday_effects()
   - Run analyze_all_crime_types()
   - Run analyze_shift_patterns() and analyze_crime_by_shift()
   - Combine results into unified report
   - Create executive summary via create_executive_summary()
   - Create cross-analysis via create_cross_analysis_section()
   - Create methodology via create_methodology_summary()
   - Create appendix via create_detailed_statistics_appendix()
   - Assemble full report:
     * Title and metadata
     * Executive summary (key findings)
     * Holiday effects analysis (with embedded plots)
     * Crime type profiles (with embedded plots)
     * Shift analysis (with embedded plots)
     * Cross-analysis insights
     * Methodology
     * Detailed statistics appendix
     * Conclusion
   - Write to reports/16_advanced_temporal_analysis_report.md
   - Print confirmation message

7. **IF __name__ == "__main__" block**:
   - Call generate_advanced_temporal_report()
   - Handle exceptions gracefully with informative error messages

Report structure:
```markdown
# Advanced Temporal Analysis: Philadelphia Crime Incidents (2006-2026)

[Metadata section]

## Executive Summary
[5-10 key findings with significance markers]

---

## 1. Holiday Effects Analysis
[Generated from generate_holiday_markdown_report with plots embedded]

---

## 2. Crime Type Profiles
[Generated from generate_crime_type_report with plots embedded]

---

## 3. Shift-by-Shift Analysis
[Generated from generate_shift_report with plots embedded]

---

## 4. Cross-Analysis Insights
[Patterns emerging across multiple analyses]

---

## 5. Methodology
[Combined methodology summary]

---

## 6. Detailed Statistics Appendix
[Full statistical tables with p-values, effect sizes, CIs]

---

## Conclusion
[Summary of key insights and implications]
```

Key implementation notes:
- Reuse individual report generation functions from each module
- Combine plots into single document
- Ensure consistent styling across sections
- Include all statistical test results with exact p-values
- Note all data limitations (2026 incomplete, coordinate coverage)
</action>
  <verify>
python -c "from analysis.03_04_advanced_temporal_report import generate_advanced_temporal_report; generate_advanced_temporal_report(); import os; print('Report exists:', os.path.exists('reports/16_advanced_temporal_analysis_report.md'))"
</verify>
  <done>
generate_advanced_temporal_report() executes without errors and creates:
- reports/16_advanced_temporal_analysis_report.md file
- File contains executive summary with 5-10 key findings
- All three analysis sections present with embedded plots
- Cross-analysis section included
- Detailed statistics appendix with full p-values and effect sizes
</done>
</task>

</tasks>

<verification>
Run the report generator:
```bash
python analysis/03-04-advanced_temporal_report.py
```

Verify outputs:
- Report file exists at reports/16_advanced_temporal_analysis_report.md
- Report size > 50 KB (indicates substantial content)
- Executive summary has 5-10 bullet points
- All three analysis sections present
- Plots embedded as base64 images (search for 'data:image/png;base64,')
- Statistical appendix has complete tables
- Conclusion section present
</verification>

<success_criteria>
- Unified report combines all Phase 3 analyses
- Executive summary synthesizes key findings
- Cross-analysis identifies inter-relationships
- All visualizations embedded and properly formatted
- Statistical details in appendix for completeness
- Report is publication-ready
- All TEMP-01, TEMP-02, TEMP-03 requirements satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/03-advanced-temporal-analysis/03-04-SUMMARY.md`
</output>
