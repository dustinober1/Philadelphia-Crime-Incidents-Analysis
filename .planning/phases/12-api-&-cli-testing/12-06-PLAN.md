---
phase: 12-api-&-cli-testing
plan: 06
type: execute
wave: 2
depends_on: []
files_modified:
  - tests/test_cli_main.py
autonomous: true

must_haves:
  truths:
    - "version command prints CLI version, typer version, and Python version"
    - "info command prints project context, data sources, and reports directory"
    - "Both commands execute with exit code 0"
    - "Output formatting is validated (table structure for version, panel for info)"
  artifacts:
    - path: "tests/test_cli_main.py"
      provides: "Integration tests for main CLI commands (version, info)"
      min_lines: 80
  key_links:
    - from: "tests/test_cli_main.py"
      to: "analysis/cli/main.py"
      via: "CliRunner"
      pattern: "runner\.invoke\(app"
---

<objective>
Write integration tests for the main CLI commands (version, info) using Typer CliRunner.

Purpose: Ensure the version and info commands are properly tested for output format and exit codes. These are the only main app commands not yet tested.

Output: New test file tests/test_cli_main.py with tests for version and info commands.
</objective>

<execution_context>
@/Users/dustinober/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dustinober/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/12-api-&-cli-testing/12-RESEARCH.md
@tests/test_cli_chief.py
@analysis/cli/main.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create test_cli_main.py and add version command tests</name>
  <files>tests/test_cli_main.py</files>
  <action>
Create tests/test_cli_main.py and add tests for the version command:

1. **test_version_command_basic()**
   - Invoke app with ["version"]
   - Verify exit_code == 0
   - Verify "CLI Version" in stdout
   - Verify "typer" in stdout
   - Verify "Python" in stdout

2. **test_version_command_table_structure()**
   - Invoke app with ["version"]
   - Verify table-like output format
   - Verify version numbers are present (e.g., "v1.1", "3.14+")
   - Verify table has "Component" and "Version" columns (implied by output)

3. **test_version_command_no_arguments_required()**
   - Invoke app with ["version"] (no additional args)
   - Verify exit_code == 0
   - Tests that command requires no parameters

Follow the existing CliRunner pattern from test_cli_chief.py.
Use the same app import: from analysis.cli.main import app.
  </action>
  <verify>Run pytest tests/test_cli_main.py -v -k "version" and verify all tests pass</verify>
  <done>Version command is tested for exit code and output content</done>
</task>

<task type="auto">
  <name>Task 2: Add info command tests</name>
  <files>tests/test_cli_main.py</files>
  <action>
Add tests for the info command:

1. **test_info_command_basic()**
   - Invoke app with ["info"]
   - Verify exit_code == 0
   - Verify "Data sources:" in stdout
   - Verify "Analysis areas:" in stdout
   - Verify "Reports directory:" in stdout

2. **test_info_command_data_sources_listed()**
   - Invoke app with ["info"]
   - Verify "Philadelphia Police Department" is mentioned
   - Verify "U.S. Census Bureau" is mentioned
   - Verify "City event schedules" is mentioned

3. **test_info_command_analysis_areas_listed()**
   - Invoke app with with ["info"]
   - Verify "Chief:" is mentioned
   - Verify "Patrol:" is mentioned
   - Verify "Policy:" is mentioned
   - Verify "Forecasting:" is mentioned

4. **test_info_command_resolved_reports_path()**
   - Invoke app with ["info"]
   - Verify "Resolved path:" in stdout
   - Verify "reports/" is in output
   - Tests that the path is displayed correctly

Add these tests to test_cli_main.py.
  </action>
  <verify>Run pytest tests/test_cli_main.py -v -k "info" and verify all tests pass</verify>
  <done>Info command is tested for output content and formatting</done>
</task>

<task type="auto">
  <name>Task 3: Add Rich output formatting tests</name>
  <files>tests/test_cli_main.py</files>
  <action>
Add tests for Rich formatting in version and info commands:

1. **test_version_uses_rich_table()**
   - Invoke app with ["version"]
   - Verify output contains table structure (columnar output)
   - Verify styling markers (may be color codes in raw output)

2. **test_info_uses_rich_panel()**
   - Invoke app with ["info"]
   - Verify output contains panel title (border)
   - Verify "Philadelphia Crime Incidents Analysis" is in output

3. **test_both_commands_no_error_output()**
   - Invoke both commands
   - Verify no error messages in stderr
   - Verify no exception traces in output

Note: Rich styling may not be visible in CliRunner output (depends on terminal).
Focus on textual content rather than ANSI codes.
  </action>
  <verify>Run pytest tests/test_cli_main.py -v -k "rich" and verify formatting tests pass</verify>
  <done>Rich output formatting is validated for both commands</done>
</task>

</tasks>

<verification>
After completion, verify:
1. Run pytest tests/test_cli_main.py -v and count passing tests
2. Both main commands (version, info) have tests
3. At least 7 new CLI main tests pass
4. Coverage for analysis/cli/main.py is 80%+
5. All tests follow existing CliRunner patterns from Phase 11
</verification>

<success_criteria>
1. New test file tests/test_cli_main.py is created
2. Version command is tested for output content and exit code
3. Info command is tested for output content and formatting
4. Rich table and panel output is validated
5. All tests use CliRunner and follow existing patterns
</success_criteria>

<output>
After completion, create .planning/phases/12-api-&-cli-testing/12-06-SUMMARY.md with:
- Number of tests added for main CLI commands
- Coverage percentage for analysis/cli/main.py
- Any output formatting issues discovered
</output>
