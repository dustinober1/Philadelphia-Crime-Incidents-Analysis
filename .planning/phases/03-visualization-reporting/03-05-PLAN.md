---
phase: 03-visualization-reporting
plan: 05
type: execute
wave: 2
depends_on: [03-02, 03-04]
files_modified:
  - reports/index.qmd
  - dashboard/app.py
  - reports/README.md
  - README.md
  - reports/output/
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Dashboard links to report sections"
    - "Report links to dashboard"
    - All report formats generated (PDF, HTML, Word)"
    - "README files updated with execution instructions"
    - "Reproducibility checklist complete"
  artifacts:
    - path: "reports/output/phl_crime_analysis.pdf"
      provides: "Final PDF report"
      exists: "yes"
    - path: "reports/output/phl_crime_analysis.html"
      provides: "Final HTML report"
      exists: "yes"
    - path: "reports/output/phl_crime_analysis.docx"
      provides: "Final Word report"
      exists: "yes"
    - path: "reports/README.md"
      provides: "Report-specific documentation"
      min_lines: 50
    - path: "README.md"
      provides: "Project-level documentation update"
      contains: "Phase 3"
  key_links:
    - from: "dashboard/app.py"
      to: "reports/output/*.html"
      via: "HTML link in dashboard"
      pattern: "href.*reports"
    - from: "reports/index.qmd"
      to: "dashboard/index.html"
      via: "Markdown link to dashboard"
      pattern: "dashboard"
    - from: "reports/output/*"
      to: "reports/_quarto.yml"
      via: "quarto render"
      pattern: "quarto.*render"
---

<objective>
Integrate dashboard and report, generate all output formats, and create reproducibility documentation

Purpose: Deliver complete, polished outputs with cross-linking, multi-format generation, and clear reproducibility instructions
Output: Generated reports (PDF/HTML/Word), integrated dashboard, updated README files, and reproducibility checklist
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-visualization-reporting/03-CONTEXT.md
@.planning/phases/03-visualization-reporting/03-RESEARCH.md
@.planning/phases/03-visualization-reporting/03-02-SUMMARY.md
@.planning/phases/03-visualization-reporting/03-04-SUMMARY.md
@dashboard/app.py
@reports/_quarto.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate multi-format report output</name>
  <files>notebooks/12_integration.ipynb, reports/output/phl_crime_analysis.pdf, reports/output/phl_crime_analysis.html, reports/output/phl_crime_analysis.docx</files>
  <action>
Create notebook `notebooks/12_integration.ipynb` with:

1. **Generate report outputs** (3 cells):

   **Cell 1: Generate PDF:**
   ```python
   import subprocess
   import os

   # Change to reports directory
   os.chdir('reports')

   # Generate PDF
   result = subprocess.run(['quarto', 'render', '--to', 'pdf'], capture_output=True, text=True)
   
   if result.returncode == 0:
       print("PDF generated successfully")
       print(f"Output: reports/_book/phl_crime_analysis.pdf")
   else:
       print(f"PDF generation failed: {result.stderr}")
   ```

   **Cell 2: Generate HTML:**
   ```python
   # Generate HTML
   result = subprocess.run(['quarto', 'render', '--to', 'html'], capture_output=True, text=True)
   
   if result.returncode == 0:
       print("HTML generated successfully")
       print(f"Output: reports/_book/phl_crime_analysis.html")
   else:
       print(f"HTML generation failed: {result.stderr}")
   ```

   **Cell 3: Generate Word:**
   ```python
   # Generate Word
   result = subprocess.run(['quarto', 'render', '--to', 'docx'], capture_output=True, text=True)
   
   if result.returncode == 0:
       print("Word document generated successfully")
       print(f"Output: reports/_book/phl_crime_analysis.docx")
   else:
       print(f"Word generation failed: {result.stderr}")
   ```

2. **Move outputs to reports/output/** (1 cell):
   ```python
   import shutil

   # Create output directory
   os.makedirs('output', exist_ok=True)

   # Copy generated files
   for filename in ['phl_crime_analysis.pdf', 'phl_crime_analysis.html', 'phl_crime_analysis.docx']:
       src = f'_book/{filename}'
       dst = f'output/{filename}'
       if os.path.exists(src):
           shutil.copy2(src, dst)
           print(f"Copied {filename} to output/")
       else:
           print(f"Warning: {filename} not found in _book/")
   
   print("Report outputs copied to reports/output/")
   ```

3. **Verify outputs** (1 cell):
   ```python
   import os
   
   output_files = ['phl_crime_analysis.pdf', 'phl_crime_analysis.html', 'phl_crime_analysis.docx']
   
   print("Generated Report Outputs:")
   print("=" * 50)
   for filename in output_files:
       filepath = f'output/{filename}'
       if os.path.exists(filepath):
           size_mb = os.path.getsize(filepath) / (1024 * 1024)
           print(f"✓ {filename}: {size_mb:.2f} MB")
       else:
           print(f"✗ {filename}: NOT FOUND")
   ```

All three report formats (PDF, HTML, Word) generated and saved to reports/output/.
</action>
  <verify>
- reports/output/phl_crime_analysis.pdf exists and is valid PDF
- reports/output/phl_crime_analysis.html exists and is valid HTML
- reports/output/phl_crime_analysis.docx exists and is valid Word document
- All files are readable and not corrupted
- PDF has proper formatting (tables, figures, cross-references)
</verify>
  <done>
Generated 3 report formats:
- PDF: reports/output/phl_crime_analysis.pdf
- HTML: reports/output/phl_crime_analysis.html
- Word: reports/output/phl_crime_analysis.docx
All saved to reports/output/ directory.
</done>
</task>

<task type="auto">
  <name>Task 2: Add cross-links between dashboard and report</name>
  <files>notebooks/12_integration.ipynb, reports/index.qmd, dashboard/app.py</files>
  <action>
Add to notebook `12_integration.ipynb` (continue from Task 1):

4. **Add dashboard links to report** (1 cell):
   Read reports/index.qmd and add links in Executive Summary section:
   ```python
   # Read current index.qmd
   with open('index.qmd', 'r') as f:
       index_content = f.read()
   
   # Add dashboard link in Executive Summary
   dashboard_link = """
   
   ### Interactive Dashboard

   For interactive data exploration with filtering and drill-down capabilities, see the **[Philadelphia Crime Dashboard](../dashboard/index.html)**. The dashboard provides:

   - **6 analysis tabs**: Overview, Temporal, Geographic, Offense Types, Disparities, Cross-Factor
   - **18+ interactive charts**: Filterable by date, offense type, and district
   - **Export capabilities**: Download figures (PNG, SVG) and data (CSV)
   - **Real-time filtering**: Apply button pattern for performance with 3.5M records
   
   The dashboard complements this report by enabling stakeholders to explore data beyond static figures.
   """
   
   # Insert before "### Implications" in Executive Summary
   if "### Interactive Dashboard" not in index_content:
       # Find insertion point
       insertion_point = index_content.find("### Implications")
       if insertion_point > 0:
           index_content = index_content[:insertion_point] + dashboard_link + index_content[insertion_point:]
       
           # Write back
           with open('index.qmd', 'w') as f:
               f.write(index_content)
           
           print("Added dashboard link to reports/index.qmd")
       else:
           print("Could not find insertion point in index.qmd")
   else:
       print("Dashboard link already exists in index.qmd")
   ```

5. **Add report links to dashboard** (1 cell):
   Update dashboard/app.py to add links to report sections:
   ```python
   # Read current app.py
   with open('../dashboard/app.py', 'r') as f:
       app_content = f.read()
   
   # Add report links section to Overview tab
   report_links_section = """
   
   # Report Links
   html.Div([
       html.H4('Full Report', style={'margin-top': '20px'}),
       html.P([
           'For detailed methodology, statistical analysis, and limitations, see the ',
           html.A('Philadelphia Crime Analysis Report', href='../reports/output/phl_crime_analysis.pdf', target='_blank', style={'font-weight': 'bold'}),
           ' (PDF) or ',
           html.A('HTML version', href='../reports/output/phl_crime_analysis.html', target='_blank', style={'font-weight': 'bold'}),
           '.'
       ])
   ], style={'padding': '20px', 'backgroundColor': '#e9ecef', 'borderRadius': '5px', 'marginTop': '30px'}),
   """
   
   # Insert after Overview tab charts section
   if "Report Links" not in app_content:
       # Find insertion point in overview_tab() function
           insertion_marker = '# ... more charts'
           if insertion_marker in app_content:
               app_content = app_content.replace(
                   insertion_marker,
                   insertion_marker + report_links_section
               )
               
               # Write back
               with open('../dashboard/app.py', 'w') as f:
                   f.write(app_content)
               
               print("Added report links to dashboard/app.py")
           else:
               print("Could not find insertion point in dashboard/app.py")
   else:
       print("Report links already exist in dashboard/app.py")
   ```

6. **Add chapter-specific links to dashboard tabs** (1 cell):
   Add links from each dashboard tab to corresponding report section:
   ```python
   # For each dashboard tab, add link to corresponding report section
   tab_report_map = {
       'Temporal': '../reports/output/phl_crime_analysis.html#sec-temporal-findings',
       'Geographic': '../reports/output/phl_crime_analysis.html#sec-geographic-findings',
       'Offense': '../reports/output/phl_crime_analysis.html#sec-offense-findings',
       'Disparities': '../reports/output/phl_crime_analysis.html#sec-disparity-findings',
       'Cross-Factor': '../reports/output/phl_crime_analysis.html#sec-cross-factor-findings',
   }
   
   # Read app.py
   with open('../dashboard/app.py', 'r') as f:
       app_content = f.read()
   
   # Add links to each tab (simple implementation)
   for tab_name, report_link in tab_report_map.items():
       tab_header = f"html.H2('{tab_name} Analysis')"
       if tab_header in app_content:
           link_html = f"""
   html.Div([
       html.A(f'View detailed {tab_name} analysis in full report →', href='{report_link}', target='_blank',
              style={'float': 'right', 'fontSize': '14px', 'marginTop': '-40px'})
   ], style={'textAlign': 'right', 'marginBottom': '10px'}),"""
           # Insert after tab header
           app_content = app_content.replace(
               tab_header,
               tab_header + link_html
           )
   
   # Write back
   with open('../dashboard/app.py', 'w') as f:
       f.write(app_content)
   
   print("Added tab-specific report links to dashboard")
   ```

Bidirectional links added between dashboard and report sections.
</action>
  <verify>
- reports/index.qmd contains dashboard link in Executive Summary
- dashboard/app.py contains links to PDF and HTML report
- Each dashboard tab has link to corresponding report section
- Links are functional (correct file paths and section anchors)
</verify>
  <done>
Bidirectional cross-links established:
- Report → Dashboard: Link in Executive Summary pointing to dashboard/index.html
- Dashboard → Report: Links to PDF/HTML in Overview tab
- Tab-specific links: Each dashboard tab links to corresponding report section
</done>
</task>

<task type="auto">
  <name>Task 3: Create reproducibility documentation and update README</name>
  <files>notebooks/12_integration.ipynb, reports/README.md, README.md</files>
  <action>
Add to notebook `12_integration.ipynb` (continue from Task 2):

7. **Create reports/README.md** (1 cell):
   ```python
   reports_readme = """# Philadelphia Crime Analysis Report

**Version:** 1.0  
**Date:** January 2026  
**Data:** Philadelphia Open Data, Crime Incidents 2006-2026

## Report Outputs

This directory contains the complete academic report on Philadelphia crime incidents analysis.

### Generated Reports

| Format | File | Description |
|---------|-------|-------------|
| PDF | `output/phl_crime_analysis.pdf` | Full report (50-100 pages) with figures and tables |
| HTML | `output/phl_crime_analysis.html` | Web version with hyperlinked cross-references |
| Word | `output/phl_crime_analysis.docx` | Editable Word document for collaboration |

### Report Structure

The report consists of 10 chapters:

1. **Executive Summary** (@sec-executive-summary) - Key findings for non-technical audience
2. **Methodology** (@sec-methodology) - Data sources, analysis approach, statistical methods
3. **Data Quality** (@sec-data-quality) - Missing values, geocoding, reporting lag
4. **Temporal Findings** (@sec-temporal-findings) - 20-year trends, seasonality, hour/day patterns
5. **Geographic Findings** (@sec-geographic-findings) - Hotspots, districts, spatial clustering
6. **Offense Findings** (@sec-offense-findings) - UCR distribution, severity, top offenses
7. **Disparity Findings** (@sec-disparity-findings) - Cross-district comparisons, profiles
8. **Cross-Factor Findings** (@sec-cross-factor-findings) - Temporal×offense, geographic×offense
9. **Discussion** (@sec-discussion) - Interpretation, implications, confounding
10. **Limitations & Conclusion** (@sec-limitations) - Data quality, analytical limitations, summary

### Interactive Dashboard

For interactive data exploration, see the **[Philadelphia Crime Dashboard](../dashboard/index.html)**. The dashboard provides:

- 6 analysis tabs with 18+ interactive charts
- Filtering by date, offense type, and district
- Export capabilities (PNG, SVG, CSV downloads)
- Real-time exploration of 3.5M+ incident records

### Reproducibility

To regenerate this report:

```bash
# Navigate to reports directory
cd reports/

# Generate all formats (PDF, HTML, Word)
quarto render

# Generate specific format
quarto render --to pdf    # PDF
quarto render --to html    # HTML
quarto render --to docx    # Word
```

Output files are saved to `reports/_book/` and then copied to `reports/output/`.

### Data Sources

- **Primary**: Philadelphia Open Data Crime Incidents dataset
- **Period**: 2006-2026 (3.5M+ incidents)
- **Access**: https://opendata.philly.gov
- **Access Date**: January 27, 2026

### Software

- **Language**: Python 3.x
- **Report Generation**: Quarto 1.4+
- **Visualization**: Plotly 6.3.0, Matplotlib
- **Statistics**: SciPy, Pandas, NumPy

### Contact

For questions about this analysis or report generation, see the main project [README](../README.md).
   """

   with open('reports/README.md', 'w') as f:
       f.write(reports_readme)

   print("Created reports/README.md")
   ```

8. **Create reproducibility checklist** (1 cell):
   ```python
   reproducibility_checklist = """# Reproducibility Checklist

This checklist verifies that the analysis is fully reproducible.

## Environment Setup

- [ ] Python 3.x installed (version noted in `python --version`)
- [ ] Quarto 1.4+ installed (version noted in `quarto --version`)
- [ ] All dependencies installed: `pip install -r requirements.txt`
- [ ] No version conflicts: `pip check` returns no errors

## Data Access

- [ ] Raw data file exists: `data/crime_incidents_combined.parquet`
- [ ] Clean data file exists: `data/processed/crime_incidents_cleaned.parquet`
- [ ] Data loadable: `pd.read_parquet('data/processed/crime_incidents_cleaned.parquet')` succeeds
- [ ] Data shape correct: 3.5M+ rows, expected columns

## Notebook Execution

- [ ] Notebook 00 (environment_setup) runs without errors
- [ ] Notebook 01 (data_loading_validation) runs without errors
- [ ] Notebook 02 (exploratory_analysis) runs without errors
- [ ] Notebook 03 (temporal_analysis) runs without errors
- [ ] Notebook 04 (geographic_analysis) runs without errors
- [ ] Notebook 05 (offense_breakdown) runs without errors
- [ ] Notebook 06 (disparity_analysis) runs without errors
- [ ] Notebook 07 (cross_factor_analysis) runs without errors
- [ ] Notebook 08 (dashboard_precomputation) runs without errors
- [ ] Notebook 09 (dashboard_application) runs without errors
- [ ] Notebook 10 (report_setup) runs without errors
- [ ] Notebook 11 (report_content) runs without errors
- [ ] Notebook 12 (integration) runs without errors

## Output Verification

- [ ] Dashboard app.py generated: `dashboard/app.py` exists and is valid Python
- [ ] Dashboard aggregations exist: `output/dashboard/*.parquet` (6 files)
- [ ] Report chapters exist: `reports/*.qmd` (10 files)
- [ ] Figures copied: `reports/assets/figures/*` (55+ files)
- [ ] PDF report generated: `reports/output/phl_crime_analysis.pdf` exists
- [ ] HTML report generated: `reports/output/phl_crime_analysis.html` exists
- [ ] Word report generated: `reports/output/phl_crime_analysis.docx` exists

## Dashboard Verification

- [ ] Dashboard runs: `python dashboard/app.py` starts successfully
- [ ] All 6 tabs load without errors
- [ ] Filters work (Apply button updates charts)
- [ ] Export buttons work (PNG, SVG, CSV downloads)

## Report Verification

- [ ] PDF renders without LaTeX errors
- [ ] HTML has working cross-references (figures, tables, sections)
- [ ] All figures display correctly
- [ ] All tables formatted correctly
- [ ] Citations resolve correctly (@author references)

## Statistical Verification

- [ ] All p-values reported
- [ ] All effect sizes reported (Cohen's d, η², r)
- [ ] Confidence intervals included where applicable
- [ ] Multiple comparison correction applied (Bonferroni)

## Documentation

- [ ] README.md updated with Phase 3 completion
- [ ] reports/README.md created with instructions
- [ ] All notebooks have markdown documentation
- [ ] All code is version-controlled

## Known Issues

Document any known reproducibility issues here:

- [Issue description]
  [Impact]
  [Workaround]

---

**Reproducibility Status:** [ ] Fully Reproducible | [ ] Partially Reproducible | [ ] Not Reproducible

**Last Verified:** [Date]
**Verified By:** [Name]
   """

   with open('reports/REPRODUCIBILITY_CHECKLIST.md', 'w') as f:
       f.write(reproducibility_checklist)

   print("Created reports/REPRODUCIBILITY_CHECKLIST.md")
   ```

9. **Update main README.md** (1 cell):
   ```python
   # Read current README
   with open('../README.md', 'r') as f:
       readme_content = f.read()
   
   # Add Phase 3 completion section
   phase3_section = """

   ### Phase 3: Visualization & Reporting ✅ COMPLETE

   **Timeline:** Weeks 10-12  
   **Status:** Complete  
   **Date:** January 2026

   **Deliverables:**
   - ✅ Interactive Dashboard: `dashboard/app.py` with 6 tabs, 18+ charts, Apply-button filtering
   - ✅ Academic Report: Multi-format output (PDF, HTML, Word) in `reports/output/`
   - ✅ Executive Summary: Standalone document + integrated in main report
   - ✅ Cross-Linking: Bidirectional links between dashboard and report sections
   - ✅ Reproducibility Documentation: `reports/README.md` and checklist

   **Key Features:**
   - Dashboard: Multi-tab navigation, date/offense/district filtering, PNG/SVG/CSV exports
   - Report: 10 chapters, 55+ figures, APA citations, cross-references
   - Integration: Seamless navigation between interactive dashboard and static report

   **Access:**
   - Dashboard: Run `python dashboard/app.py` (starts on http://127.0.0.1:8050)
   - Report: See `reports/output/phl_crime_analysis.pdf` (PDF) or `.html` (web version)
   - Documentation: `reports/README.md`

   """
   
   # Insert after Phase 2 section
   if "### Phase 3:" not in readme_content:
       readme_content = readme_content.replace(
           "### Phase 2:",
           phase3_section + "\n### Phase 2:"
       )
       
       # Write back
       with open('../README.md', 'w') as f:
           f.write(readme_content)
       
       print("Updated README.md with Phase 3 completion")
   else:
       print("Phase 3 section already exists in README.md")
   ```

Documentation and README files updated with reproducibility instructions.
</action>
  <verify>
- reports/README.md exists with complete instructions
- reports/REPRODUCIBILITY_CHECKLIST.md exists with all checklist items
- README.md updated with Phase 3 completion status
- All documentation files are readable and well-formatted
- Instructions for regenerating reports are clear and complete
</verify>
  <done>
Reproducibility documentation complete:
- reports/README.md: Full documentation for report outputs and regeneration
- reports/REPRODUCIBILITY_CHECKLIST.md: Comprehensive checklist for verifying reproducibility
- README.md: Updated with Phase 3 completion status and deliverables
</done>
</task>

</tasks>

<verification>
- All 3 report formats generated (PDF, HTML, Word) in reports/output/
- Dashboard and report have bidirectional links
- Each dashboard tab links to corresponding report section
- reports/README.md provides clear instructions for access and regeneration
- reports/REPRODUCIBILITY_CHECKLIST.md covers all reproducibility aspects
- Main README.md updated with Phase 3 completion
- All documentation is accurate and complete
</verification>

<success_criteria>
Phase 3 fully integrated with dashboard, report outputs, cross-linking, and complete documentation.
</success_criteria>

<output>
After completion, create `.planning/phases/03-visualization-reporting/03-05-SUMMARY.md`
</output>
