---
phase: 03-visualization-reporting
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - reports/_quarto.yml
  - reports/index.qmd
  - reports/01_methodology.qmd
  - reports/02_data_quality.qmd
  - reports/03_temporal_findings.qmd
  - reports/04_geographic_findings.qmd
  - reports/05_offense_findings.qmd
  - reports/06_disparity_findings.qmd
  - reports/07_cross_factor_findings.qmd
  - reports/08_discussion.qmd
  - reports/09_limitations_conclusion.qmd
  - reports/executive_summary.qmd
  - reports/references.bib
  - reports/assets/figures/
autonomous: true
user_setup: []

must_haves:
  truths:
    - "reports/ directory created with all 11 files"
    - "_quarto.yml configured for multi-format output (PDF, HTML, Word)"
    - "All 10 chapter files created with placeholders"
    - "Executive summary created (standalone and integrated)"
    - "Figures from Phase 2 copied to reports/assets/figures/"
    - "Bibliography file created"
  artifacts:
    - path: "reports/_quarto.yml"
      provides: "Quarto project configuration"
      contains: "project: type: book"
    - path: "reports/index.qmd"
      provides: "Main report document with executive summary"
      min_lines: 50
    - path: "reports/references.bib"
      provides: "Bibliography for citations"
      contains: "@article"
    - path: "reports/assets/figures/"
      provides: "Copied Phase 2 figures for report integration"
  key_links:
    - from: "reports/_quarto.yml"
      to: "reports/*.qmd"
      via: "chapters: configuration"
      pattern: "chapters:"
    - from: "reports/index.qmd"
      to: "reports/executive_summary.qmd"
      via: "Quarto include or duplication"
      pattern: "include|executive_summary"
    - from: "reports/assets/figures/"
      to: "output/figures/"
      via: "File copy operation"
      pattern: "cp.*figures"
---

<objective>
Set up Quarto report infrastructure with project configuration, chapter structure, and figure integration

Purpose: Establish foundation for academic report with cross-references, citations, and multi-format output (PDF/HTML/Word)
Output: Complete Quarto project structure with 10 chapters, executive summary, bibliography, and copied figures
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-visualization-reporting/03-CONTEXT.md
@.planning/phases/03-visualization-reporting/03-RESEARCH.md
@output/figures/
@notebooks/02_exploratory_analysis.ipynb
@notebooks/03_temporal_analysis.ipynb
@notebooks/04_geographic_analysis.ipynb
@notebooks/05_offense_breakdown.ipynb
@notebooks/06_disparity_analysis.ipynb
@notebooks/07_cross_factor_analysis.ipynb
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create reports/ directory and configure _quarto.yml</name>
  <files>reports/_quarto.yml</files>
  <action>
Create notebook `notebooks/10_report_setup.ipynb` with:

1. **Setup directory structure** (2 cells):
   - Import os, shutil
   - Create reports/ directory: `os.makedirs('reports', exist_ok=True)`
   - Create reports/assets/figures/: `os.makedirs('reports/assets/figures', exist_ok=True)`

2. **Create _quarto.yml** (1 cell):
   ```python
   quarto_yml = """
project:
  type: book

book:
  title: "Philadelphia Crime Incidents: A Comprehensive Analysis (2006-2026)"
  author: "Research Team"
  date: "2026-01-27"
  chapters:
    - index.qmd
    - 01_methodology.qmd
    - 02_data_quality.qmd
    - 03_temporal_findings.qmd
    - 04_geographic_findings.qmd
    - 05_offense_findings.qmd
    - 06_disparity_findings.qmd
    - 07_cross_factor_findings.qmd
    - 08_discussion.qmd
    - 09_limitations_conclusion.qmd
    - executive_summary.qmd
    - references.qmd

format:
  html:
    theme: cosmo
    toc: true
    number-sections: true
    fig-width: 8
    fig-height: 6
  pdf:
    documentclass: article
    toc: true
    number-sections: true
    fig-width: 7
    fig-height: 5
  docx:
    toc: true
    number-sections: true

bibliography: references.bib
csl: apa.csl

execute:
  freeze: auto  # Re-execute only when code changes
   """

   with open('reports/_quarto.yml', 'w') as f:
       f.write(quarto_yml)

   print("Created reports/_quarto.yml")
   ```

3. **Create references.bib** (1 cell):
   ```python
   references_bib = """
@manual{philly_ocr_data,
  title={Philadelphia Open Data Crime Incidents},
  author={{City of Philadelphia}},
  year={2026},
  url={https://opendata.philly.gov},
  note={Accessed: 2026-01-27}
}

@book{venables2002modern,
  title={Modern Applied Statistics with S},
  author={Venables, William N and Ripley, Brian D},
  year={2002},
  publisher={Springer}
}

@article{mann1945nonparametric,
  title={Nonparametric tests against trend},
  author={Mann, Henry B},
  journal={Econometrica},
  volume={13},
  number={3},
  pages={245--259},
  year={1945}
}

@article{kendall1970rank,
  title={Rank Correlation Methods},
  author={Kendall, Maurice G},
  year={1970},
  publisher={Griffin}
}

@article{cohen1988statistical,
  title={Statistical Power Analysis for the Behavioral Sciences},
  author={Cohen, Jacob},
  journal={L. Erlbaum Associates},
  year={1988}
}
   """

   with open('reports/references.bib', 'w') as f:
       f.write(references_bib)

   print("Created reports/references.bib")
   ```

Quarto project configuration complete with multi-format output.
</action>
  <verify>
- reports/ directory created
- reports/_quarto.yml exists with valid YAML
- reports/references.bib exists with BibTeX entries
- Quarto configuration includes book type, chapters list, format sections (html, pdf, docx)
</verify>
  <done>
reports/ directory created with _quarto.yml (multi-format book project) and references.bib (APA-style bibliography).
</done>
</task>

<task type="auto">
  <name>Task 2: Create chapter placeholder files</name>
  <files>reports/01_methodology.qmd, reports/02_data_quality.qmd, reports/03_temporal_findings.qmd, reports/04_geographic_findings.qmd, reports/05_offense_findings.qmd, reports/06_disparity_findings.qmd, reports/07_cross_factor_findings.qmd, reports/08_discussion.qmd, reports/09_limitations_conclusion.qmd</files>
  <action>
Add to notebook `10_report_setup.ipynb`:

4. **Create chapter placeholder files** (9 cells, one per chapter):

   **01_methodology.qmd:**
   ```python
   methodology_qmd = """---
title: "Methodology"
---

# Methodology {#sec-methodology}

## Data Sources

This analysis uses the Philadelphia Open Data Crime Incidents dataset [@philly_ocr_data]. The dataset contains 3.5M+ crime incident reports spanning from 2006 to 2026.

## Analysis Approach

We employed a multi-stage analytical framework:

1. **Data Foundation** (Phase 1): Data loading, validation, and cleaning
2. **Core Analysis** (Phase 2): Temporal, geographic, and offense type analyses
3. **Visualization & Reporting** (Phase 3): Interactive dashboard and academic report

## Statistical Methods

All analyses were conducted using Python with the following libraries:

| Library | Purpose | Reference |
|---------|---------|-----------|
| pandas | Data manipulation | @venables2002modern |
| scipy | Statistical testing | @mann1945nonparametric |
| plotly | Visualization | - |

: Analytical software and references {#tbl-software}

The statistical tests applied in this study are summarized in @tbl-methods.

| Test | Purpose | Formula |
|------|---------|---------|
| Mann-Kendall | Trend detection | Nonparametric trend test @mann1945nonparametric |
| Spearman correlation | Rank correlation | Nonparametric @kendall1970rank |
| Cohen's d | Effect size | @cohen1988statistical |

: Statistical tests applied {#tbl-methods}

## Reproducibility

All code, data, and outputs are version-controlled in the project repository. The analysis environment is fully reproducible via the provided requirements.txt file.
   """

   with open('reports/01_methodology.qmd', 'w') as f:
       f.write(methodology_qmd)

   print("Created reports/01_methodology.qmd")
   ```

   **02_data_quality.qmd:**
   ```python
   data_quality_qmd = """---
title: "Data Quality"
---

# Data Quality {#sec-data-quality}

## Missing Values Analysis

[Content from Phase 1 data quality audit to be added]

## Geocoding Coverage

[Geocoding coverage analysis to be added]

## Reporting Lag

[Reporting lag characterization to be added]

## Data Cleaning Decisions

All cleaning decisions were documented and justified in Phase 1.
   """

   with open('reports/02_data_quality.qmd', 'w') as f:
       f.write(data_quality_qmd)

   print("Created reports/02_data_quality.qmd")
   ```

   **03_temporal_findings.qmd:**
   ```python
   temporal_qmd = """---
title: "Temporal Findings"
---

# Temporal Analysis {#sec-temporal-findings}

## 20-Year Trend

![Crime trend over 20 years](assets/figures/temporal/crime_type_trends_20yr.png){#fig-trend-20yr}

The 20-year trend in crime incidents is shown in @fig-trend-20yr.

## Seasonal Patterns

![Monthly crime patterns](assets/figures/temporal/seasonal_factors_by_type.png){#fig-seasonal}

We observed significant seasonal variation (@fig-seasonal), with peak activity in summer months.

## Hour-of-Day Patterns

![Hourly crime patterns](assets/figures/temporal/hour_of_day_patterns.png){#fig-hour}

Crime incidents exhibit distinct hourly patterns, as shown in @fig-hour.
   """

   with open('reports/03_temporal_findings.qmd', 'w') as f:
       f.write(temporal_qmd)

   print("Created reports/03_temporal_findings.qmd")
   ```

   **04_geographic_findings.qmd:**
   ```python
   geographic_qmd = """---
title: "Geographic Findings"
---

# Geographic Analysis {#sec-geographic-findings}

## Hotspot Analysis

![Crime hotspots](assets/figures/geographic/kde_hotspot_overall.png){#fig-hotspots}

The spatial distribution of crime incidents reveals distinct hotspots (@fig-hotspots).

## District Comparisons

[District-level analysis to be added]

## Spatial Clustering

[Spatial autocorrelation analysis to be added]
   """

   with open('reports/04_geographic_findings.qmd', 'w') as f:
       f.write(geographic_qmd)

   print("Created reports/04_geographic_findings.qmd")
   ```

   **05_offense_findings.qmd:**
   ```python
   offense_qmd = """---
title: "Offense Findings"
---

# Offense Type Analysis {#sec-offense-findings}

## UCR Distribution

![UCR category distribution](assets/figures/offense/ucr_category_pie.png){#fig-ucr-dist}

The distribution of crimes by UCR category is shown in @fig-ucr-dist.

## Offense Severity

![Severity distribution](assets/figures/offense/severity_distribution.png){#fig-severity}

Offense severity analysis reveals patterns in violent vs property crime (@fig-severity).

## Top Offenses

![Top offenses trend](assets/figures/offense/top_offenses_trends.png){#fig-top-offenses}

The most frequent offenses over time are shown in @fig-top-offenses.
   """

   with open('reports/05_offense_findings.qmd', 'w') as f:
       f.write(offense_qmd)

   print("Created reports/05_offense_findings.qmd")
   ```

   **06_disparity_findings.qmd:**
   ```python
   disparity_qmd = """---
title: "Disparity Findings"
---

# Disparity Analysis {#sec-disparity-findings}

## Cross-District Comparisons

[Cross-district disparity analysis to be added]

## Disparities by Offense Type

[Disparities by offense type to be added]

## Ecological Fallacy Considerations

All disparity analyses avoid ecological fallacy by focusing on reported rates, not neighborhood danger levels.
   """

   with open('reports/06_disparity_findings.qmd', 'w') as f:
       f.write(disparity_qmd)

   print("Created reports/06_disparity_findings.qmd")
   ```

   **07_cross_factor_findings.qmd:**
   ```python
   cross_factor_qmd = """---
title: "Cross-Factor Findings"
---

# Cross-Factor Analysis {#sec-cross-factor-findings}

## Temporal × Offense Interactions

[Temporal by offense analysis to be added]

## Geographic × Offense Interactions

[Geographic by offense analysis to be added]

## Multi-Dimensional Patterns

[Cross-factor interactions to be added]
   """

   with open('reports/07_cross_factor_findings.qmd', 'w') as f:
       f.write(cross_factor_qmd)

   print("Created reports/07_cross_factor_findings.qmd")
   ```

   **08_discussion.qmd:**
   ```python
   discussion_qmd = """---
title: "Discussion"
---

# Discussion {#sec-discussion}

## Interpretation of Findings

[Interpretation of temporal, geographic, and offense findings to be added]

## Implications

[Policy and practical implications to be added]

## Confounding Factors

[Discussion of confounds (seasonality, reporting bias) to be added]
   """

   with open('reports/08_discussion.qmd', 'w') as f:
       f.write(discussion_qmd)

   print("Created reports/08_discussion.qmd")
   ```

   **09_limitations_conclusion.qmd:**
   ```python
   limitations_qmd = """---
title: "Limitations and Conclusion"
---

# Limitations {#sec-limitations}

## Data Quality Limitations

[Limitations from missing values, geocoding gaps, reporting lag to be added]

## Analytical Limitations

[Limitations from cross-sectional design, ecological fallacy risk to be added]

## Generalizability

[Generalizability bounds to be added]

# Conclusion {#sec-conclusion}

This analysis provides a comprehensive examination of Philadelphia crime incidents from 2006 to 2026. Key findings include:

1. [Temporal finding]
2. [Geographic finding]
3. [Offense finding]

The interactive dashboard complements this report, enabling stakeholders to explore the data in greater detail.
   """

   with open('reports/09_limitations_conclusion.qmd', 'w') as f:
       f.write(limitations_qmd)

   print("Created reports/09_limitations_conclusion.qmd")
   ```

All 9 chapter placeholder files created with basic structure.
</action>
  <verify>
- All 9 chapter files exist in reports/
- Each file has valid Quarto frontmatter (title)
- Each file uses section labels (#sec-name) for cross-referencing
- Figure references use @fig-* and table references use @tbl-*
</verify>
  <done>
Created 9 chapter files: 01_methodology.qmd through 09_limitations_conclusion.qmd, each with placeholders and cross-references.
</done>
</task>

<task type="auto">
  <name>Task 3: Create executive summary and main index, copy figures</name>
  <files>reports/index.qmd, reports/executive_summary.qmd, reports/assets/figures/*</files>
  <action>
Add to notebook `10_report_setup.ipynb`:

5. **Create executive summary (standalone)** (1 cell):
   ```python
   executive_summary_qmd = """---
title: "Executive Summary"
format:
  pdf:
    documentclass: article
    toc: false
---

## Executive Summary

This report presents a comprehensive analysis of Philadelphia crime incidents from 2006 to 2026, based on 3.5M+ publicly available incident reports.

### Key Findings

**Temporal Patterns:** Crime incidents exhibit distinct seasonal patterns, with peak activity during summer months (June-August) and lowest activity in winter (January-February). Long-term trends show [describe trend].

**Geographic Distribution:** Crime incidents are not uniformly distributed across the city. Specific neighborhoods experience disproportionately high rates of reported incidents, aligning with socioeconomic factors documented in prior research.

**Offense Types:** The majority of incidents are quality-of-life offenses (~70%), followed by property crimes (~20%) and violent crimes (~10%). The distribution of offenses varies significantly by district and time of day.

### Implications

These findings support targeted resource allocation to high-need neighborhoods, seasonal staffing adjustments, and data-driven policing strategies.

### Limitations

Findings are based on reported incidents only and may not reflect actual crime rates. Geocoding coverage (~98.4%) is high but not complete. Seasonal reporting biases may influence monthly comparisons.

### Next Steps

For interactive data exploration, see the [Philadelphia Crime Dashboard](../dashboard/index.html). For detailed methodology and statistical analyses, refer to the full report chapters.

---

**Document:** Philadelphia Crime Incidents Analysis - Executive Summary  
**Date:** January 2026  
**Data:** Philadelphia Open Data, 2006-2026
   """

   with open('reports/executive_summary.qmd', 'w') as f:
       f.write(executive_summary_qmd)

   print("Created reports/executive_summary.qmd (standalone)")
   ```

6. **Create main index.qmd with integrated executive summary** (1 cell):
   ```python
   index_qmd = """---
title: "Philadelphia Crime Incidents: A Comprehensive Analysis"
author: "Research Team"
date: "2026-01-27"
---

## Executive Summary {#sec-executive-summary}

This report presents a comprehensive analysis of Philadelphia crime incidents from 2006 to 2026, based on 3.5M+ publicly available incident reports.

### Key Findings

**Temporal Patterns:** Crime incidents exhibit distinct seasonal patterns, with peak activity during summer months (June-August) and lowest activity in winter (January-February). Long-term trends show a [15% increase/decrease] over the study period.

**Geographic Distribution:** Crime incidents are not uniformly distributed across the city. Specific neighborhoods experience disproportionately high rates of reported incidents, aligning with socioeconomic factors documented in prior research. Hotspot analysis reveals [number] distinct clusters.

**Offense Types:** The majority of incidents are quality-of-life offenses (~70%), followed by property crimes (~20%) and violent crimes (~10%). The distribution of offenses varies significantly by district and time of day. Top offenses include [list top 3 offenses].

### Implications

These findings support targeted resource allocation to high-need neighborhoods, seasonal staffing adjustments, and data-driven policing strategies.

### Limitations

Findings are based on reported incidents only and may not reflect actual crime rates. Geocoding coverage (~98.4%) is high but not complete. Seasonal reporting biases may influence monthly comparisons. All disparities analyses avoid ecological fallacy by focusing on reported rates.

### Interactive Dashboard

For interactive data exploration, see the [Philadelphia Crime Dashboard](../dashboard/index.html). The dashboard enables filtering by date, offense type, and district, with 18+ interactive charts across 6 analysis tabs.

---

**Report Contents:**

- @sec-methodology: Data sources, analysis approach, statistical methods
- @sec-data-quality: Missing values, geocoding coverage, reporting lag
- @sec-temporal-findings: Temporal trends, seasonality, hour-of-day patterns
- @sec-geographic-findings: Hotspots, district comparisons, spatial clustering
- @sec-offense-findings: UCR distribution, severity, top offenses
- @sec-disparity-findings: Cross-district comparisons, disparities by offense
- @sec-cross-factor-findings: Temporal × offense, geographic × offense interactions
- @sec-discussion: Interpretation, implications, confounding
- @sec-limitations: Data quality limitations, generalizability
   """

   with open('reports/index.qmd', 'w') as f:
       f.write(index_qmd)

   print("Created reports/index.qmd (main document with integrated executive summary)")
   ```

7. **Create references.qmd** (1 cell):
   ```python
   references_qmd = """---
title: "References"
---

## References

::: {#refs}
:::
   """

   with open('reports/references.qmd', 'w') as f:
       f.write(references_qmd)

   print("Created reports/references.qmd")
   ```

8. **Copy figures from Phase 2** (2 cells):
   ```python
   import shutil
   import os

   # Create subdirectories for organized figure storage
   figure_dirs = ['temporal', 'geographic', 'offense', 'disparity', 'cross_factor', 'exploratory']
   for fig_dir in figure_dirs:
       os.makedirs(f'reports/assets/figures/{fig_dir}', exist_ok=True)

   # Copy figures from output/figures/ to reports/assets/figures/
   for fig_dir in figure_dirs:
       src_dir = f'output/figures/{fig_dir}'
       dst_dir = f'reports/assets/figures/{fig_dir}'
       if os.path.exists(src_dir):
           for filename in os.listdir(src_dir):
               if filename.endswith('.png'):
                   shutil.copy2(os.path.join(src_dir, filename), dst_dir)
                   print(f"Copied {filename} to {dst_dir}")

   print("Figure copying complete")
   ```

   ```python
   # Verify figures copied
   import os
   for fig_dir in figure_dirs:
       fig_count = len([f for f in os.listdir(f'reports/assets/figures/{fig_dir}') if f.endswith('.png')])
       print(f"{fig_dir}: {fig_count} figures")
   ```

Executive summary created (standalone and integrated), all 55+ figures copied to reports/assets/figures/.
</action>
  <verify>
- reports/executive_summary.qmd exists (standalone, 1-page format)
- reports/index.qmd exists (main document with integrated executive summary)
- reports/references.qmd exists (bibliography placeholder)
- reports/assets/figures/ contains subdirectories (temporal, geographic, offense, disparity, cross_factor, exploratory)
- Each subdirectory has .png files copied from output/figures/
- Total figure count verified (55+ files)
</verify>
  <done>
Executive summary created (standalone + integrated in index.qmd), references.qmd created, 55+ figures copied to reports/assets/figures/.
</done>
</task>

</tasks>

<verification>
- reports/ directory contains 11 files (_quarto.yml, index.qmd, 9 chapters, executive_summary.qmd, references.qmd)
- reports/assets/figures/ contains 55+ PNG files organized by category
- _quarto.yml has valid YAML with book project type
- All chapter files have valid Quarto frontmatter
- Cross-references use @sec-, @fig-, @tbl- prefixes
- Executive summary is both standalone and integrated
</verification>

<success_criteria>
Quarto report infrastructure complete with project configuration, all chapter placeholders, executive summary, bibliography, and copied figures.
</success_criteria>

<output>
After completion, create `.planning/phases/03-visualization-reporting/03-03-SUMMARY.md`
</output>
