---
phase: 13-pipeline-and-supporting-tests
plan: 05
type: execute
wave: 2
depends_on: [13-04]
files_modified:
  - tests/test_config_schemas.py
autonomous: true

must_haves:
  truths:
    - All config schema classes load with correct defaults
    - Schema validation enforces field constraints
    - YAML configuration loading works for all schemas
    - Environment variable overrides work for schema-specific fields
  artifacts:
    - path: tests/test_config_schemas.py
      provides: Configuration schema tests
      min_lines: 200
    - path: analysis/config/schemas/chief.py
      provides: TrendsConfig, SeasonalityConfig, COVIDConfig
    - path: analysis/config/schemas/patrol.py
      provides: HotspotsConfig, RobberyConfig, DistrictConfig, CensusConfig
    - path: analysis/config/schemas/policy.py
      provides: RetailTheftConfig, VehicleCrimesConfig, CompositionConfig, EventsConfig
    - path: analysis/config/schemas/forecasting.py
      provides: TimeSeriesConfig, ClassificationConfig
  key_links:
    - from: tests/test_config_schemas.py
      to: analysis/config/schemas/*.py
      via: Direct imports of all schema classes
      pattern: "from analysis.config.schemas."
---

<objective>
Create comprehensive tests for all configuration schemas in analysis/config/schemas/. Test default values, validation constraints, and YAML loading for chief, patrol, policy, and forecasting schemas.

Purpose: Achieve comprehensive coverage of configuration schemas (SUPP-01 requirement).

Output: New test_config_schemas.py with 30+ tests covering all 11 schema classes.
</objective>

<execution_context>
@/Users/dustinober/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dustinober/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/13-pipeline-and-supporting-tests/13-RESEARCH.md
@.planning/milestones/v1.3-ROADMAP.md
@.planning/REQUIREMENTS.md

# Prior Phase Decisions
- Use tmp_path and monkeypatch.chdir for isolated config testing
- Test validation with pytest.raises for constraint violations
- Group tests by schema file (chief, patrol, policy, forecasting)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Test chief schema defaults and validation</name>
  <files>tests/test_config_schemas.py</files>
  <action>Create tests/test_config_schemas.py and add chief schema tests:
  1. test_trends_config_defaults - Verify start_year=2015, end_year=2024, min_complete_months=12
  2. test_trends_config_validation_year_ranges - Verify start_year/end_year constraints (2006-2026)
  3. test_trends_config_validation_min_complete_months - Verify ge=1, le=12 constraint
  4. test_seasonality_config_defaults - Verify summer_months=[6,7,8], winter_months=[12,1,2]
  5. test_seasonality_config_validation_significance_level - Verify ge=0.01, le=0.1
  6. test_covid_config_defaults - Verify lockdown_date="2020-03-01", before_years=[2018,2019], after_years=[2021,2022]

Import from analysis.config.schemas.chief. Test defaults and validation constraints.</action>
  <verify>pytest tests/test_config_schemas.py -k "chief" -v</verify>
  <done>All 6 chief schema tests pass, validating TrendsConfig, SeasonalityConfig, COVIDConfig.</done>
</task>

<task type="auto">
  <name>Task 2: Test patrol schema defaults and validation</name>
  <files>tests/test_config_schemas.py</files>
  <action>Add patrol schema tests:
  1. test_hotspots_config_defaults - Verify eps_degrees=0.002, min_samples=50, algorithm="DBSCAN"
  2. test_hotspots_config_validation_spatial_bounds - Verify lon/lat min/max are Philadelphia bounds
  3. test_hotspots_config_validation_clustering_params - Verify eps_degrees ge=0.0001 le=0.01, min_samples ge=10 le=500
  4. test_robbery_config_defaults - Verify time_bin_size=60, grid_size=20
  5. test_robbery_config_validation_time_bin - Verify ge=15 le=240
  6. test_district_config_defaults - Verify enable_custom_weights=False, districts=None
  7. test_census_config_defaults - Verify census_file="census_tracts.geojson", population_threshold=100
  8. test_census_config_validation_threshold - Verify population_threshold ge=0

Import from analysis.config.schemas.patrol. Test all 4 config classes.</action>
  <verify>pytest tests/test_config_schemas.py -k "patrol" -v</verify>
  <done>All 8 patrol schema tests pass, validating HotspotsConfig, RobberyConfig, DistrictConfig, CensusConfig.</done>
</task>

<task type="auto">
  <name>Task 3: Test policy schema defaults and validation</name>
  <files>tests/test_config_schemas.py</files>
  <action>Add policy schema tests:
  1. test_retail_theft_config_defaults - Verify focus_stores=None, baseline dates, report_name
  2. test_vehicle_crimes_config_defaults - Verify ucr_codes=[700], start/end dates
  3. test_vehicle_crimes_config_validation_ucr_codes - Verify ucr_codes is list of ints
  4. test_composition_config_defaults - Verify group_by_ucr_hundred=True, top_n=10
  5. test_composition_config_validation_top_n - Verify ge=5 le=20
  6. test_events_config_defaults - Verify days_before=7, days_after=7, event_types list
  7. test_events_config_validation_window - Verify days_before/days_after ge=1 le=30
  8. test_events_config_validation_event_types - Verify default event types include sports teams

Import from analysis.config.schemas.policy. Test all 4 config classes.</action>
  <verify>pytest tests/test_config_schemas.py -k "policy" -v</verify>
  <done>All 8 policy schema tests pass, validating RetailTheftConfig, VehicleCrimesConfig, CompositionConfig, EventsConfig.</done>
</task>

<task type="auto">
  <name>Task 4: Test forecasting schema defaults and validation</name>
  <files>tests/test_config_schemas.py</files>
  <action>Add forecasting schema tests:
  1. test_time_series_config_defaults - Verify forecast_horizon=12, forecast_test_size=0.2, model_type="prophet"
  2. test_time_series_config_validation_horizon - Verify ge=1 le=52
  3. test_time_series_config_validation_test_size - Verify ge=0.1 le=0.5
  4. test_time_series_config_validation_model_type - Verify pattern matches prophet|arima|ets
  5. test_classification_config_defaults - Verify violent_ucr_codes, test_size=0.25, random_state=42
  6. test_classification_config_validation_test_size - Verify ge=0.1 le=0.5
  7. test_classification_config_validation_importance_threshold - Verify ge=0.001 le=0.1
  8. test_classification_config_validation_ucr_codes - Verify violent_ucr_codes defaults to [100,200,300,400]

Import from analysis.config.schemas.forecasting. Test both config classes.</action>
  <verify>pytest tests/test_config_schemas.py -k "forecasting" -v</verify>
  <done>All 8 forecasting schema tests pass, validating TimeSeriesConfig and ClassificationConfig.</done>
</task>

<task type="auto">
  <name>Task 5: Test schema YAML loading</name>
  <files>tests/test_config_schemas.py</files>
  <action>Add YAML loading tests:
  1. test_trends_config_loads_from_yaml - Create chief.yaml, verify TrendsConfig loads
  2. test_hotspots_config_loads_from_yaml - Create patrol.yaml, verify HotspotsConfig loads
  3. test_retail_theft_config_loads_from_yaml - Create policy.yaml, verify RetailTheftConfig loads
  4. test_time_series_config_loads_from_yaml - Create forecasting.yaml, verify TimeSeriesConfig loads
  5. test_schema_yaml_partial_override - Verify partial YAML uses defaults for unspecified fields

Use tmp_path and monkeypatch.chdir to create isolated YAML files. Use yaml.dump() to write config. Instantiate schemas and verify values loaded correctly.</action>
  <verify>pytest tests/test_config_schemas.py -k "yaml" -v</verify>
  <done>All 5 YAML loading tests pass, validating configuration file parsing.</done>
</task>

<task type="auto">
  <name>Task 6: Test schema environment variable overrides</name>
  <files>tests/test_config_schemas.py</files>
  <action>Add environment override tests:
  1. test_trends_config_env_override - Verify CRIME prefix env vars override TrendsConfig defaults
  2. test_hotspots_config_env_override - Verify env vars override HotspotsConfig defaults
  3. test_retail_theft_config_env_override - Verify env vars override RetailTheftConfig defaults
  4. test_time_series_config_env_override - Verify env vars override TimeSeriesConfig defaults

Use monkeypatch.setenv to set CRIME_* environment variables. Instantiate configs and verify overrides take effect. Test with both direct field names and nested notation.</action>
  <verify>pytest tests/test_config_schemas.py -k "env" -v</verify>
  <done>All 4 environment override tests pass, validating schema config priority.</done>
</task>

<task type="auto">
  <name>Task 7: Test schema inherited BaseConfig fields</name>
  <files>tests/test_config_schemas.py</files>
  <action>Add inherited field tests:
  1. test_trends_config_inherits_output_dir - Verify TrendsConfig inherits output_dir from BaseConfig
  2. test_hotspots_config_inherits_dpi - Verify HotspotsConfig inherits dpi from BaseConfig
  3. test_retail_theft_config_inherits_output_format - Verify RetailTheftConfig inherits output_format from BaseConfig
  4. test_time_series_config_inherits_cache_enabled - Verify TimeSeriesConfig inherits cache_enabled from BaseConfig
  5. test_all_schemas_inherit_version - Verify all schemas inherit version="v1.0"

Verify that BaseConfig fields are properly inherited by all schema classes and can be overridden via YAML or env vars.</action>
  <verify>pytest tests/test_config_schemas.py -k "inherit" -v</verify>
  <done>All 5 inheritance tests pass, validating BaseConfig field propagation.</done>
</task>

</tasks>

<verification>
Run all config schema tests: pytest tests/test_config_schemas.py -v

Run with coverage: pytest tests/test_config_schemas.py --cov=analysis/config/schemas --cov-report=term-missing

Verify:
1. All tests pass (target: 35+ tests)
2. Coverage of analysis/config/schemas/ exceeds 90%
3. All 11 schema classes tested
4. All validation constraints tested
</verification>

<success_criteria>
1. analysis/config/schemas/ has 90%+ test coverage
2. All 11 schema classes have tests
3. Default values validated
4. Field constraints enforced
5. YAML loading tested
6. Environment overrides tested
7. Inheritance from BaseConfig verified
</success_criteria>

<output>
After completion, create `.planning/phases/13-pipeline-and-supporting-tests/13-05-SUMMARY.md` with:
- Number of tests added
- Coverage achieved for analysis/config/schemas/
- List of all schema classes tested
</output>
