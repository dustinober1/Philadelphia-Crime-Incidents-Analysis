---
phase: 07-visualization-testing
plan: 09
type: execute
wave: 1
depends_on: []
files_modified:
  - analysis/cli/patrol.py
  - analysis/cli/policy.py
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "User can specify --output-format (png, svg, pdf) on Patrol CLI commands"
    - "User can specify --output-format (png, svg, pdf) on Policy CLI commands"
    - "CLI commands accept and store output_format parameter"
    - "Default output format is png when not specified"
  artifacts:
    - path: "analysis/cli/patrol.py"
      provides: "Patrol CLI commands with --output-format argument"
      contains: "output_format: Literal['png', 'svg', 'pdf']"
    - path: "analysis/cli/policy.py"
      provides: "Policy CLI commands with --output-format argument"
      contains: "output_format: Literal['png', 'svg', 'pdf']"
  key_links:
    - from: "analysis/cli/patrol.py"
      to: "typer.Option"
      via: "output_format parameter with default 'png'"
      pattern: "output_format.*typer\.Option.*png"
    - from: "analysis/cli/policy.py"
      to: "typer.Option"
      via: "output_format parameter with default 'png'"
      pattern: "output_format.*typer\.Option.*png"
---

<objective>
Add --output-format CLI argument to Patrol and Policy commands.

This plan adds the --output-format argument to all Patrol (hotspots, robbery-heatmap, district-severity, census-rates) and Policy (retail-theft, vehicle-crimes, composition, events) CLI commands. Combined with plan 07-08, this completes adding --output-format to all 13 CLI commands.

Purpose: Enable users to specify PNG, SVG, or PDF output format for figures generated by all remaining CLI commands.
Output: Updated Patrol and Policy CLI commands with --output-format argument (default: png).
</objective>

<execution_context>
@/Users/dustinober/.claude/get-shit-done/workflows/execute-plan.md
@/Users/dustinober/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/07-visualization-testing/07-VERIFICATION.md
@.planning/phases/07-visualization-testing/07-08-PLAN.md
@.planning/phases/07-visualization-testing/07-01-SUMMARY.md
@analysis/visualization/__init__.py
@analysis/cli/patrol.py
@analysis/cli/policy.py

Gap reason from VERIFICATION.md:
- "CLI commands do not have --output-format argument implemented. save_figure() function exists but CLI does not expose it."
- Missing: "--output-format CLI argument on all 13 CLI commands"

What exists (from 07-01 SUMMARY):
- Visualization module is complete with save_figure(), setup_style(), plot functions
- All exports are accessible via `from analysis.visualization import ...`
- Testing infrastructure is complete (27 CLI tests, all passing)
- Plan 07-08 adds --output-format to Chief and Forecasting commands

What needs to be added:
- --output-format CLI argument on 4 Patrol commands (hotspots, robbery-heatmap, district-severity, census-rates)
- --output-format CLI argument on 4 Policy commands (retail-theft, vehicle-crimes, composition, events)
- Pass output_format parameter through to figure generation (plan 07-10)

Note: This plan can run in parallel with 07-08 since they modify different CLI files.
</context>

<tasks>

<task type="auto">
  <name>Add --output-format argument to Patrol CLI commands</name>
  <files>analysis/cli/patrol.py</files>
  <action>
    Add output_format parameter to all four Patrol CLI commands:

    1. Import Literal type from typing (add to imports at top of file):
       ```python
       from typing import Literal
       ```

    2. For each command (hotspots, robbery-heatmap, district-severity, census-rates), add the output_format parameter after the existing parameters:
       ```python
       output_format: Literal["png", "svg", "pdf"] = typer.Option("png", help="Figure output format")
       ```

    3. Pass output_format to the config object for each command:
       - hotspots: config = HotspotsConfig(..., output_format=output_format)
       - robbery-heatmap: config = RobberyConfig(..., output_format=output_format)
       - district-severity: config = DistrictConfig(..., output_format=output_format)
       - census-rates: config = CensusConfig(..., output_format=output_format)

    4. Update config schema imports if needed - check analysis/config/schemas/patrol.py to ensure output_format is accepted

    DO NOT:
    - Do not add figure generation code in this task (plan 07-10 handles wiring)
    - Do not modify test files (plan 07-10 handles test updates)
  </action>
  <verify>
    Run: python -m analysis.cli patrol hotspots --help
    Expected: --output-format option appears in help output with choices [png, svg, pdf]
    Run: python -m analysis.cli patrol robbery-heatmap --help
    Expected: --output-format option appears in help output
    Run: python -m analysis.cli patrol district-severity --help
    Expected: --output-format option appears in help output
    Run: python -m analysis.cli patrol census-rates --help
    Expected: --output-format option appears in help output
  </verify>
  <done>
    All four Patrol CLI commands accept --output-format argument with default value "png".
    The parameter is passed to config objects for use in figure generation.
  </done>
</task>

<task type="auto">
  <name>Add --output-format argument to Policy CLI commands</name>
  <files>analysis/cli/policy.py</files>
  <action>
    Add output_format parameter to all four Policy CLI commands:

    1. Import Literal type from typing (add to imports at top of file):
       ```python
       from typing import Literal
       ```

    2. For each command (retail-theft, vehicle-crimes, composition, events), add the output_format parameter after the existing parameters:
       ```python
       output_format: Literal["png", "svg", "pdf"] = typer.Option("png", help="Figure output format")
       ```

    3. Pass output_format to the config object for each command:
       - retail-theft: config = RetailTheftConfig(..., output_format=output_format)
       - vehicle-crimes: config = VehicleCrimesConfig(..., output_format=output_format)
       - composition: config = CompositionConfig(..., output_format=output_format)
       - events: config = EventsConfig(..., output_format=output_format)

    4. Update config schema imports if needed - check analysis/config/schemas/policy.py to ensure output_format is accepted

    DO NOT:
    - Do not add figure generation code in this task (plan 07-10 handles wiring)
    - Do not modify test files (plan 07-10 handles test updates)
  </action>
  <verify>
    Run: python -m analysis.cli policy retail-theft --help
    Expected: --output-format option appears in help output with choices [png, svg, pdf]
    Run: python -m analysis.cli policy vehicle-crimes --help
    Expected: --output-format option appears in help output
    Run: python -m analysis.cli policy composition --help
    Expected: --output-format option appears in help output
    Run: python -m analysis.cli policy events --help
    Expected: --output-format option appears in help output
  </verify>
  <done>
    All four Policy CLI commands accept --output-format argument with default value "png".
    The parameter is passed to config objects for use in figure generation.
  </done>
</task>

</tasks>

<verification>
After completing all tasks, verify:

1. All Patrol and Policy commands accept --output-format:
   ```bash
   python -m analysis.cli patrol hotspots --help | grep output-format
   python -m analysis.cli patrol robbery-heatmap --help | grep output-format
   python -m analysis.cli patrol district-severity --help | grep output-format
   python -m analysis.cli patrol census-rates --help | grep output-format
   python -m analysis.cli policy retail-theft --help | grep output-format
   python -m analysis.cli policy vehicle-crimes --help | grep output-format
   python -m analysis.cli policy composition --help | grep output-format
   python -m analysis.cli policy events --help | grep output-format
   ```

2. Commands still execute successfully with default format:
   ```bash
   python -m analysis.cli patrol hotspots --fast --version test
   python -m analysis.cli policy retail-theft --fast --version test
   ```

3. Commands accept explicit format values:
   ```bash
   python -m analysis.cli patrol hotspots --output-format svg --fast --version test
   python -m analysis.cli policy retail-theft --output-format pdf --fast --version test
   ```

4. Combined verification with plan 07-08 - all 13 CLI commands now have --output-format:
   ```bash
   grep -r "output_format.*Literal" analysis/cli/
   ```
   Expected: Matches in all 4 CLI files (chief.py, patrol.py, policy.py, forecasting.py)
</verification>

<success_criteria>
- [ ] All Patrol CLI commands (4 commands) have --output-format argument
- [ ] All Policy CLI commands (4 commands) have --output-format argument
- [ ] Default value is "png" for all commands
- [ ] Valid choices are: png, svg, pdf
- [ ] Commands execute successfully with default format
- [ ] Commands execute successfully with explicit format values
- [ ] output_format is passed to config objects for use in figure generation
- [ ] All 13 CLI commands across all 4 groups now have --output-format (combined with 07-08)
</success_criteria>

<output>
After completion, create `.planning/phases/07-visualization-testing/07-09-SUMMARY.md`
</output>
